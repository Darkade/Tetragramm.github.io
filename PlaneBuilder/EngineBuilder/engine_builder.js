var WARNING_COLOR;(function(a){a[a.WHITE=0]="WHITE";a[a.YELLOW=1]="YELLOW";a[a.RED=2]="RED"})(WARNING_COLOR||={});
class Stats{constructor(a){this.charge=this.fuel=this.bomb_mass=this.crashsafety=this.upkeep=this.toughness=this.wingarea=this.pitchboost=this.pitchspeed=this.structure=this.maxstrain=this.fuelconsumption=this.power=this.reliability=this.cooling=this.latstab=this.pitchstab=this.escape=this.flightstress=this.visibility=this.reqsections=this.cost=this.control=this.drag=this.mass=this.wetmass=this.liftbleed=0;this.warnings=[];this.era=[];a&&this.fromJSON(a,0)}toJSON(){return{liftbleed:this.liftbleed,
wetmass:this.wetmass,mass:this.mass,drag:this.drag,control:this.control,cost:this.cost,reqsections:this.reqsections,visibility:this.visibility,flightstress:this.flightstress,escape:this.escape,pitchstab:this.pitchstab,latstab:this.latstab,cooling:this.cooling,reliability:this.reliability,power:this.power,fuelconsumption:this.fuelconsumption,maxstrain:this.maxstrain,structure:this.structure,pitchboost:this.pitchboost,pitchspeed:this.pitchspeed,wingarea:this.wingarea,toughness:this.toughness,upkeep:this.upkeep,
crashsafety:this.crashsafety,bomb_mass:this.bomb_mass,fuel:this.fuel,charge:this.charge,warnings:this.warnings,eras:this.era}}fromJSON(a,b){a.liftbleed&&(this.liftbleed=a.liftbleed);a.wetmass&&(this.wetmass=a.wetmass);a.mass&&(this.mass=a.mass);a.drag&&(this.drag=a.drag);a.control&&(this.control=a.control);a.cost&&(this.cost=a.cost);a.reqsections&&(this.reqsections=a.reqsections);a.visibility&&(this.visibility=a.visibility);a.flightstress&&(this.flightstress=a.flightstress);a.escape&&(this.escape=
a.escape);a.pitchstab&&(this.pitchstab=a.pitchstab);a.latstab&&(this.latstab=a.latstab);a.cooling&&(this.cooling=a.cooling);a.reliability&&(this.reliability=a.reliability);a.power&&(this.power=a.power);a.fuelconsumption&&(this.fuelconsumption=a.fuelconsumption);a.maxstrain&&(this.maxstrain=a.maxstrain);a.structure&&(this.structure=a.structure);a.pitchspeed&&(this.pitchspeed=a.pitchspeed);a.pitchboost&&(this.pitchboost=a.pitchboost);a.wingarea&&(this.wingarea=a.wingarea);a.toughness&&(this.toughness=
a.toughness);a.upkeep&&(this.upkeep=a.upkeep);a.crashsafety&&(this.crashsafety=a.crashsafety);a.bomb_mass&&(this.bomb_mass=a.bomb_mass);a.fuel&&(this.fuel=a.fuel);a.charge&&(this.charge=a.charge);a.warning&&this.warnings.push({source:lu(a.name),warning:lu(a.warning),color:WARNING_COLOR.WHITE});if(a.warnings){b=a.warnings;let d=[];for(var c of b)d.push({source:c.source,warning:c.warning});this.warnings=this.MergeWarnings(d)}a.era&&this.era.push({name:lu(a.name),era:lu(a.era)});if(a.eras){a=a.eras;
c=[];for(let d of a)c.push({name:d.name,era:d.era});this.era=this.MergeEra(c)}}serialize(a){a.PushNum(this.liftbleed);a.PushNum(this.wetmass);a.PushNum(this.mass);a.PushNum(this.drag);a.PushNum(this.control);a.PushNum(this.cost);a.PushNum(this.reqsections);a.PushNum(this.visibility);a.PushNum(this.flightstress);a.PushNum(this.escape);a.PushNum(this.pitchstab);a.PushNum(this.latstab);a.PushNum(this.cooling);a.PushNum(this.reliability);a.PushNum(this.power);a.PushNum(this.fuelconsumption);a.PushNum(this.maxstrain);
a.PushNum(this.structure);a.PushFloat(this.pitchboost);a.PushFloat(this.pitchspeed);a.PushNum(this.wingarea);a.PushNum(this.toughness);a.PushNum(this.upkeep);a.PushNum(this.crashsafety);a.PushNum(this.bomb_mass);a.PushNum(this.fuel);a.PushNum(this.charge);a.PushNum(this.warnings.length);for(let b of this.warnings)a.PushString(b.source),a.PushString(b.warning);a.PushNum(this.era.length);for(let b of this.era)a.PushString(b.name),a.PushString(b.era)}deserialize(a){this.liftbleed=a.GetNum();this.wetmass=
a.GetNum();this.mass=a.GetNum();this.drag=a.GetNum();this.control=a.GetNum();this.cost=a.GetNum();this.reqsections=a.GetNum();this.visibility=a.GetNum();this.flightstress=a.GetNum();this.escape=a.GetNum();this.pitchstab=a.GetNum();this.latstab=a.GetNum();this.cooling=a.GetNum();this.reliability=a.GetNum();this.power=a.GetNum();this.fuelconsumption=a.GetNum();this.maxstrain=a.GetNum();this.structure=a.GetNum();this.pitchboost=a.GetFloat();this.pitchspeed=a.GetFloat();this.wingarea=a.GetNum();this.toughness=
a.GetNum();this.upkeep=a.GetNum();this.crashsafety=a.GetNum();this.bomb_mass=a.GetNum();this.fuel=a.GetNum();this.charge=a.GetNum();if(12.25<a.version){var b=a.GetNum();this.warnings=[];for(var c=0;c<b;c++)this.warnings.push({source:a.GetString(),warning:a.GetString(),color:WARNING_COLOR.WHITE});b=a.GetNum();this.era=[];for(c=0;c<b;c++)this.era.push({name:a.GetString(),era:a.GetString()})}}Add(a){var b=new Stats;b.liftbleed=this.liftbleed+a.liftbleed;b.wetmass=this.wetmass+a.wetmass;b.mass=this.mass+
a.mass;b.drag=this.drag+a.drag;b.control=this.control+a.control;b.cost=this.cost+a.cost;b.reqsections=this.reqsections+a.reqsections;b.visibility=this.visibility+a.visibility;b.flightstress=this.flightstress+a.flightstress;b.escape=this.escape+a.escape;b.pitchstab=this.pitchstab+a.pitchstab;b.latstab=this.latstab+a.latstab;b.cooling=this.cooling+a.cooling;b.reliability=this.reliability+a.reliability;b.power=this.power+a.power;b.fuelconsumption=this.fuelconsumption+a.fuelconsumption;b.maxstrain=this.maxstrain+
a.maxstrain;b.structure=this.structure+a.structure;b.pitchboost=this.pitchboost+a.pitchboost;b.pitchspeed=this.pitchspeed+a.pitchspeed;b.wingarea=this.wingarea+a.wingarea;b.toughness=this.toughness+a.toughness;b.upkeep=this.upkeep+a.upkeep;b.crashsafety=this.crashsafety+a.crashsafety;b.bomb_mass=this.bomb_mass+a.bomb_mass;b.fuel=this.fuel+a.fuel;b.charge=this.charge+a.charge;b.warnings=this.MergeWarnings(a.warnings);b.era=this.MergeEra(a.era);return b}MergeWarnings(a){var b=[];for(let c of this.warnings)b.push({source:c.source,
warning:c.warning,color:c.color});for(let c of a){a=!1;for(let d of this.warnings)c.source==d.source&&c.warning==d.warning&&(a=!0);a||b.push({source:c.source,warning:c.warning,color:c.color})}return b}MergeEra(a){var b=[];for(let c of this.era)b.push({name:c.name,era:c.era});for(let c of a){a=!1;for(let d of this.era)c.name==d.name&&c.era==d.era&&(a=!0);a||b.push({name:c.name,era:c.era})}return b}Multiply(a){var b=this.Clone();b.liftbleed=this.liftbleed*a;b.wetmass=this.wetmass*a;b.mass=this.mass*
a;b.drag=this.drag*a;b.control=this.control*a;b.cost=this.cost*a;b.reqsections=this.reqsections*a;b.visibility=this.visibility*a;b.flightstress=this.flightstress*a;b.escape=this.escape*a;b.pitchstab=this.pitchstab*a;b.latstab=this.latstab*a;b.cooling=this.cooling*a;b.reliability=this.reliability*a;b.power=this.power*a;b.fuelconsumption=this.fuelconsumption*a;b.maxstrain=this.maxstrain*a;b.structure=this.structure*a;b.wingarea=this.wingarea*a;b.toughness=this.toughness*a;b.upkeep=this.upkeep*a;b.crashsafety=
this.crashsafety*a;b.bomb_mass=this.bomb_mass*a;b.fuel=this.fuel*a;b.charge=this.charge*a;1E-6<Math.abs(a)&&(b.warnings=this.warnings,b.era=this.era);return b}Equal(a){return this.liftbleed==a.liftbleed&&this.wetmass==a.wetmass&&this.mass==a.mass&&this.drag==a.drag&&this.control==a.control&&this.cost==a.cost&&this.reqsections==a.reqsections&&this.visibility==a.visibility&&this.flightstress==a.flightstress&&this.escape==a.escape&&this.pitchstab==a.pitchstab&&this.latstab==a.latstab&&this.cooling==
a.cooling&&this.reliability==a.reliability&&this.power==a.power&&this.fuelconsumption==a.fuelconsumption&&this.maxstrain==a.maxstrain&&this.structure==a.structure&&this.pitchspeed==a.pitchspeed&&this.pitchboost==a.pitchboost&&this.wingarea==a.wingarea&&this.toughness==a.toughness&&this.upkeep==a.upkeep&&this.crashsafety==a.crashsafety&&this.bomb_mass==a.bomb_mass&&this.fuel==a.fuel&&this.charge==a.charge}rtz(a){return 0<a?Math.floor(1E-6+a):Math.ceil(-1E-6+a)}Round(){this.liftbleed=this.rtz(this.liftbleed);
this.wetmass=this.rtz(this.wetmass);this.mass=this.rtz(this.mass);this.drag=this.rtz(this.drag);this.control=this.rtz(this.control);this.cost=this.rtz(this.cost);this.reqsections=this.rtz(this.reqsections);this.visibility=this.rtz(this.visibility);this.flightstress=this.rtz(this.flightstress);this.escape=this.rtz(this.escape);this.pitchstab=this.rtz(this.pitchstab);this.latstab=this.rtz(this.latstab);this.cooling=this.rtz(this.cooling);this.reliability=this.rtz(this.reliability);this.power=this.rtz(this.power);
this.fuelconsumption=this.rtz(this.fuelconsumption);this.maxstrain=this.rtz(this.maxstrain);this.structure=this.rtz(this.structure);this.wingarea=this.rtz(this.wingarea);this.toughness=this.rtz(this.toughness);this.upkeep=this.rtz(this.upkeep);this.crashsafety=this.rtz(this.crashsafety);this.bomb_mass=this.rtz(this.bomb_mass);this.fuel=this.rtz(this.fuel);this.charge=this.rtz(this.charge)}Clone(){return this.Add(new Stats)}}
var era2numHh=a=>{switch(a){case "Pioneer":return 0;case "WWI":return 1;case "Roaring 20s":return 2;case "Coming Storm":return 3;case "WWII":return 4;case "Last Hurrah":return 5;case "Himmilgard":return 6}},era2numHl=a=>{switch(a){case "Pioneer":return 0;case "WWI":return 1;case "Roaring 20s":return 2;case "Coming Storm":return 3;case "WWII":return 4;case "Last Hurrah":return 5;case "Himmilgard":return-1}},num2era=a=>{switch(a){case 0:return"Pioneer";case 1:return"WWI";case 2:return"Roaring 20s";
case 3:return"Coming Storm";case 4:return"WWII";case 5:return"Last Hurrah";case 6:case -1:return"Himmilgard"}};
class Serialize{constructor(a){this.array=new ArrayBuffer(51200);this.view=new DataView(this.array);this.offset=0}Check(){if(this.offset>=this.array.byteLength)throw"Serialization Way too long.";}PushNum(a){this.view.setInt16(this.offset,a,!1);this.offset+=2;this.Check()}PushBool(a){a?this.view.setUint8(this.offset,1):this.view.setUint8(this.offset,0);this.offset+=1;this.Check()}PushString(a){this.PushNum(a.length);for(let b=0;b<a.length;b++)this.view.setUint8(this.offset,a.charCodeAt(b)),this.offset++;
this.Check()}PushNumArr(a){this.PushNum(a.length);for(let b of a)this.PushNum(b);this.Check()}PushBoolArr(a){this.PushNum(a.length);for(let b of a)this.PushBool(b);this.Check()}PushFloat(a){this.view.setFloat32(this.offset,a,!1);this.offset+=4;this.Check()}FinalArray(){return this.array.slice(0,this.offset)}}
class Deserialize{constructor(a){this.array=a;this.view=new DataView(this.array);this.offset=0;this.version=parseFloat(this.GetString());this.Reset()}Reset(){this.offset=0}Check(){if(this.offset>=this.array.byteLength)throw"Deserialization Failed";}GetNum(){this.Check();var a=this.view.getInt16(this.offset,!1);this.offset+=2;return a}GetBool(){this.Check();var a=this.view.getUint8(this.offset);this.offset+=1;return 0<a}GetString(){this.Check();var a=this.GetNum(),b=[];for(let d=0;d<a;d++){var c=this.view.getUint8(this.offset);
b.push(c);this.offset+=1}return String.fromCharCode(...b)}GetNumArr(a){this.Check();var b=this.GetNum(),c=[];for(let d=0;d<b;d++)c.push(this.GetNum());for(;c.length<a;)c.push(0);return c}GetBoolArr(a){this.Check();var b=this.GetNum(),c=[];for(let d=0;d<b;d++)c.push(this.GetBool());for(;c.length<a;)c.push(!1);return c}GetFloat(){this.Check();var a=this.view.getFloat32(this.offset,!1);this.offset+=4;return a}CheckLastNum(){return this.view.getInt16(this.array.byteLength-2,!1)}}
function NumArr(a,b){for(;a.length<b;)a.push(0);return a}function BoolArr(a,b){for(;a.length<b;)a.push(!1);return a}
class EngineList{constructor(a){this.constant=!1;this.name=a;this.list=[];var b=window.localStorage.getItem("engines."+this.name);null!=b&&this.fromJSON(JSON.parse(b));var c=window.localStorage.getItem("engines_names");b=[];c&&(b=JSON.parse(c));c=!1;for(let d of b)if(d==a){c=!0;break}c||b.push(a);window.localStorage.setItem("engines_names",JSON.stringify(b))}toJSON(){var a=[];for(let b of this.list)a.push(b.toJSON());return{name:this.name,engines:a}}fromJSON(a,b=!1){a.name&&(this.name=a.name);b&&
(this.list=[]);for(let c of a.engines)try{this.push(new EngineInputs(c),b)}catch(d){console.error(d)}}deserializeEngine(a){if(this.constant)throw"Engine List is Constant";let b=new EngineInputs;b.deserialize(a);return this.push(b)}push(a,b=!1){if(this.constant)throw"Engine List is Constant";if(b)this.remove(a);else for(b=0;b<this.length;b++)if(this.list[b].Equal(a))return b;this.list.push(a.Clone());this.list=this.list.sort((c,d)=>(""+c.name).localeCompare(d.name));window.localStorage.setItem("engines."+
this.name,JSON.stringify(this.toJSON()));return this.find(a)}get(a){return 0>a||a>=this.length?new EngineInputs:this.list[a]}get_name(a){a=this.find_name(a);return this.get(a)}get_stats(a){return 0>a||a>=this.length?new EngineStats:this.list[a].PartStats()}get_stats_name(a){a=this.find_name(a);return this.get_stats(a)}find(a){for(let b=0;b<this.length;b++)if(a.Equal(this.list[b]))return b;return-1}find_name(a){for(let b=0;b<this.length;b++)if(this.list[b].name==a)return b;return-1}remove(a){if(this.constant)throw"Engine List is Constant";
a=this.find(a);0<=a&&this.list.splice(a,1);window.localStorage.setItem("engines."+this.name,JSON.stringify(this.toJSON()))}remove_name(a){if(this.constant)throw"Engine List is Constant";a=this.find_name(a);0<=a&&this.list.splice(a,1);window.localStorage.setItem("engines."+this.name,JSON.stringify(this.toJSON()))}get length(){return this.list.length}SetConstant(){this.constant=!0}}
function SearchAllEngineLists(a){for(let b of engine_list.keys())if("Custom"!=b&&0<=engine_list.get(b).find_name(a))return b;return 0<=engine_list.get("Custom").find_name(a)?"Custom":""}var CompressorEnum;(function(a){a[a.NONE=0]="NONE";a[a.ALTITUDE_THROTTLE=1]="ALTITUDE_THROTTLE";a[a.SUPERCHARGER=2]="SUPERCHARGER";a[a.TURBOCHARGER=3]="TURBOCHARGER"})(CompressorEnum||={});
class EngineBuilder{constructor(){this.EraTable=[{name:"Pioneer",materials:3,cost:.5,maxRPM:30,powerdiv:8,fuelfactor:10},{name:"WWI",materials:2,cost:1,maxRPM:35,powerdiv:7,fuelfactor:8},{name:"Roaring 20s",materials:1.5,cost:2,maxRPM:40,powerdiv:6.8,fuelfactor:6},{name:"Coming Storm",materials:1.35,cost:2.25,maxRPM:45,powerdiv:6.6,fuelfactor:5},{name:"WWII",materials:1.25,cost:2.5,maxRPM:50,powerdiv:6.5,fuelfactor:4},{name:"Last Hurrah",materials:1,cost:3,maxRPM:50,powerdiv:6.2,fuelfactor:2}];this.CoolingTable=
[{name:"Liquid Cooled",forcefactor:1.2,RPMoff:0,thrustfactor:1,radiator:1,massfactor:1},{name:"Air Cooled",forcefactor:1,RPMoff:0,thrustfactor:1,radiator:0,massfactor:1},{name:"Rotary",forcefactor:1,RPMoff:8,thrustfactor:1.5,radiator:0,massfactor:1},{name:"Contrarotary",forcefactor:1,RPMoff:8,thrustfactor:1.25,radiator:0,massfactor:1},{name:"Semi-Radial",forcefactor:.8,RPMoff:0,thrustfactor:1,radiator:0,massfactor:1},{name:"Liquid Radial",forcefactor:1,RPMoff:0,thrustfactor:1,radiator:2.5,massfactor:1.3}];
this.CompressorTable=[{name:"None"},{name:"Altitude Throttle"},{name:"Supercharger"},{name:"Turbocharger"}];this.Upgrades=[{name:"Asperator Boost",powerfactor:.11,fuelfactor:0,massfactor:0,dragfactor:0,idealalt:-1,costfactor:3,reqsection:!1},{name:"War Emergency Power",powerfactor:0,fuelfactor:0,massfactor:0,dragfactor:0,idealalt:0,costfactor:5,reqsection:!1},{name:"Fuel Injector",powerfactor:0,fuelfactor:-.1,massfactor:0,dragfactor:0,idealalt:0,costfactor:2,reqsection:!1},{name:"Diesel",powerfactor:-.2,
fuelfactor:-.5,massfactor:0,dragfactor:0,idealalt:0,costfactor:0,reqsection:!1}];this.name="Default Name";this.cool_sel=this.era_sel=0;this.upg_sel=[...Array(this.Upgrades.length).fill(!1)];this.engine_displacement=1;this.compression_ratio=this.num_rows=this.num_cyl_per_row=2;this.quality_fudge=this.material_fudge=this.rpm_boost=1;this.compressor_type=CompressorEnum.NONE;this.min_IAF=this.compressor_count=0;this.rarity=ENGINE_RARITY.CUSTOM}CanUpgrade(){var a=[...Array(this.Upgrades.length).fill(!0)];
a[0]=!1;this.compressor_type==CompressorEnum.ALTITUDE_THROTTLE&&(a[0]=!1,a[1]=!1,a[2]=!1);return a}UpgradePower(){var a=1;for(let b=0;b<this.upg_sel.length;b++)this.upg_sel[b]&&(a+=this.Upgrades[b].powerfactor);this.upg_sel[0]&&(a*=1+this.Upgrades[0].powerfactor);return a}RPM(){return this.compression_ratio/10*(this.EraTable[this.era_sel].maxRPM-this.CoolingTable[this.cool_sel].RPMoff)}GearedRPM(){return this.RPM()*this.rpm_boost}CalcPower(){var a=this.EraTable[this.era_sel],b=this.engine_displacement*
this.compression_ratio*this.CoolingTable[this.cool_sel].forcefactor*this.UpgradePower()*(this.GearedRPM()/10);return Math.floor(1E-6+b/a.powerdiv)}UpgradeMass(){var a=1;for(let b=0;b<this.upg_sel.length;b++)this.upg_sel[b]&&(a+=this.Upgrades[b].massfactor);return a}CalcMass(){var a=this.CoolingTable[this.cool_sel];return Math.floor(1E-6+(Math.pow(this.engine_displacement,2)*this.compression_ratio/1E3+(this.engine_displacement*this.num_rows/10+1)+this.engine_displacement/5)*this.UpgradeMass()*this.material_fudge*
a.massfactor)}UpgradeDrag(){var a=1;for(let b=0;b<this.upg_sel.length;b++)this.upg_sel[b]&&(a+=this.Upgrades[b].dragfactor);return a}CoolDrag(){switch(this.CoolingTable[this.cool_sel].name){case "Liquid Cooled":return 1;case "Air Cooled":return 1;case "Rotary":return this.GearedRPM()/10;case "Contrarotary":return this.GearedRPM()/8;case "Semi-Radial":return 1;case "Liquid Radial":return 1.2}throw"Error in CoolDrag, no valid switch case.";}CalcDrag(){return Math.floor(1E-6+(3+this.engine_displacement/
this.num_rows/3)*this.CoolDrag()*this.UpgradeDrag())}CoolBurnout(){var a=this.EraTable[this.era_sel].materials/2;switch(this.CoolingTable[this.cool_sel].name){case "Liquid Cooled":return 2;case "Air Cooled":return(2+Math.pow(this.num_rows,2))*a;case "Rotary":return Math.pow(this.num_rows,2)/(this.GearedRPM()/10);case "Contrarotary":return Math.pow(this.num_rows,2)/(this.GearedRPM()/10);case "Semi-Radial":return(2+Math.pow(this.num_rows,2)/2)*a;case "Liquid Radial":return.5}throw"Error in CoolBurnout, no valid switch case.";
}MaterialModifier(){return this.engine_displacement/(this.num_cyl_per_row*this.num_rows)*this.rpm_boost*Math.pow(this.compression_ratio,2)*this.EraTable[this.era_sel].materials*this.CoolBurnout()*this.rpm_boost}IsRotary(){return"Rotary"==this.CoolingTable[this.cool_sel].name||"Contrarotary"==this.CoolingTable[this.cool_sel].name?!0:!1}CalcCooling(){return this.IsRotary()?0:Math.floor(1E-6+this.MaterialModifier()/20*this.CoolingTable[this.cool_sel].radiator)}CalcOverspeed(){return Math.round(1.5*this.RPM())}UpgradeFuel(){var a=
1;for(let b=0;b<this.upg_sel.length;b++)this.upg_sel[b]&&(a+=this.Upgrades[b].fuelfactor);return a*this.EraTable[this.era_sel].fuelfactor}CalcFuelConsumption(){var a=this.engine_displacement*this.RPM()/100;return Math.floor(1E-6+a*this.UpgradeFuel())}CalcAltitude(){var a=0;for(let b=0;b<this.upg_sel.length;b++)this.upg_sel[b]&&(a+=this.Upgrades[b].idealalt);return 10*(3+a)-1}CoolTorque(){return"Rotary"==this.CoolingTable[this.cool_sel].name?this.CalcMass():"Contrarotary"==this.CoolingTable[this.cool_sel].name?
Math.floor(1E-6+this.CalcMass()/2):1}CalcTorque(){return Math.floor(1E-6+this.CoolTorque()*this.GearedRPM()/5/4)}UpgradeCost(){var a=0;for(let b=0;b<this.upg_sel.length;b++)this.upg_sel[b]&&(a+=this.Upgrades[b].costfactor);return a}CalcCost(){var a=this.EraTable[this.era_sel],b=this.CoolingTable[this.cool_sel],c=Math.max(1,this.quality_fudge),d=this.engine_displacement*this.compression_ratio/10;d=this.UpgradeCost()+d;a=c*a.cost*d;0<b.radiator&&(a*=1.4);return Math.floor(1E-6+a)}VerifyValues(){this.engine_displacement=
Math.max(.01,this.engine_displacement);this.engine_displacement=Math.min(150,this.engine_displacement);this.era_sel=Math.max(0,Math.min(this.EraTable.length-1,this.era_sel));this.cool_sel=Math.max(0,Math.min(this.CoolingTable.length-1,this.cool_sel));this.num_cyl_per_row=Math.floor(Math.max(1,this.num_cyl_per_row));this.num_rows=Math.floor(Math.max(1,this.num_rows));this.compression_ratio=Math.max(.01,this.compression_ratio);this.compression_ratio=Math.min(25,this.compression_ratio);this.rpm_boost=
Math.max(.1,this.rpm_boost);this.rpm_boost=Math.min(2,this.rpm_boost);this.material_fudge=Math.max(.1,this.material_fudge);this.material_fudge=Math.min(2,this.material_fudge);this.quality_fudge=Math.max(.1,this.quality_fudge);for(this.quality_fudge=Math.min(2,this.quality_fudge);-.9>this.material_fudge-1+(this.quality_fudge-1);)this.material_fudge+=.1,this.quality_fudge+=.1;this.min_IAF=10*Math.round(1E-6+this.min_IAF/10);this.compressor_count=Math.floor(1E-6+this.compressor_count);this.compressor_count=
Math.min(5,this.compressor_count);this.compressor_type==CompressorEnum.NONE?this.min_IAF=this.compressor_count=0:this.compressor_type==CompressorEnum.ALTITUDE_THROTTLE?(this.compressor_count=1,this.min_IAF=0,this.upg_sel[0]=!1,this.upg_sel[1]=!1,this.upg_sel[2]=!1):(this.min_IAF=Math.max(0,this.min_IAF),this.compressor_count=Math.max(1,this.compressor_count))}EngineStats(){var a=new EngineStats;a.name=this.name;this.VerifyValues();a.stats.power=this.CalcPower();a.stats.mass=this.CalcMass();a.stats.drag=
this.CalcDrag();a.stats.reliability=Math.floor(-1.999999+this.era_sel+10*(this.quality_fudge+this.material_fudge-2));a.stats.cooling=this.CalcCooling();a.oiltank=this.IsRotary();a.overspeed=this.CalcOverspeed();a.stats.fuelconsumption=this.CalcFuelConsumption();a.altitude=this.CalcAltitude();a.torque=this.CalcTorque();a.stats.cost=this.CalcCost();a.pulsejet=!1;a.rumble=0;a.stats.era.push({name:this.name,era:lu(num2era(this.era_sel))});switch(this.compressor_type){case CompressorEnum.ALTITUDE_THROTTLE:a.stats.cost+=
3;a.altitude=49;a.stats.warnings.push({source:lu("Altitude Throttle"),warning:lu("Altitude Throttle Warning"),color:WARNING_COLOR.WHITE});break;case CompressorEnum.SUPERCHARGER:a.stats.power=Math.floor(1E-6+1.25*a.stats.power);a.stats.fuelconsumption=Math.floor(1E-6+1.25*a.stats.fuelconsumption);a.stats.mass=Math.floor(1E-6+1.2*a.stats.mass);a.stats.drag+=this.min_IAF/10;a.stats.cost+=1+Math.floor(1E-6+a.stats.power/50);var b=this.compressor_count-1;a.altitude=29+20*b;a.stats.reliability-=b;a.stats.mass+=
b;a.stats.drag+=b;a.stats.cost+=2*b;break;case CompressorEnum.TURBOCHARGER:a.stats.power=Math.floor(1E-6+1.25*a.stats.power),a.stats.mass=Math.floor(1E-6+1.2*a.stats.mass),a.stats.drag+=this.min_IAF/10*2,a.stats.cost+=1+Math.floor(1E-6+a.stats.power/50),b=this.compressor_count-1,a.altitude=49+20*b,a.stats.reliability-=b,a.stats.mass+=b,a.stats.drag+=b,a.stats.cost+=2*b,a.stats.reqsections+=1}a.stats.fuelconsumption=Math.max(1,a.stats.fuelconsumption);a.rarity=this.rarity;return a}EngineInputs(){var a=
new EngineInputs;a.engine_type=ENGINE_TYPE.PROPELLER;a.RPM_boost=this.rpm_boost;a.compression=this.compression_ratio;a.compressor_count=this.compressor_count;a.compressor_type=this.compressor_type;a.cyl_per_row=this.num_cyl_per_row;a.displacement=this.engine_displacement;a.era_sel=this.era_sel;a.material_fudge=this.material_fudge;a.min_IdealAlt=this.min_IAF;a.name=this.name;a.quality_fudge=this.quality_fudge;a.rows=this.num_rows;a.type=this.cool_sel;for(let b=0;b<a.upgrades.length;b++)a.upgrades[b]=
this.upg_sel[b];a.rarity=this.rarity;return a}fromJSON(a){this.engine_displacement=a.displacement;this.compression_ratio=a.compression;this.cool_sel=a.type;this.num_cyl_per_row=a.cyl_per_row;this.num_rows=a.rows;this.rpm_boost=a.RPM_boost;this.era_sel=a.era_sel;this.material_fudge=a.material_fudge;this.quality_fudge=a.quality_fudge;this.compressor_type=a.compressor_type;this.compressor_count=a.compressor_count;this.min_IAF=a.min_IAF;this.upg_sel=BoolArr(a.upgrades,this.upg_sel.length);this.rarity=
a.rarity?a.rarity:ENGINE_RARITY.CUSTOM;return this.EngineStats()}}
class PulsejetBuilder{constructor(){this.EraTable=[{name:"Pioneer",cost:1,drag:10,mass:10,fuel:4,vibe:2.5,material:2},{name:"WWI",cost:.75,drag:25,mass:24,fuel:3,vibe:3,material:3},{name:"Roaring 20s",cost:.5,drag:30,mass:50,fuel:2,vibe:4,material:9},{name:"Coming Storm",cost:.5,drag:30,mass:50,fuel:2,vibe:4,material:9},{name:"WWII",cost:.25,drag:40,mass:100,fuel:1,vibe:5,material:24},{name:"Last Hurrah",cost:.1,drag:50,mass:150,fuel:.7,vibe:6,material:50}];this.ValveTable=[{name:"Valved",scale:1,
rumble:1,designcost:2,reliability:1},{name:"Valveless",scale:1.1,rumble:.9,designcost:1,reliability:3}];this.desired_power=1;this.era_sel=this.valve_sel=0;this.overall_quality=this.build_quality=1;this.starter=!1;this.rarity=ENGINE_RARITY.CUSTOM}TempMass(){var a=this.EraTable[this.era_sel],b=this.ValveTable[this.valve_sel],c=0;this.starter&&(c=1);return this.technical_power/a.mass*b.scale+c}CalcMass(){return Math.floor(1E-6+this.TempMass())+1}CalcDrag(){var a=this.technical_power/this.EraTable[this.era_sel].drag*
this.ValveTable[this.valve_sel].scale+1;return Math.floor(1E-6+this.TempMass()+a+1)}CalcReliability(){return Math.trunc(-(this.technical_power/(this.EraTable[this.era_sel].material*this.ValveTable[this.valve_sel].reliability*this.overall_quality)-1))}CalcFuelConsumption(){return Math.floor(1E-6+this.technical_power*this.EraTable[this.era_sel].fuel)}CalcRumble(){return Math.floor(1E-6+this.technical_power*this.ValveTable[this.valve_sel].rumble/(2*this.EraTable[this.era_sel].vibe))}CalcCost(){var a=
this.EraTable[this.era_sel];return Math.floor(1E-6+this.TempMass()*this.build_quality*a.cost)+1}VerifyValues(){this.desired_power=Math.max(1,Math.floor(this.desired_power));this.valve_sel=Math.max(0,Math.min(this.ValveTable.length-1,this.valve_sel));this.era_sel=Math.max(0,Math.min(this.EraTable.length-1,this.era_sel));this.build_quality=Math.max(.01,this.build_quality);this.overall_quality=Math.max(.01,this.overall_quality);this.overall_quality=this.build_quality=Math.max(this.build_quality,this.overall_quality)}DesignCost(){var a=
this.EraTable[this.era_sel],b=this.ValveTable[this.valve_sel],c=0;this.starter&&(c=3);return Math.floor(1.000001+this.build_quality*(this.technical_power*a.cost/b.designcost+c))}EngineInputs(){var a=new EngineInputs,b="";0==this.valve_sel&&(b="V");a.name="Pulsejet P"+b+"-"+this.desired_power.toString()+" ("+this.EraTable[this.era_sel].name+")";a.engine_type=ENGINE_TYPE.PULSEJET;a.era_sel=this.era_sel;a.type=this.valve_sel;a.power=this.desired_power;a.starter=this.starter;a.quality_cost=this.build_quality;
a.quality_rely=this.overall_quality;a.rarity=this.rarity;return a}EngineStats(){var a=new EngineStats;this.VerifyValues();var b="";0==this.valve_sel&&(b="V");a.name="Pulsejet P"+b+"-"+this.desired_power.toString()+" ("+this.EraTable[this.era_sel].name+")";this.technical_power=a.stats.power=this.desired_power;a.stats.mass=this.CalcMass();a.stats.drag=this.CalcDrag();a.stats.reliability=this.CalcReliability();a.stats.fuelconsumption=this.CalcFuelConsumption();a.rumble=this.CalcRumble();a.stats.cost=
this.CalcCost();a.overspeed=100;a.altitude=29;a.pulsejet=!0;a.stats.era.push({name:a.name,era:lu(num2era(this.era_sel))});a.rarity=this.rarity;return a}}
class TurboBuilder{constructor(){this.TypeTable=[{name:"Turbojet",efficiency:0,massfactor:.8,costfactor:1},{name:"Turbofan",efficiency:0,massfactor:1,costfactor:1},{name:"Propfan",efficiency:-9,massfactor:.8,costfactor:1},{name:"Turboprop",efficiency:-3,massfactor:.8,costfactor:1}];this.EraTable=[{name:"Gen 1 1945-1955",max_temp:1100,efficiency:-2,costfactor:.5},{name:"Gen 1.5 1955-1965",max_temp:1100,efficiency:-1,costfactor:.6},{name:"Gen 2 1965-1975",max_temp:1400,efficiency:-1,costfactor:.7},
{name:"Gen 2.5 1975-1985",max_temp:1400,efficiency:0,costfactor:.8},{name:"Gen 3 1985-1995",max_temp:1800,efficiency:0,costfactor:.9},{name:"Gen 3.5 1995-2005",max_temp:1800,efficiency:1,costfactor:1},{name:"Gen 4 2005-2015",max_temp:2E3,efficiency:1,costfactor:1.1},{name:"Gen 4.5 2015-2025",max_temp:2E3,efficiency:2,costfactor:1.2},{name:"Gen 0 Himmilgard",max_temp:800,efficiency:-10,costfactor:.5}];this.name="Default";this.type_sel=this.era_sel=0;this.fuel_heat_value=43020;this.flow_adjustment=
0;this.diameter=.89;this.compression_ratio=3.5;this.bypass_ratio=0;this.afterburner=!1;this.rarity=ENGINE_RARITY.CUSTOM}TempMass(){return Math.log2(this.compression_ratio)*Math.PI*Math.pow(this.diameter/2,2)*633.0625/(1+this.bypass_ratio/3)*.75*this.TypeTable[this.type_sel].massfactor}CalcMass(){var a=this.TempMass();1==this.type_sel&&(a*=.4833*Math.log(this.compression_ratio)-.3168);a=a/25+95.684*this.flow_adjustment;if(2==this.type_sel||3==this.type_sel){var b=.5-this.flow_adjustment;a=Math.abs(a)*
(19.74*Math.pow(b,3)-11.462*b*b+1.0666*b+.4333)}return Math.max(1,Math.floor(1E-6+a))}CalcDrag(){return Math.floor(1E-6+5*Math.PI*Math.pow(this.diameter/2,2))}CalcReliability(){return Math.trunc(-Math.log2(this.compression_ratio)-20*this.flow_adjustment+1)}CalcStages(){var a=this.EraTable[this.era_sel];const b=.8+(a.efficiency+this.TypeTable[this.type_sel].efficiency)/20+this.flow_adjustment;var c=1+(1.4-1)/2*0,d=a.max_temp/288.15,e=Math.pow(this.compression_ratio,1-1/1.4),f=289.8789/this.fuel_heat_value*
(a.max_temp/288.15-288.15*Math.pow(108.9*this.compression_ratio/108.9,(1.4-1)/1.4)/288.15);c=340.3*(Math.sqrt(2*c/(1.4-1)*(d/(c*e)-1)*(e-1)+d/(c*e)*0)-0)*b/1E3/(1+this.bypass_ratio)+340.3*(Math.sqrt(2/(1.4-1)*(c*Math.pow(1.6,1-1/1.4)-1))-0)*b/1E3*this.bypass_ratio/(1+this.bypass_ratio);d=f/((1+this.bypass_ratio)*c)*1E3;f=108.9*Math.PI*Math.pow(this.diameter/2,2)*this.MFP(1)/(1+f);a=this.compression_ratio*f*Math.sqrt(1/a.max_temp)*b;if(!isFinite(c)||!isFinite(a)||!isFinite(d)||0>c||0>a||0>d)d=a=c=
0;return{thrust:c*a,fuel:d*c*a}}MFP(a){return Math.sqrt(1.4/.287058)*a*Math.pow(1+(1.4-1)/2*a*a,2.4/(2*(1.4-1)))}CalcCost(){var a=this.EraTable[this.era_sel],b=this.TypeTable[this.type_sel];return Math.floor(1E-6+.5*this.TempMass()*(1+this.flow_adjustment)*a.costfactor*b.costfactor)+1}VerifyValues(){this.era_sel=Math.max(0,Math.min(this.EraTable.length-1,this.era_sel));this.type_sel=Math.max(0,Math.min(this.TypeTable.length-1,this.type_sel));this.flow_adjustment=Math.max(-.5,Math.min(.5,this.flow_adjustment));
this.diameter=Math.max(.1,this.diameter);this.compression_ratio=Math.max(1,this.compression_ratio);this.bypass_ratio=Math.max(0,this.bypass_ratio);this.bypass_ratio=Math.min(20,this.bypass_ratio);2<this.type_sel&&(this.afterburner=!1)}EngineInputs(){var a=new EngineInputs;a.name=this.name;a.engine_type=ENGINE_TYPE.TURBOMACHINERY;a.era_sel=this.era_sel;a.type=this.type_sel;a.flow_adjustment=this.flow_adjustment;a.diameter=this.diameter;a.compression_ratio=this.compression_ratio;a.bypass_ratio=this.bypass_ratio;
a.upgrades[0]=this.afterburner;a.rarity=this.rarity;return a}GetPitchSpeed(){return 8<=this.bypass_ratio?1:3.5<=this.bypass_ratio?1.1:1<=this.bypass_ratio?1.2:1.3}EngineStats(){var a=new EngineStats;this.VerifyValues();var b=this.CalcStages();this.kN=b.thrust;this.tsfc=b.fuel/b.thrust;a.name=this.name;a.stats.power=Math.round(1E3*b.thrust/89);a.stats.mass=this.CalcMass();a.stats.drag=this.CalcDrag();a.stats.reliability=this.CalcReliability();a.stats.fuelconsumption=Math.round(200*b.fuel/1E3);a.rumble=
0;a.stats.cost=this.CalcCost();a.overspeed=100;a.altitude=59;8==this.era_sel?a.stats.era.push({name:a.name,era:lu(num2era(-1))}):a.stats.era.push({name:a.name,era:lu(num2era(5))});a.stats.pitchspeed=this.GetPitchSpeed();a.rarity=this.rarity;return a}}var ENGINE_TYPE;(function(a){a[a.PROPELLER=0]="PROPELLER";a[a.PULSEJET=1]="PULSEJET";a[a.TURBOMACHINERY=2]="TURBOMACHINERY";a[a.ELECTRIC=3]="ELECTRIC"})(ENGINE_TYPE||={});var ENGINE_RARITY;
(function(a){a[a.CUSTOM=0]="CUSTOM";a[a.COMMON=1]="COMMON";a[a.RARE=2]="RARE";a[a.LEGENDARY=3]="LEGENDARY"})(ENGINE_RARITY||={});
class EngineInputs{constructor(a){this.name="Default";this.engine_type=ENGINE_TYPE.PROPELLER;this.era_sel=this.type=0;this.rarity=ENGINE_RARITY.CUSTOM;this.min_IdealAlt=this.compressor_count=this.compressor_type=this.quality_fudge=this.material_fudge=this.RPM_boost=this.rows=this.cyl_per_row=this.compression=this.displacement=0;this.upgrades=[...Array(4).fill(!1)];this.quality_rely=this.quality_cost=this.power=0;this.starter=!1;this.winding_sel=this.bypass_ratio=this.compression_ratio=this.diameter=
this.flow_adjustment=0;a&&this.fromJSON(a)}toJSON(){switch(this.engine_type){case ENGINE_TYPE.PROPELLER:return{name:this.name,engine_type:this.engine_type,type:this.type,era_sel:this.era_sel,displacement:this.displacement,compression:this.compression,cyl_per_row:this.cyl_per_row,rows:this.rows,RPM_boost:this.RPM_boost,material_fudge:this.material_fudge,quality_fudge:this.quality_fudge,compressor_type:this.compressor_type,compressor_count:this.compressor_count,min_IAF:this.min_IdealAlt,upgrades:this.upgrades,
rarity:this.rarity};case ENGINE_TYPE.PULSEJET:return{name:this.name,engine_type:this.engine_type,type:this.type,era_sel:this.era_sel,power:this.power,quality_cost:this.quality_cost,quality_rely:this.quality_rely,starter:this.starter,rarity:this.rarity};case ENGINE_TYPE.TURBOMACHINERY:return{name:this.name,engine_type:this.engine_type,type:this.type,era_sel:this.era_sel,flow_adjustment:this.flow_adjustment,diameter:this.diameter,compression_ratio:this.compression_ratio,bypass_ratio:this.bypass_ratio,
upgrades:this.upgrades,rarity:this.rarity};case ENGINE_TYPE.ELECTRIC:return{name:this.name,engine_type:this.engine_type,power:this.power,era_sel:this.era_sel,winding_sel:this.winding_sel,diameter:this.diameter,material_fudge:this.material_fudge,quality_fudge:this.quality_fudge};default:throw"EngineInputs.toJSON: Oh dear, you have a new engine type.";}}fromJSON(a){this.name=a.name;this.engine_type=a.engine_type;this.type=a.type;this.era_sel=a.era_sel;switch(this.engine_type){case ENGINE_TYPE.PROPELLER:this.displacement=
a.displacement;this.compression=a.compression;this.cyl_per_row=a.cyl_per_row;this.rows=a.rows;this.RPM_boost=a.RPM_boost;this.material_fudge=a.material_fudge;this.quality_fudge=a.quality_fudge;this.compressor_type=a.compressor_type;this.compressor_count=a.compressor_count;this.min_IdealAlt=a.min_IAF;this.upgrades=BoolArr(a.upgrades,this.upgrades.length);break;case ENGINE_TYPE.PULSEJET:this.power=a.power;this.quality_cost=a.quality_cost;this.quality_rely=a.quality_rely;this.starter=a.starter;break;
case ENGINE_TYPE.TURBOMACHINERY:this.flow_adjustment=a.flow_adjustment;this.diameter=a.diameter;this.compression_ratio=a.compression_ratio;this.bypass_ratio=a.bypass_ratio;this.upgrades=a.upgrades;break;case ENGINE_TYPE.ELECTRIC:this.power=a.power;this.winding_sel=a.winding_sel;this.material_fudge=a.material_fudge;this.quality_fudge=a.quality_fudge;break;default:throw"EngineInputs.fromJSON: Oh dear, you have a new engine type.";}this.rarity=a.rarity?a.rarity:ENGINE_RARITY.CUSTOM}serialize(a){a.PushString(this.name);
a.PushNum(this.engine_type);a.PushNum(this.type);a.PushNum(this.era_sel);switch(this.engine_type){case ENGINE_TYPE.PROPELLER:a.PushFloat(this.displacement);a.PushFloat(this.compression);a.PushNum(this.cyl_per_row);a.PushNum(this.rows);a.PushFloat(this.RPM_boost);a.PushFloat(this.material_fudge);a.PushFloat(this.quality_fudge);a.PushNum(this.compressor_type);a.PushNum(this.compressor_count);a.PushNum(this.min_IdealAlt);a.PushBoolArr(this.upgrades);break;case ENGINE_TYPE.PULSEJET:a.PushNum(this.power);
a.PushFloat(this.quality_cost);a.PushFloat(this.quality_rely);a.PushBool(this.starter);break;case ENGINE_TYPE.TURBOMACHINERY:a.PushFloat(this.flow_adjustment);a.PushFloat(this.diameter);a.PushFloat(this.compression_ratio);a.PushFloat(this.bypass_ratio);a.PushBoolArr(this.upgrades);break;case ENGINE_TYPE.ELECTRIC:a.PushNum(this.power);a.PushNum(this.winding_sel);a.PushNum(this.material_fudge);a.PushFloat(this.quality_fudge);break;default:throw"EngineInputs.serialize: Oh dear, you have a new engine type.";
}a.PushNum(this.rarity)}deserialize(a){this.name=a.GetString();this.engine_type=a.GetNum();this.type=a.GetNum();this.era_sel=a.GetNum();switch(this.engine_type){case ENGINE_TYPE.PROPELLER:this.displacement=a.GetFloat();this.compression=a.GetFloat();this.cyl_per_row=a.GetNum();this.rows=a.GetNum();this.RPM_boost=a.GetFloat();this.material_fudge=a.GetFloat();this.quality_fudge=a.GetFloat();this.compressor_type=a.GetNum();this.compressor_count=a.GetNum();this.min_IdealAlt=a.GetNum();this.upgrades=a.GetBoolArr(this.upgrades.length);
break;case ENGINE_TYPE.PULSEJET:this.power=a.GetNum();this.quality_cost=a.GetFloat();this.quality_rely=a.GetFloat();this.starter=a.GetBool();break;case ENGINE_TYPE.TURBOMACHINERY:this.flow_adjustment=a.GetFloat();this.diameter=a.GetFloat();this.compression_ratio=a.GetFloat();this.bypass_ratio=a.GetFloat();this.upgrades=a.GetBoolArr(this.upgrades.length);break;case ENGINE_TYPE.ELECTRIC:this.power=a.GetNum();this.winding_sel=a.GetNum();this.material_fudge=a.GetNum();this.quality_fudge=a.GetFloat();
break;default:throw"EngineInputs.deserialize: Oh dear, you have a new engine type.";}this.rarity=12.35<a.version?a.GetNum():ENGINE_RARITY.CUSTOM}PartStats(){switch(this.engine_type){case ENGINE_TYPE.PROPELLER:var a=new EngineBuilder;a.name=this.name;a.cool_sel=this.type;a.era_sel=this.era_sel;a.engine_displacement=this.displacement;a.compression_ratio=this.compression;a.num_cyl_per_row=this.cyl_per_row;a.num_rows=this.rows;a.rpm_boost=this.RPM_boost;a.material_fudge=this.material_fudge;a.quality_fudge=
this.quality_fudge;a.compressor_type=this.compressor_type;a.compressor_count=this.compressor_count;a.min_IAF=this.min_IdealAlt;a.upg_sel=this.upgrades;a.rarity=this.rarity;return a.EngineStats();case ENGINE_TYPE.PULSEJET:return a=new PulsejetBuilder,a.valve_sel=this.type,a.era_sel=this.era_sel,a.desired_power=this.power,a.build_quality=this.quality_cost,a.overall_quality=this.quality_rely,a.starter=this.starter,a.rarity=this.rarity,a=a.EngineStats(),this.name=a.name,a;case ENGINE_TYPE.TURBOMACHINERY:return a=
new TurboBuilder,a.type_sel=this.type,a.era_sel=this.era_sel,a.flow_adjustment=this.flow_adjustment,a.diameter=this.diameter,a.compression_ratio=this.compression_ratio,a.bypass_ratio=this.bypass_ratio,a.afterburner=this.upgrades[0],a.name=this.name,a.rarity=this.rarity,a.EngineStats();case ENGINE_TYPE.ELECTRIC:return a=new ElectricBuilder,a.era_sel=this.era_sel,a.winding_sel=this.winding_sel,a.power=this.power,a.chonk=this.material_fudge,a.quality_fudge=this.quality_fudge,a.name=this.name,a.EngineStats();
default:throw"EngineInputs.PartStats: Oh dear, you have a new engine type.";}}Equal(a){return this.name==a.name}Clone(){var a=new EngineInputs;a.name=this.name;a.engine_type=this.engine_type;a.type=this.type;a.era_sel=this.era_sel;a.displacement=this.displacement;a.compression=this.compression;a.cyl_per_row=this.cyl_per_row;a.rows=this.rows;a.RPM_boost=this.RPM_boost;a.material_fudge=this.material_fudge;a.quality_fudge=this.quality_fudge;a.compressor_type=this.compressor_type;a.compressor_count=this.compressor_count;
a.min_IdealAlt=this.min_IdealAlt;a.power=this.power;a.quality_cost=this.quality_cost;a.quality_rely=this.quality_rely;a.starter=this.starter;for(let b=0;b<this.upgrades.length;b++)a.upgrades[b]=this.upgrades[b];a.flow_adjustment=this.flow_adjustment;a.diameter=this.diameter;a.compression_ratio=this.compression_ratio;a.bypass_ratio=this.bypass_ratio;a.winding_sel=this.winding_sel;a.rarity=this.rarity;return a}}var DRIVE_TYPE;
(function(a){a[a.PROPELLER=0]="PROPELLER";a[a.TURBINE=1]="TURBINE";a[a.PULSEJET=2]="PULSEJET"})(DRIVE_TYPE||={});
class EngineStats{constructor(a){this.name="Default";this.rumble=this.torque=this.altitude=this.overspeed=0;this.pulsejet=this.oiltank=!1;this.stats=new Stats;this.rarity=ENGINE_RARITY.CUSTOM;a&&this.fromJSON(a)}toJSON(){return Object.assign({name:this.name,overspeed:this.overspeed,altitude:this.altitude,torque:this.torque,rumble:this.rumble,oiltank:this.oiltank,pulsejet:this.pulsejet,rarity:this.rarity},this.stats.toJSON())}fromJSON(a,b){a.name&&(this.name=a.name);a.overspeed&&(this.overspeed=a.overspeed);
a.altitude&&(this.altitude=a.altitude);a.torque&&(this.torque=a.torque);a.rumble&&(this.rumble=a.rumble);a.oiltank&&(this.oiltank=a.oiltank);a.pulsejet&&(this.pulsejet=a.pulsejet);a.rarity&&(this.rarity=a.rarity);this.stats=new Stats(a)}serialize(a){a.PushString(this.name);a.PushNum(this.overspeed);a.PushNum(this.altitude);a.PushNum(this.torque);a.PushNum(this.rumble);a.PushBool(this.oiltank);a.PushBool(this.pulsejet);a.PushNum(this.rarity);this.stats.serialize(a)}deserialize(a){this.name=a.GetString();
this.overspeed=a.GetNum();this.altitude=a.GetNum();this.torque=a.GetNum();this.rumble=a.GetNum();this.oiltank=a.GetBool();this.pulsejet=a.GetBool();12.35<a.version&&(this.rarity=a.GetNum());this.stats.deserialize(a)}Clone(){var a=new EngineStats;a.fromJSON(JSON.parse(JSON.stringify(this.toJSON())));return a}Equal(a){return this.stats.Equal(a.stats)&&this.overspeed==a.overspeed&&this.altitude==a.altitude&&this.torque==a.torque&&this.rumble==a.rumble&&this.oiltank==a.oiltank&&this.pulsejet==a.pulsejet&&
this.rarity==a.rarity}Verify(){this.oiltank&&(this.stats.cooling=0);this.PulseJetCheck()}PulseJetCheck(){this.pulsejet?(this.stats.cooling=0,this.overspeed=100,this.altitude=3,this.torque=0):this.rumble=0}}
class ElectricBuilder{constructor(){this.EraTable=[{name:"Pioneer",draw:3,drawfactor:.4,massfactor:.4,reliability:-1,costfactor:.4,overspeed:20},{name:"WWI",draw:1,drawfactor:.4,massfactor:1/3,reliability:0,costfactor:1/2.25,overspeed:25},{name:"Roaring 20s",draw:1,drawfactor:2/7,massfactor:2/7,reliability:1,costfactor:.5,overspeed:30},{name:"Coming Storm",draw:0,drawfactor:2/7,massfactor:.25,reliability:2,costfactor:1/1.9,overspeed:35},{name:"WWII",draw:0,drawfactor:.25,massfactor:.2,reliability:3,
costfactor:1/1.8,overspeed:40},{name:"Last Hurrah",draw:0,drawfactor:.2,massfactor:1/6,reliability:4,costfactor:1/1.75,overspeed:45}];this.Winding=[{name:"Aluminum",drawmod:1.1,mass:-2,drag:1,costfactor:1,reliabilty:0},{name:"Copper",drawmod:1,mass:0,drag:0,costfactor:1,reliabilty:0},{name:"Silver",drawmod:.95,mass:1,drag:0,costfactor:1.1,reliabilty:0},{name:"Electrum",drawmod:.9,mass:2,drag:0,costfactor:1.3,reliabilty:1},{name:"Platinum",drawmod:.75,mass:3,drag:0,costfactor:2,reliabilty:2},{name:"Screamer Sinew",
drawmod:.9,mass:0,drag:1,costfactor:1.75,reliabilty:4},{name:"Lightning Sprite Ephemera",drawmod:.5,mass:-2,drag:-2,costfactor:2,reliabilty:-3}];this.name="Default";this.winding_sel=this.era_sel=0;this.quality_fudge=this.chonk=this.power=1}EraMass(){return Math.floor(1E-6+this.EraTable[this.era_sel].massfactor*this.power)}CalcMass(){var a=this.Winding[this.winding_sel];return Math.max(0,Math.floor(1E-6+this.EraMass()+a.mass))}CalcDrag(){return Math.max(1,Math.floor(1.000001+this.power/10+this.chonk+
this.Winding[this.winding_sel].drag))}CalcOverspeed(){return Math.ceil(-1E-6+this.EraTable[this.era_sel].overspeed-this.chonk/2+7.5*(this.quality_fudge-1))}CalcDraw(){var a=this.EraTable[this.era_sel];return Math.ceil(-1E-6+(a.draw+Math.ceil(-1E-6+this.power*a.drawfactor))*this.Winding[this.winding_sel].drawmod)}CalcReliability(){return Math.trunc(1E-6+this.EraTable[this.era_sel].reliability+this.chonk-this.power/10+5*(this.quality_fudge-1))+this.Winding[this.winding_sel].reliabilty}CalcTorque(){var a=
1+this.EraMass()/10+this.chonk/4;return Math.max(1,Math.floor(1E-6+a))}CalcCost(){return Math.ceil(-1E-6+Math.ceil(-1E-6+this.EraTable[this.era_sel].costfactor*this.power*Math.max(.5,this.quality_fudge))*this.Winding[this.winding_sel].costfactor)}VerifyValues(){this.era_sel=Math.max(0,Math.min(this.EraTable.length-1,this.era_sel));this.winding_sel=Math.max(0,Math.min(this.Winding.length-1,this.winding_sel));this.power=Math.max(1,this.power);this.power=Math.floor(1E-6+this.power);this.chonk=Math.floor(1E-6+
this.chonk);this.chonk=Math.max(-10,this.chonk);this.chonk=Math.min(10,this.chonk);this.quality_fudge=Math.max(.5,this.quality_fudge);this.quality_fudge=Math.min(2,this.quality_fudge)}EngineStats(){var a=new EngineStats;a.name=this.name;this.VerifyValues();a.stats.power=this.power;a.stats.mass=this.CalcMass();a.stats.drag=this.CalcDrag();a.stats.reliability=this.CalcReliability();a.stats.cooling=0;a.oiltank=!1;a.overspeed=this.CalcOverspeed();a.stats.fuelconsumption=0;a.stats.charge=-this.CalcDraw();
a.altitude=100;a.torque=this.CalcTorque();a.stats.cost=this.CalcCost();a.pulsejet=!1;a.rumble=0;a.stats.era.push({name:this.name,era:lu(num2era(this.era_sel))});return a}EngineInputs(){var a=new EngineInputs;a.engine_type=ENGINE_TYPE.ELECTRIC;a.name=this.name;a.power=this.power;a.era_sel=this.era_sel;a.winding_sel=this.winding_sel;a.material_fudge=this.chonk;a.quality_fudge=this.quality_fudge;return a}}var internal_id=0;
function download(a,b,c){a=new Blob([a],{type:c});var d=document.createElement("a"),e=URL.createObjectURL(a);d.href=e;d.download=b;document.body.appendChild(d);d.click();setTimeout(function(){document.body.removeChild(d);window.URL.revokeObjectURL(e)},0)}
function copyStringToClipboard(a){var b=document.createElement("textarea");b.value=a;b.setAttribute("readonly","");b.style.position="absolute";b.style.left="-9999px";document.body.appendChild(b);b.select();document.execCommand("copy");document.body.removeChild(b)}function GenerateID(){internal_id++;return"internal_id_"+internal_id.toString()}
function CreateFlexSection(a){var b={div0:document.createElement("DIV"),div1:document.createElement("DIV"),div2:document.createElement("DIV")};b.div0.classList.add("flex-container-o");b.div1.classList.add("flex-container-i");b.div2.classList.add("flex-container-i");b.div0.appendChild(b.div1);b.div0.appendChild(b.div2);a.appendChild(b.div0);return b}function CreateTH(a,b){var c=document.createElement("TH");c.innerHTML=b;a.appendChild(c);return c}
function CreateTD(a,b){var c=document.createElement("TD");c.innerHTML=b;a.appendChild(c);return c}function CreateInput(a,b,c,d=!0){var e=document.createElement("SPAN"),f=document.createElement("LABEL");b.id=GenerateID();f.htmlFor=b.id;f.style.marginLeft="0.25em";f.style.marginRight="0.5em";f.textContent=a;b.setAttribute("type","number");b.min="0";b.step="1";b.valueAsNumber=0;e.appendChild(f);e.appendChild(b);c.appendChild(e);d&&c.appendChild(document.createElement("BR"))}
function FlexInput(a,b,c){var d=document.createElement("LABEL");b.id=GenerateID();d.htmlFor=b.id;d.style.marginLeft="0.25em";d.style.marginRight="0.5em";d.textContent=a;b.setAttribute("type","number");b.min="0";b.step="1";b.valueAsNumber=0;d.classList.add("flex-item");b.classList.add("flex-item");c.div1.appendChild(d);c.div2.appendChild(b)}
function FlexText(a,b,c){var d=document.createElement("LABEL");b.id=GenerateID();d.htmlFor=b.id;d.style.marginLeft="0.25em";d.style.marginRight="0.5em";d.textContent=a;b.setAttribute("type","text");b.value="Default";d.classList.add("flex-item");b.classList.add("flex-item");c.div1.appendChild(d);c.div2.appendChild(b)}
function FlexDisplay(a,b,c){var d=document.createElement("LABEL");b.id=GenerateID();d.htmlFor=b.id;d.style.marginLeft="0.25em";d.style.marginRight="0.5em";d.textContent=a;d.classList.add("flex-item");b.classList.add("flex-item");c.div1.appendChild(d);c.div2.appendChild(b)}
function FlexSelect(a,b,c){var d=document.createElement("LABEL");b.id=GenerateID();d.htmlFor=b.id;d.style.marginLeft="0.25em";d.style.marginRight="0.5em";d.textContent=a;d.classList.add("flex-item");b.classList.add("flex-item");c.div1.appendChild(d);c.div2.appendChild(b)}
function CreateCheckbox(a,b,c,d=!0){var e=document.createElement("SPAN"),f=document.createElement("LABEL");b.id=GenerateID();f.htmlFor=b.id;f.style.marginLeft="0.25em";f.style.marginRight="0.5em";f.textContent=a;b.setAttribute("type","checkbox");e.appendChild(f);e.appendChild(b);c.appendChild(e);d&&c.appendChild(document.createElement("BR"))}
function CreateSelect(a,b,c,d=!0){var e=document.createElement("SPAN"),f=document.createElement("LABEL");b.id=GenerateID();f.htmlFor=b.id;f.style.marginLeft="0.25em";f.style.marginRight="0.5em";f.textContent=a;e.appendChild(f);e.appendChild(b);c.appendChild(e);d&&c.appendChild(document.createElement("BR"))}
function CreateText(a,b,c,d=!0){var e=document.createElement("SPAN"),f=document.createElement("LABEL");b.id=GenerateID();f.htmlFor=b.id;f.style.marginLeft="0.25em";f.style.marginRight="0.5em";f.textContent=a;b.setAttribute("type","text");b.value="Default";e.appendChild(f);e.appendChild(b);c.appendChild(e);d&&c.appendChild(document.createElement("BR"))}
function CreateButton(a,b,c,d=!0){var e=document.createElement("SPAN"),f=document.createElement("LABEL");b.hidden=!0;b.id=GenerateID();b.textContent=a;f.htmlFor=b.id;f.style.marginLeft="0.25em";f.style.marginRight="0.5em";f.textContent=a;f.classList.add("lbl_action");f.classList.add("btn_th");e.appendChild(f);e.appendChild(b);c.appendChild(e);d&&(c.appendChild(document.createElement("BR")),c.appendChild(document.createElement("BR")))}
function FlexCheckbox(a,b,c){var d=document.createElement("LABEL");b.id=GenerateID();d.htmlFor=b.id;d.id=GenerateID();d.style.marginLeft="0.25em";d.style.marginRight="0.5em";d.textContent=a;b.setAttribute("type","checkbox");d.classList.add("flex-item");b.classList.add("flex-item");c.div1.appendChild(d);a=document.createElement("LABEL");var e=document.createElement("SPAN");e.appendChild(a);e.appendChild(b);c.div2.appendChild(e);return d}
function FlexLabel(a,b){var c=document.createElement("LABEL");c.style.marginLeft="0.25em";c.style.marginRight="0.5em";c.textContent=a;c.classList.add("flex-item");b.appendChild(c);return c}
function FlexLabels(a,b,c){var d=document.createElement("LABEL");d.style.marginLeft="0.25em";d.style.marginRight="0.5em";d.textContent=a;d.classList.add("flex-item");c.div1.appendChild(d);a=document.createElement("LABEL");a.style.marginLeft="0.25em";a.style.marginRight="0.5em";a.textContent=b;a.classList.add("flex-item");c.div2.appendChild(a);return[d,a]}
function FlexSpace(a){var b=document.createElement("LABEL");b.textContent=" ";b.classList.add("flex-item");a.div1.appendChild(b);b=document.createElement("LABEL");b.textContent=" ";b.classList.add("flex-item");a.div2.appendChild(b)}function insertRow(a){var b=document.createElement("TR");a.append(b);return b}function insertCell(a){var b=document.createElement("TD");a.append(b);return b}
function BlinkBad(a){a.classList.toggle("changed_b",!1);a.classList.toggle("changed_g",!1);a.classList.toggle("changed_n",!1);a.offsetHeight;a.classList.toggle("changed_b")}function BlinkGood(a){a.classList.toggle("changed_b",!1);a.classList.toggle("changed_g",!1);a.classList.toggle("changed_n",!1);a.offsetHeight;a.classList.toggle("changed_g")}
function BlinkNeutral(a){a.classList.toggle("changed_b",!1);a.classList.toggle("changed_g",!1);a.classList.toggle("changed_n",!1);a.offsetHeight;a.classList.toggle("changed_n")}function BlinkNone(a){a.classList.toggle("changed_b",!1);a.classList.toggle("changed_g",!1);a.classList.toggle("changed_n",!1)}
function BlinkIfChanged(a,b,c=null){if(enable_anim)if(a.textContent!=b)if(null==c)BlinkNeutral(a);else{var d=parseInt(a.textContent)<parseInt(b);c&&d||!c&&!d?BlinkGood(a):BlinkBad(a)}else BlinkNone(a);a.textContent=b}function _arrayBufferToString(a){var b="";a=new Uint8Array(a);for(var c=a.byteLength,d=0;d<c;d++)b+=String.fromCharCode(a[d]);return b}function _stringToArrayBuffer(a){var b=new Uint8Array(a.length);for(let c=0;c<a.length;c++)b[c]=a.charCodeAt(c);return b.buffer}
const loadJSON=(a,b)=>{let c=new XMLHttpRequest;c.overrideMimeType("application/json");c.open("GET",a,!0);c.onreadystatechange=()=>{4===c.readyState&&200===c.status&&b(c.responseText)};c.send(null)};
var LZString=function(){function a(e,f){if(!c[e]){c[e]={};for(var h=0;h<e.length;h++)c[e][e.charAt(h)]=h}return c[e][f]}var b=String.fromCharCode,c={},d={compressToBase64:function(e){if(null==e)return"";e=d._compress(e,6,function(f){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(f)});switch(e.length%4){default:case 0:return e;case 1:return e+"===";case 2:return e+"==";case 3:return e+"="}},decompressFromBase64:function(e){return null==e?"":""==e?null:d._decompress(e.length,
32,function(f){return a("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",e.charAt(f))})},compressToUTF16:function(e){return null==e?"":d._compress(e,15,function(f){return b(f+32)})+" "},decompressFromUTF16:function(e){return null==e?"":""==e?null:d._decompress(e.length,16384,function(f){return e.charCodeAt(f)-32})},compressToUint8Array:function(e){e=d.compress(e);for(var f=new Uint8Array(2*e.length),h=0,g=e.length;h<g;h++){var k=e.charCodeAt(h);f[2*h]=k>>>8;f[2*h+1]=k%256}return f},
decompressFromUint8Array:function(e){if(null===e||void 0===e)return d.decompress(e);for(var f=Array(e.length/2),h=0,g=f.length;h<g;h++)f[h]=256*e[2*h]+e[2*h+1];var k=[];f.forEach(function(m){k.push(b(m))});return d.decompress(k.join(""))},compressToEncodedURIComponent:function(e){return null==e?"":d._compress(e,6,function(f){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$".charAt(f)})},decompressFromEncodedURIComponent:function(e){if(null==e)return"";if(""==e)return null;
e=e.replace(/ /g,"+");return d._decompress(e.length,32,function(f){return a("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",e.charAt(f))})},compress:function(e){return d._compress(e,16,function(f){return b(f)})},_compress:function(e,f,h){if(null==e)return"";var g,k={},m={},n="",q=2,x=3,t=2,w=[],l=0,r=0,u;for(u=0;u<e.length;u+=1){var v=e.charAt(u);Object.prototype.hasOwnProperty.call(k,v)||(k[v]=x++,m[v]=!0);var y=n+v;if(Object.prototype.hasOwnProperty.call(k,y))n=y;else{if(Object.prototype.hasOwnProperty.call(m,
n)){if(256>n.charCodeAt(0)){for(g=0;g<t;g++)l<<=1,r==f-1?(r=0,w.push(h(l)),l=0):r++;var p=n.charCodeAt(0);for(g=0;8>g;g++)l=l<<1|p&1,r==f-1?(r=0,w.push(h(l)),l=0):r++,p>>=1}else{p=1;for(g=0;g<t;g++)l=l<<1|p,r==f-1?(r=0,w.push(h(l)),l=0):r++,p=0;p=n.charCodeAt(0);for(g=0;16>g;g++)l=l<<1|p&1,r==f-1?(r=0,w.push(h(l)),l=0):r++,p>>=1}q--;0==q&&(q=Math.pow(2,t),t++);delete m[n]}else for(p=k[n],g=0;g<t;g++)l=l<<1|p&1,r==f-1?(r=0,w.push(h(l)),l=0):r++,p>>=1;q--;0==q&&(q=Math.pow(2,t),t++);k[y]=x++;n=String(v)}}if(""!==
n){if(Object.prototype.hasOwnProperty.call(m,n)){if(256>n.charCodeAt(0)){for(g=0;g<t;g++)l<<=1,r==f-1?(r=0,w.push(h(l)),l=0):r++;p=n.charCodeAt(0);for(g=0;8>g;g++)l=l<<1|p&1,r==f-1?(r=0,w.push(h(l)),l=0):r++,p>>=1}else{p=1;for(g=0;g<t;g++)l=l<<1|p,r==f-1?(r=0,w.push(h(l)),l=0):r++,p=0;p=n.charCodeAt(0);for(g=0;16>g;g++)l=l<<1|p&1,r==f-1?(r=0,w.push(h(l)),l=0):r++,p>>=1}q--;0==q&&(q=Math.pow(2,t),t++);delete m[n]}else for(p=k[n],g=0;g<t;g++)l=l<<1|p&1,r==f-1?(r=0,w.push(h(l)),l=0):r++,p>>=1;q--;0==
q&&t++}p=2;for(g=0;g<t;g++)l=l<<1|p&1,r==f-1?(r=0,w.push(h(l)),l=0):r++,p>>=1;for(;;)if(l<<=1,r==f-1){w.push(h(l));break}else r++;return w.join("")},decompress:function(e){return null==e?"":""==e?null:d._decompress(e.length,32768,function(f){return e.charCodeAt(f)})},_decompress:function(e,f,h){var g=[],k=4,m=4,n=3,q=[],x,t,w=h(0),l=f,r=1;for(x=0;3>x;x+=1)g[x]=x;var u=0;var v=Math.pow(2,2);for(t=1;t!=v;){var y=w&l;l>>=1;0==l&&(l=f,w=h(r++));u|=(0<y?1:0)*t;t<<=1}switch(u){case 0:u=0;v=Math.pow(2,8);
for(t=1;t!=v;)y=w&l,l>>=1,0==l&&(l=f,w=h(r++)),u|=(0<y?1:0)*t,t<<=1;var p=b(u);break;case 1:u=0;v=Math.pow(2,16);for(t=1;t!=v;)y=w&l,l>>=1,0==l&&(l=f,w=h(r++)),u|=(0<y?1:0)*t,t<<=1;p=b(u);break;case 2:return""}x=g[3]=p;for(q.push(p);;){if(r>e)return"";u=0;v=Math.pow(2,n);for(t=1;t!=v;)y=w&l,l>>=1,0==l&&(l=f,w=h(r++)),u|=(0<y?1:0)*t,t<<=1;switch(p=u){case 0:u=0;v=Math.pow(2,8);for(t=1;t!=v;)y=w&l,l>>=1,0==l&&(l=f,w=h(r++)),u|=(0<y?1:0)*t,t<<=1;g[m++]=b(u);p=m-1;k--;break;case 1:u=0;v=Math.pow(2,16);
for(t=1;t!=v;)y=w&l,l>>=1,0==l&&(l=f,w=h(r++)),u|=(0<y?1:0)*t,t<<=1;g[m++]=b(u);p=m-1;k--;break;case 2:return q.join("")}0==k&&(k=Math.pow(2,n),n++);if(g[p])p=g[p];else if(p===m)p=x+x.charAt(0);else return null;q.push(p);g[m++]=x+p.charAt(0);k--;x=p;0==k&&(k=Math.pow(2,n),n++)}}};return d}();
class StringFmt{static IsNullOrWhiteSpace(a){try{return null==a||"undefined"==a?!0:1>a.toString().replace(/\s/g,"").length}catch(b){return console.log(b),!1}}static Join(a,...b){try{let c=b[0];if(Array.isArray(c)||c instanceof Array){let d=StringFmt.Empty;for(b=0;b<c.length;b++){let e=c[b];d=b<c.length-1?d+(e+a):d+e}return d}if("object"===typeof c){let d=StringFmt.Empty;Object.keys(c).forEach(e=>{d+=c[e]+a});return d=d.slice(0,d.length-a.length)}return StringFmt.join(a,...b)}catch(c){return console.log(c),
StringFmt.Empty}}static Format(a,...b){try{return a.match(StringFmt.regexNumber)?StringFmt.format(StringFmt.regexNumber,a,b):a.match(StringFmt.regexObject)?StringFmt.format(StringFmt.regexObject,a,b,!0):a}catch(c){return console.log(c),StringFmt.Empty}}static format(a,b,c,d=!1){return b.replace(a,function(e,f){let h=e.split(":");1<h.length&&(f=h[0].replace("{",""),e=h[1].replace("}",""));f=d?c[0][f]:c[f];if(null==f||void 0==f||e.match(/{\d+}/))return f;f=StringFmt.parsePattern(e,f);return"undefined"!=
typeof f&&null!=f?f:StringFmt.Empty})}static parsePattern(a,b){switch(a){case "L":return b=b.toLocaleLowerCase();case "U":return b=b.toLocaleUpperCase();case "d":if("string"===typeof b)return StringFmt.getDisplayDateFromString(b);if(b instanceof Date)return StringFmt.Format("{0:00}.{1:00}.{2:0000}",b.getDate(),b.getMonth(),b.getFullYear());break;case "s":if("string"===typeof b)return StringFmt.getSortableDateFromString(b);if(b instanceof Date)return StringFmt.Format("{0:0000}-{1:00}-{2:00}",b.getFullYear(),
b.getMonth(),b.getDate());break;case "n":"string"!==typeof b&&(b=b.toString());var c=b.replace(/,/g,".");if(isNaN(parseFloat(c))||3>=c.length)break;a=b=c.split(/[^0-9]+/g);1<b.length&&(a=[StringFmt.join("",...b.splice(0,b.length-1)),b[b.length-1]]);let d=a[0];c=d.length%3;b=0<c?d.substring(0,c):StringFmt.Empty;c=d.substring(c).match(/.{3}/g);b=b+"."+StringFmt.Join(".",c);return b+=1<a.length?","+a[1]:"";case "x":return this.decimalToHexString(b);case "X":return this.decimalToHexString(b,!0)}return"number"!==
typeof b&&isNaN(b)||isNaN(+a)||StringFmt.IsNullOrWhiteSpace(b)?b:StringFmt.formatNumber(b,a)}static decimalToHexString(a,b=!1){a=parseFloat(a).toString(16);return b?a.toLocaleUpperCase():a}static getDisplayDateFromString(a){var b=a.split("-");if(1>=b.length)return a;a=b[b.length-1];let c=b[b.length-2];b=b[b.length-3];a=a.split("T")[0];a=a.split(" ")[0];return`${a}.${c}.${b}`}static getSortableDateFromString(a){var b=a.replace(",","").split(".");if(1>=b.length)return a;let c=b[b.length-1].split(" ");
a=StringFmt.Empty;1<c.length&&(a=c[c.length-1]);b=`${b[b.length-1].split(" ")[0]}-${b[b.length-2]}-${b[b.length-3]}`;return b=!StringFmt.IsNullOrWhiteSpace(a)&&1<a.length?b+`T${a}`:b+"T00:00:00"}static formatNumber(a,b){b=b.length;a=a.toString();return b<=a.length?a:Array(b-a.length+1).join("0")+a}static join(a,...b){let c=StringFmt.Empty;for(let d=0;d<b.length;d++)if(!("string"==typeof b[d]&&StringFmt.IsNullOrWhiteSpace(b[d])||"number"!=typeof b[d]&&"string"!=typeof b[d])){c+=""+b[d];for(let e=d+
1;e<b.length;e++)if(!StringFmt.IsNullOrWhiteSpace(b[e])){c+=a;d=e-1;break}}return c}}StringFmt.regexNumber=/{(\d+(:\w*)?)}/g;StringFmt.regexObject=/{(\w+(:\w*)?)}/g;StringFmt.Empty="";
class StringBuilder{constructor(a){this.Values=[];StringFmt.IsNullOrWhiteSpace(a)||(this.Values=Array(a))}ToString(){return this.Values.join("")}Append(a){this.Values.push(a)}AppendLine(a){this.Values.push("\r\n"+a)}AppendFormat(a,...b){this.Values.push(StringFmt.Format(a,...b))}AppendLineFormat(a,...b){this.Values.push("\r\n"+StringFmt.Format(a,...b))}Clear(){this.Values=[]}}
class JSON2CSV{constructor(){this.errorMissingSeparator="Missing separator option.";this.errorEmpty="JSON is empty.";this.errorEmptyHeader="Could not detect header. Ensure first row contains your column headers.";this.errorNotAnArray="Your JSON must be an array or an object.";this.errorItemNotAnObject="Item in array is not an object: {0}"}flattenArray(a,b=[]){function c(m,n){m=m.slice(0);if(!Array.isArray(n))return m;for(let q=0;q<n.length;q++)-1===m.indexOf(n[q])&&m.push(n[q]);return m}function d(m,
n){m=m||{};for(let q in n)m[q]="object"===typeof n[q]?d(m[q],n[q]):n[q];return m}var e=[];for(let m=0;m<a.length;m++){var f=a[m];let n={},q={};var h=1;if(void 0!==f&&null!==f&&(!this.isObject(f)||Array.isArray(f)))throw this.errorItemNotAnObject.replace("{0}",JSON.stringify(f));var g=this.getKeys(f);for(var k=0;k<g.length;k++){let x=f[g[k]],t=c(b,[g[k]]),w=t.join(".");Array.isArray(x)?(q[w]=this.flattenArray(x,t),h+=q[w].length):n[w]=x}if(1==h)e.push(n);else for(f=this.getKeys(q),h=0;h<f.length;h++)for(g=
f[h],k=0;k<q[g].length;k++)e.push(d(d({},n),q[g][k]))}return e}isObject(a){return a&&"object"==typeof a}getKeys(a){return this.isObject(a)?Object.keys(a):[]}convert(a,b){b||={};if(!this.isObject(a))throw this.errorNotAnArray;Array.isArray(a)||(a=[a]);var c=b.separator||",";if(!c)throw this.errorMissingSeparator;b.flatten&&(a=this.flattenArray(a));var d=[],e=[];for(var f=0;f<a.length;f++){var h=a[f],g={};if(void 0!==h&&null!==h&&(!this.isObject(h)||Array.isArray(h)))throw this.errorItemNotAnObject.replace("{0}",
JSON.stringify(h));var k=this.getKeys(h);for(let m=0;m<k.length;m++){let n=k[m];-1===d.indexOf(n)&&d.push(n);let q=h[n];if(void 0!==q||null!==q)"string"==typeof q?(g[n]='"'+q.replace(/"/g,b.output_csvjson_variant?'\\"':'""')+'"',b.output_csvjson_variant&&(g[n]=g[n].replace(/\n/g,"\\n"))):(g[n]=JSON.stringify(q),b.output_csvjson_variant||!this.isObject(q)&&!Array.isArray(q)||(g[n]='"'+g[n].replace(/"/g,'\\"').replace(/\n/g,"\\n")+'"'))}e.push(g)}a=[];for(f=0;f<d.length;f++)a.push('"'+d[f].replace(/"/g,
b.output_csvjson_variant?'\\"':'""')+'"');a=a.join(c)+"\n";for(f=0;f<e.length;f++){h=e[f];g=[];for(k=0;k<d.length;k++)g.push(h[d[k]]||(b.output_csvjson_variant?"null":""));a+=g.join(c)+(f<e.length-1?"\n":"")}return a}}
const init=()=>{var a=new URLSearchParams(location.search),b=a.get("engine"),c=a.get("lang");a=["/PlaneBuilder/strings.json","/PlaneBuilder/engines.json"].map(g=>fetch(g));Promise.all(a).then(g=>Promise.all(g.map(k=>k.json()))).then(g=>{var k=g[1];local=new Localization(g[0]);c?local.SetLanguages(c):window.localStorage.language&&local.SetLanguages(window.localStorage.language);if(g=window.localStorage.getItem("engines_names")){g=JSON.parse(g);for(let m of g)m=m.trim(),m=m.replace(/\s+/g," "),""!=
m&&engine_list.set(m,new EngineList(m))}for(let m of k.lists)engine_list.has(m.name)||engine_list.set(m.name,new EngineList(m.name)),"Custom"!=m.name?(engine_list.get(m.name).fromJSON(m,!0),engine_list.get(m.name).SetConstant()):engine_list.get(m.name).fromJSON(m,!1);ebuild=new EngineBuilder_HTML;ebuild.UpdateList()});if(null!=b)try{var d=LZString.decompressFromEncodedURIComponent(b),e=_stringToArrayBuffer(d),f=new Deserialize(e),h=engine_list.get("Custom").deserializeEngine(f);ebuild.SelectEngine(h)}catch(g){console.log("Compressed Engine Parameter Failed.")}enable_anim=
!0};window.onload=init;var ebuild,engine_list=new Map([["Custom",new EngineList("Custom")]]),local,enable_anim=!1;
class EngineBuilder_HTML{constructor(){this.enginebuilder=new EngineBuilder;this.pulsejetbuilder=new PulsejetBuilder;this.turbobuilder=new TurboBuilder;this.electricbuilder=new ElectricBuilder;var a=document.getElementById("table_engine").insertRow();this.InitEngineInputs(a.insertCell());this.InitEngineUpgrades(a.insertCell());this.InitEngineOutputs(a.insertCell());this.UpdateEngine();a=document.getElementById("table_pulsejet");a=a.insertRow();this.InitPulsejetInputs(a.insertCell());this.InitPulsejetOutputs(a.insertCell());
this.UpdatePulsejet();a=document.getElementById("table_turbox");a=a.insertRow();this.InitTurboXInputs(a.insertCell());this.td_desc=a.insertCell();this.InitTurboXOutputs(a.insertCell());this.UpdateTurboX();a=document.getElementById("table_electric");a=a.insertRow();this.InitElectricInputs(a.insertCell());this.InitElectricOutputs(a.insertCell());this.UpdateElectric();a=document.getElementById("table_manual").insertRow();this.InitManual(a.insertCell());this.InitListManagement(a.insertCell())}InitEngineInputs(a){this.e_name=
document.createElement("INPUT");this.e_sera=document.createElement("SELECT");this.e_cool=document.createElement("SELECT");this.e_disp=document.createElement("INPUT");this.e_cmpr=document.createElement("INPUT");this.e_ncyl=document.createElement("INPUT");this.e_nrow=document.createElement("INPUT");this.e_rpmb=document.createElement("INPUT");this.e_mfdg=document.createElement("INPUT");this.e_qfdg=document.createElement("INPUT");for(var b of this.enginebuilder.EraTable){let c=document.createElement("OPTION");
c.text=b.name;this.e_sera.add(c)}for(let c of this.enginebuilder.CoolingTable)b=document.createElement("OPTION"),b.text=c.name,this.e_cool.add(b);a=CreateFlexSection(a);FlexText("Name",this.e_name,a);FlexSelect("Era",this.e_sera,a);FlexSelect("Engine Type",this.e_cool,a);FlexInput("Engine Displacement (L)",this.e_disp,a);FlexInput("Compression Ratio (N:1)",this.e_cmpr,a);FlexInput("Cylinders per Row",this.e_ncyl,a);FlexInput("Number of Rows",this.e_nrow,a);FlexInput("RPM Boost",this.e_rpmb,a);FlexInput("Material Fudge Factor",
this.e_mfdg,a);FlexInput("Quality Fudge Factor",this.e_qfdg,a);this.e_disp.min="0.01";this.e_disp.step="0.01";this.e_cmpr.min="0.01";this.e_cmpr.step="0.01";this.e_ncyl.min="1";this.e_nrow.min="1";this.e_rpmb.min="0.01";this.e_rpmb.step="0.01";this.e_rpmb.max="2000";this.e_mfdg.min="0.1";this.e_mfdg.step="0.1";this.e_mfdg.max="1.9";this.e_qfdg.step="0.1";this.e_qfdg.min="0.1";this.e_qfdg.max="1.9";this.e_name.onchange=()=>{this.enginebuilder.name=this.e_name.value;this.UpdateEngine()};this.e_sera.onchange=
()=>{this.enginebuilder.era_sel=this.e_sera.selectedIndex;this.UpdateEngine()};this.e_cool.onchange=()=>{this.enginebuilder.cool_sel=this.e_cool.selectedIndex;this.UpdateEngine()};this.e_disp.onchange=()=>{this.enginebuilder.engine_displacement=this.e_disp.valueAsNumber;this.UpdateEngine()};this.e_cmpr.onchange=()=>{this.enginebuilder.compression_ratio=this.e_cmpr.valueAsNumber;this.UpdateEngine()};this.e_ncyl.onchange=()=>{this.enginebuilder.num_cyl_per_row=this.e_ncyl.valueAsNumber;this.UpdateEngine()};
this.e_nrow.onchange=()=>{this.enginebuilder.num_rows=this.e_nrow.valueAsNumber;this.UpdateEngine()};this.e_rpmb.onchange=()=>{this.enginebuilder.rpm_boost=this.e_rpmb.valueAsNumber;this.UpdateEngine()};this.e_mfdg.onchange=()=>{this.enginebuilder.material_fudge=this.e_mfdg.valueAsNumber;this.UpdateEngine()};this.e_qfdg.onchange=()=>{this.enginebuilder.quality_fudge=this.e_qfdg.valueAsNumber;this.UpdateEngine()}}InitEngineUpgrades(a){a=CreateFlexSection(a);this.e_ctyp=document.createElement("SELECT");
for(var b of this.enginebuilder.CompressorTable){var c=document.createElement("OPTION");c.text=b.name;this.e_ctyp.add(c)}this.e_ccnt=document.createElement("INPUT");this.e_mIA=document.createElement("INPUT");this.e_ctyp.onchange=()=>{this.enginebuilder.compressor_type=this.e_ctyp.selectedIndex;this.UpdateEngine()};this.e_ccnt.onchange=()=>{this.enginebuilder.compressor_count=this.e_ccnt.valueAsNumber;this.UpdateEngine()};this.e_mIA.onchange=()=>{this.enginebuilder.min_IAF=this.e_mIA.valueAsNumber;
this.UpdateEngine()};FlexSelect("Compressor Type",this.e_ctyp,a);FlexInput("Compressor Count",this.e_ccnt,a);FlexInput("Minimum Ideal Altitude",this.e_mIA,a);this.e_ccnt.min="0";this.e_ccnt.step="1";this.e_mIA.min="0";this.e_mIA.step="10";this.e_upgs=[];for(let d=1;d<this.enginebuilder.Upgrades.length;d++)b=this.enginebuilder.Upgrades[d],c=document.createElement("INPUT"),c.onchange=()=>{this.enginebuilder.upg_sel[d]=this.e_upgs[d-1].checked;this.UpdateEngine()},FlexCheckbox(b.name,c,a),this.e_upgs.push(c)}InitEngineOutputs(a){this.ed_name=
document.createElement("LABEL");this.ed_powr=document.createElement("LABEL");this.ed_mass=document.createElement("LABEL");this.ed_drag=document.createElement("LABEL");this.ed_rely=document.createElement("LABEL");this.ed_cool=document.createElement("LABEL");this.ed_ospd=document.createElement("LABEL");this.ed_fuel=document.createElement("LABEL");this.ed_malt=document.createElement("LABEL");this.ed_torq=document.createElement("LABEL");this.ed_cost=document.createElement("LABEL");this.ed_oilt=document.createElement("LABEL");
this.ed_grpm=document.createElement("LABEL");a=CreateFlexSection(a);FlexDisplay("Name",this.ed_name,a);FlexDisplay("Power",this.ed_powr,a);FlexDisplay("Mass",this.ed_mass,a);FlexDisplay("Drag",this.ed_drag,a);FlexDisplay("Reliability",this.ed_rely,a);FlexDisplay("Required Cooling",this.ed_cool,a);FlexDisplay("Overspeed",this.ed_ospd,a);FlexDisplay("Fuel Consumption",this.ed_fuel,a);FlexDisplay("Altitude",this.ed_malt,a);FlexDisplay("Torque",this.ed_torq,a);FlexDisplay("Cost",this.ed_cost,a);FlexDisplay("Oil Tank",
this.ed_oilt,a);FlexDisplay("Geared RPM",this.ed_grpm,a)}UpdateEngine(){var a=this.enginebuilder.EngineStats();this.e_name.value=this.enginebuilder.name;this.e_sera.selectedIndex=this.enginebuilder.era_sel;this.e_cool.selectedIndex=this.enginebuilder.cool_sel;this.e_disp.valueAsNumber=this.enginebuilder.engine_displacement;this.e_ncyl.valueAsNumber=this.enginebuilder.num_cyl_per_row;this.e_nrow.valueAsNumber=this.enginebuilder.num_rows;this.e_cmpr.valueAsNumber=this.enginebuilder.compression_ratio;
this.e_rpmb.valueAsNumber=this.enginebuilder.rpm_boost;this.e_mfdg.valueAsNumber=this.enginebuilder.material_fudge;this.e_qfdg.valueAsNumber=this.enginebuilder.quality_fudge;for(var b=0;b<this.e_upgs.length;b++)this.e_upgs[b].checked=this.enginebuilder.upg_sel[b+1];this.e_ctyp.selectedIndex=this.enginebuilder.compressor_type;this.e_ccnt.valueAsNumber=this.enginebuilder.compressor_count;this.e_mIA.valueAsNumber=this.enginebuilder.min_IAF;b=this.enginebuilder.CanUpgrade();for(let c=0;c<this.e_upgs.length;c++)this.e_upgs[c].disabled=
!b[c+1];BlinkIfChanged(this.ed_name,a.name);BlinkIfChanged(this.ed_powr,a.stats.power.toString(),!0);BlinkIfChanged(this.ed_mass,a.stats.mass.toString(),!1);BlinkIfChanged(this.ed_drag,a.stats.drag.toString(),!1);BlinkIfChanged(this.ed_rely,a.stats.reliability.toString(),!0);BlinkIfChanged(this.ed_cool,a.stats.cooling.toString(),!1);BlinkIfChanged(this.ed_ospd,a.overspeed.toString(),!0);BlinkIfChanged(this.ed_fuel,a.stats.fuelconsumption.toString(),!1);BlinkIfChanged(this.ed_malt,this.enginebuilder.min_IAF.toString()+
"-"+(this.enginebuilder.min_IAF+a.altitude).toString());BlinkIfChanged(this.ed_torq,a.torque.toString(),!1);BlinkIfChanged(this.ed_cost,a.stats.cost.toString(),!1);a.oiltank?BlinkIfChanged(this.ed_oilt,"Yes"):BlinkIfChanged(this.ed_oilt,"No");BlinkIfChanged(this.ed_grpm,(Math.round(100*this.enginebuilder.GearedRPM())/100).toString())}InitPulsejetInputs(a){this.p_powr=document.createElement("INPUT");this.p_type=document.createElement("SELECT");this.p_sera=document.createElement("SELECT");this.p_bqul=
document.createElement("INPUT");this.p_strt=document.createElement("INPUT");for(var b of this.pulsejetbuilder.ValveTable){let c=document.createElement("OPTION");c.text=b.name;this.p_type.add(c)}for(let c of this.pulsejetbuilder.EraTable)b=document.createElement("OPTION"),b.text=c.name,this.p_sera.add(b);a=CreateFlexSection(a);FlexInput("Desired Power",this.p_powr,a);FlexSelect("Engine Type",this.p_type,a);FlexSelect("Era",this.p_sera,a);FlexInput("Quality",this.p_bqul,a);FlexCheckbox("Starter",this.p_strt,
a);this.p_bqul.step="0.1";this.p_bqul.min="0";this.p_powr.onchange=()=>{this.pulsejetbuilder.desired_power=this.p_powr.valueAsNumber;this.UpdatePulsejet()};this.p_type.onchange=()=>{this.pulsejetbuilder.valve_sel=this.p_type.selectedIndex;this.UpdatePulsejet()};this.p_sera.onchange=()=>{this.pulsejetbuilder.era_sel=this.p_sera.selectedIndex;this.UpdatePulsejet()};this.p_bqul.onchange=()=>{this.pulsejetbuilder.build_quality=this.p_bqul.valueAsNumber;this.pulsejetbuilder.overall_quality=this.p_bqul.valueAsNumber;
this.UpdatePulsejet()};this.p_strt.onchange=()=>{this.pulsejetbuilder.starter=this.p_strt.checked;this.UpdatePulsejet()}}InitPulsejetOutputs(a){this.pd_name=document.createElement("LABEL");this.pd_powr=document.createElement("LABEL");this.pd_mass=document.createElement("LABEL");this.pd_drag=document.createElement("LABEL");this.pd_rely=document.createElement("LABEL");this.pd_fuel=document.createElement("LABEL");this.pd_rumb=document.createElement("LABEL");this.pd_cost=document.createElement("LABEL");
this.pd_malt=document.createElement("LABEL");this.pd_dcst=document.createElement("LABEL");a=CreateFlexSection(a);FlexDisplay("Name",this.pd_name,a);FlexDisplay("Power",this.pd_powr,a);FlexDisplay("Mass",this.pd_mass,a);FlexDisplay("Drag",this.pd_drag,a);FlexDisplay("Reliability",this.pd_rely,a);FlexDisplay("Fuel Consumption",this.pd_fuel,a);FlexDisplay("Rumble",this.pd_rumb,a);FlexDisplay("Cost",this.pd_cost,a);FlexDisplay("Altitude",this.pd_malt,a);FlexDisplay("Design Cost",this.pd_dcst,a)}UpdatePulsejet(){this.p_powr.valueAsNumber=
this.pulsejetbuilder.desired_power;this.p_type.selectedIndex=this.pulsejetbuilder.valve_sel;this.p_sera.selectedIndex=this.pulsejetbuilder.era_sel;this.p_bqul.valueAsNumber=this.pulsejetbuilder.build_quality;this.p_strt.checked=this.pulsejetbuilder.starter;var a=this.pulsejetbuilder.EngineStats();BlinkIfChanged(this.pd_name,a.name);BlinkIfChanged(this.pd_powr,a.stats.power.toString());BlinkIfChanged(this.pd_mass,a.stats.mass.toString());BlinkIfChanged(this.pd_drag,a.stats.drag.toString());BlinkIfChanged(this.pd_rely,
a.stats.reliability.toString());BlinkIfChanged(this.pd_fuel,a.stats.fuelconsumption.toString());BlinkIfChanged(this.pd_rumb,a.rumble.toString());BlinkIfChanged(this.pd_cost,a.stats.cost.toString());BlinkIfChanged(this.pd_malt,a.altitude.toString());BlinkIfChanged(this.pd_dcst,this.pulsejetbuilder.DesignCost().toString())}InitTurboXInputs(a){this.t_name=document.createElement("INPUT");this.t_era=document.createElement("SELECT");this.t_type=document.createElement("SELECT");this.t_effi=document.createElement("INPUT");
this.t_diam=document.createElement("INPUT");this.t_comp=document.createElement("INPUT");this.t_bypr=document.createElement("INPUT");this.t_aftb=document.createElement("INPUT");a=CreateFlexSection(a);FlexText("Name",this.t_name,a);FlexSelect("Era",this.t_era,a);FlexSelect("Type",this.t_type,a);FlexInput("Engine Diameter (m)",this.t_diam,a);FlexInput("Overall Pressure Ratio",this.t_comp,a);FlexInput("Bypass Ratio",this.t_bypr,a);FlexInput("Mass Flow Adjustment",this.t_effi,a);FlexCheckbox("Afterburner",
this.t_aftb,a);this.t_effi.step="0.05";this.t_effi.min="-0.5";this.t_effi.max="0.5";this.t_diam.step="0.01";this.t_comp.step="0.01";this.t_bypr.step="0.1";for(var b of this.turbobuilder.EraTable)a=document.createElement("OPTION"),a.text=b.name,this.t_era.add(a);for(let c of this.turbobuilder.TypeTable)b=document.createElement("OPTION"),b.text=c.name,this.t_type.add(b);this.t_name.onchange=()=>{this.turbobuilder.name=this.t_name.value;this.UpdateTurboX()};this.t_era.onchange=()=>{this.turbobuilder.era_sel=
this.t_era.selectedIndex;this.UpdateTurboX()};this.t_type.onchange=()=>{this.turbobuilder.type_sel=this.t_type.selectedIndex;this.UpdateTurboX()};this.t_effi.onchange=()=>{this.turbobuilder.flow_adjustment=this.t_effi.valueAsNumber;this.UpdateTurboX()};this.t_diam.onchange=()=>{this.turbobuilder.diameter=this.t_diam.valueAsNumber;this.UpdateTurboX()};this.t_comp.onchange=()=>{this.turbobuilder.compression_ratio=this.t_comp.valueAsNumber;this.UpdateTurboX()};this.t_bypr.onchange=()=>{this.turbobuilder.bypass_ratio=
this.t_bypr.valueAsNumber;this.UpdateTurboX()};this.t_aftb.onchange=()=>{this.turbobuilder.afterburner=this.t_aftb.checked;this.UpdateTurboX()}}InitTurboXOutputs(a){this.td_name=document.createElement("LABEL");this.td_powr=document.createElement("LABEL");this.td_mass=document.createElement("LABEL");this.td_drag=document.createElement("LABEL");this.td_rely=document.createElement("LABEL");this.td_fuel=document.createElement("LABEL");this.td_cost=document.createElement("LABEL");this.td_malt=document.createElement("LABEL");
a=CreateFlexSection(a);FlexDisplay("Name",this.td_name,a);FlexDisplay("Power",this.td_powr,a);FlexDisplay("Mass",this.td_mass,a);FlexDisplay("Drag",this.td_drag,a);FlexDisplay("Reliability",this.td_rely,a);FlexDisplay("Fuel Consumption",this.td_fuel,a);FlexDisplay("Cost",this.td_cost,a);FlexDisplay("Altitude",this.td_malt,a);this.td_desc.classList.add("disp_cell")}UpdateTurboX(){this.t_name.value=this.turbobuilder.name;this.t_era.selectedIndex=this.turbobuilder.era_sel;this.t_type.selectedIndex=this.turbobuilder.type_sel;
this.t_effi.valueAsNumber=this.turbobuilder.flow_adjustment;this.t_diam.valueAsNumber=this.turbobuilder.diameter;this.t_comp.valueAsNumber=this.turbobuilder.compression_ratio;this.t_bypr.valueAsNumber=this.turbobuilder.bypass_ratio;this.t_aftb.checked=this.turbobuilder.afterburner;this.t_bypr.disabled=0==this.turbobuilder.type_sel||3==this.turbobuilder.type_sel?!0:!1;var a=this.turbobuilder.EngineStats();BlinkIfChanged(this.td_name,a.name);BlinkIfChanged(this.td_powr,a.stats.power.toString());BlinkIfChanged(this.td_mass,
a.stats.mass.toString());BlinkIfChanged(this.td_drag,a.stats.drag.toString());BlinkIfChanged(this.td_rely,a.stats.reliability.toString());BlinkIfChanged(this.td_fuel,a.stats.fuelconsumption.toString());BlinkIfChanged(this.td_cost,a.stats.cost.toString());BlinkIfChanged(this.td_malt,a.altitude.toString());switch(this.turbobuilder.type_sel){case 0:this.td_desc.innerHTML=StringFmt.Format("Engine Parameters:<br/>\n                    &nbsp;&nbsp;&nbsp;&nbsp;Thrust = {0} kN<br/>\n                    &nbsp;&nbsp;&nbsp;&nbsp;Fuel Consumption = {1} g/(kN*s)<br/>\n                    <br/>\n                    For a real engine, set the era, total engine diameter (not intake) and OPR. Then\n                    adjust the mass flow rate until the Thrust is just below the rated takeoff thrust.<br/>\n                    <br/>\n                    For a fictional engine, it is not suggested to adjust the mass flow rate.<br/>\n                    ",
Math.trunc(100*this.turbobuilder.kN)/100,Math.trunc(100*this.turbobuilder.tsfc)/100);break;case 1:this.td_desc.innerHTML=StringFmt.Format("Engine Parameters:<br/>\n                    &nbsp;&nbsp;&nbsp;&nbsp;Thrust = {0} kN<br/>\n                    &nbsp;&nbsp;&nbsp;&nbsp;Fuel Consumption = {1} g/(kN*s)<br/>\n                    <br/>\n                    For a real engine, set the era, total engine diameter (not intake), Bypass\n                    Ratio and OPR. Then adjust the mass flow rate until the Thrust is just below\n                    the rated takeoff thrust.<br/>\n                    <br/>\n                    For a fictional engine, it is not suggested to adjust the mass flow rate.\n                    ",
Math.trunc(100*this.turbobuilder.kN)/100,Math.trunc(100*this.turbobuilder.tsfc)/100);break;case 2:this.td_desc.innerHTML=StringFmt.Format("Engine Parameters:<br/>\n                    &nbsp;&nbsp;&nbsp;&nbsp;Thrust = {0} kN<br/>\n                    &nbsp;&nbsp;&nbsp;&nbsp;Fuel Consumption = {1} g/(kN*s)<br/>\n                    <br/>\n                    For a real engine, set the era, total diameter of the largest fan, Bypass\n                    Ratio and OPR. Then adjust the mass flow rate until the Thrust is just below\n                    the rated takeoff thrust.<br/>\n                    <br/>\n                    For a fictional engine, it is not suggested to adjust the mass flow rate.\n                    ",
Math.trunc(100*this.turbobuilder.kN)/100,Math.trunc(100*this.turbobuilder.tsfc)/100);break;case 3:this.td_desc.innerHTML=StringFmt.Format("For a real engine, set the era, total engine diameter (not intake), Bypass\n                    Ratio and OPR. Then adjust the mass flow rate until the Power is just below\n                    the rated takeoff power (in effective shp if available, shp if not). Note\n                    that Power = 10*hp<br/>\n                    <br/>\n                    For a fictional engine, it is not suggested to adjust the mass flow rate.\n                    ")}}InitElectricInputs(a){this.el_name=
document.createElement("INPUT");this.el_era=document.createElement("SELECT");this.el_wind=document.createElement("SELECT");this.el_powi=document.createElement("INPUT");this.el_size=document.createElement("INPUT");this.el_qual=document.createElement("INPUT");a=CreateFlexSection(a);FlexText("Name",this.el_name,a);FlexSelect("Era",this.el_era,a);FlexSelect("Winding",this.el_wind,a);FlexInput("Desired Power",this.el_powi,a);FlexInput("Chonk",this.el_size,a);FlexInput("Quality",this.el_qual,a);this.el_qual.step=
"0.05";this.el_qual.min="0.5";this.el_qual.max="2";for(var b of this.electricbuilder.EraTable)a=document.createElement("OPTION"),a.text=b.name,this.el_era.add(a);for(let c of this.electricbuilder.Winding)b=document.createElement("OPTION"),b.text=c.name,this.el_wind.add(b);this.el_name.onchange=()=>{this.electricbuilder.name=this.el_name.value;this.UpdateElectric()};this.el_era.onchange=()=>{this.electricbuilder.era_sel=this.el_era.selectedIndex;this.UpdateElectric()};this.el_wind.onchange=()=>{this.electricbuilder.winding_sel=
this.el_wind.selectedIndex;this.UpdateElectric()};this.el_powi.onchange=()=>{this.electricbuilder.power=this.el_powi.valueAsNumber;this.UpdateElectric()};this.el_size.onchange=()=>{this.electricbuilder.chonk=this.el_size.valueAsNumber;this.UpdateElectric()};this.el_qual.onchange=()=>{this.electricbuilder.quality_fudge=this.el_qual.valueAsNumber;this.UpdateElectric()}}InitElectricOutputs(a){this.eld_name=document.createElement("LABEL");this.eld_powr=document.createElement("LABEL");this.eld_mass=document.createElement("LABEL");
this.eld_drag=document.createElement("LABEL");this.eld_rely=document.createElement("LABEL");this.eld_draw=document.createElement("LABEL");this.eld_over=document.createElement("LABEL");this.eld_cost=document.createElement("LABEL");a=CreateFlexSection(a);FlexDisplay("Name",this.eld_name,a);FlexDisplay("Power",this.eld_powr,a);FlexDisplay("Mass",this.eld_mass,a);FlexDisplay("Drag",this.eld_drag,a);FlexDisplay("Reliability",this.eld_rely,a);FlexDisplay("Charge Draw",this.eld_draw,a);FlexDisplay("Overspeed",
this.eld_over,a);FlexDisplay("Cost",this.eld_cost,a)}UpdateElectric(){this.el_name.value=this.electricbuilder.name;this.el_era.selectedIndex=this.electricbuilder.era_sel;this.el_wind.selectedIndex=this.electricbuilder.winding_sel;this.el_powi.valueAsNumber=this.electricbuilder.power;this.el_size.valueAsNumber=this.electricbuilder.chonk;this.el_qual.valueAsNumber=this.electricbuilder.quality_fudge;var a=this.electricbuilder.EngineStats();BlinkIfChanged(this.eld_name,a.name);BlinkIfChanged(this.eld_powr,
a.stats.power.toString());BlinkIfChanged(this.eld_mass,a.stats.mass.toString());BlinkIfChanged(this.eld_drag,a.stats.drag.toString());BlinkIfChanged(this.eld_rely,a.stats.reliability.toString());BlinkIfChanged(this.eld_draw,a.stats.charge.toString());BlinkIfChanged(this.eld_over,a.overspeed.toString());BlinkIfChanged(this.eld_cost,a.stats.cost.toString())}InitManual(a){this.m_name=document.createElement("INPUT");this.m_pwr=document.createElement("INPUT");this.m_mass=document.createElement("INPUT");
this.m_drag=document.createElement("INPUT");this.m_rely=document.createElement("INPUT");this.m_cool=document.createElement("INPUT");this.m_over=document.createElement("INPUT");this.m_fuel=document.createElement("INPUT");this.m_alti=document.createElement("INPUT");this.m_torq=document.createElement("INPUT");this.m_rumb=document.createElement("INPUT");this.m_cost=document.createElement("INPUT");this.m_oil=document.createElement("INPUT");this.m_pulsejet=document.createElement("INPUT");this.m_turbo=document.createElement("INPUT");
this.m_name.disabled=!0;this.m_pwr.disabled=!0;this.m_mass.disabled=!0;this.m_drag.disabled=!0;this.m_rely.disabled=!0;this.m_cool.disabled=!0;this.m_over.disabled=!0;this.m_fuel.disabled=!0;this.m_alti.disabled=!0;this.m_torq.disabled=!0;this.m_rumb.disabled=!0;this.m_cost.disabled=!0;this.m_oil.disabled=!0;this.m_pulsejet.disabled=!0;this.m_turbo.disabled=!0;a=CreateFlexSection(a);FlexText("Name",this.m_name,a);FlexInput("Power",this.m_pwr,a);FlexInput("Mass",this.m_mass,a);FlexInput("Drag",this.m_drag,
a);FlexInput("Reliability",this.m_rely,a);FlexInput("Cooling",this.m_cool,a);FlexInput("Overspeed",this.m_over,a);FlexInput("Fuel Consumption",this.m_fuel,a);FlexInput("Altitude",this.m_alti,a);FlexInput("Torque",this.m_torq,a);FlexInput("Rumble",this.m_rumb,a);FlexInput("Cost",this.m_cost,a);FlexCheckbox("Oil Tank",this.m_oil,a);FlexCheckbox("Pulsejet",this.m_pulsejet,a);FlexCheckbox("Turbocharger",this.m_turbo,a);a=()=>{this.UpdateManual()};this.m_name.onchange=a;this.m_pwr.onchange=a;this.m_mass.onchange=
a;this.m_drag.onchange=a;this.m_rely.onchange=a;this.m_cool.onchange=a;this.m_over.onchange=a;this.m_fuel.onchange=a;this.m_alti.onchange=a;this.m_torq.onchange=a;this.m_rumb.onchange=a;this.m_cost.onchange=a;this.m_oil.onchange=a;this.m_pulsejet.onchange=a;this.m_turbo.onchange=a}InitListManagement(a){this.list_idx="Custom";this.m_list_select=document.createElement("SELECT");this.m_select=document.createElement("SELECT");this.m_delete=document.createElement("BUTTON");this.m_add_eb=document.createElement("BUTTON");
this.m_add_pj=document.createElement("BUTTON");this.m_add_tb=document.createElement("BUTTON");this.m_add_el=document.createElement("BUTTON");this.m_save_csv=document.createElement("BUTTON");this.m_save=document.createElement("BUTTON");this.m_load=document.createElement("INPUT");this.m_list_create=document.createElement("BUTTON");this.m_list_input=document.createElement("INPUT");this.m_list_delete=document.createElement("BUTTON");this.m_list_select.onchange=()=>{this.list_idx=this.m_list_select.options[this.m_list_select.selectedIndex].text;
this.UpdateList()};this.m_select.onchange=()=>{this.SetValues(engine_list.get(this.list_idx).get(this.m_select.selectedIndex));this.m_select.selectedIndex=-1};this.m_delete.onclick=()=>{engine_list.get(this.list_idx).constant?BlinkBad(this.m_delete.parentElement):(engine_list.get(this.list_idx).remove_name(this.UpdateManual().name),this.list_idx="Custom",this.UpdateList(),BlinkGood(this.m_delete.parentElement))};this.m_add_eb.onclick=()=>{var d=this.enginebuilder.EngineInputs();"Default"==d.name||
engine_list.get(this.list_idx).constant?BlinkBad(this.m_add_eb.parentElement):(engine_list.get(this.list_idx).push(d),this.UpdateList(),BlinkGood(this.m_add_eb.parentElement))};this.m_add_pj.onclick=()=>{var d=this.pulsejetbuilder.EngineInputs();"Default"==d.name||engine_list.get(this.list_idx).constant?BlinkBad(this.m_add_pj.parentElement):(engine_list.get(this.list_idx).push(d),this.UpdateList(),BlinkGood(this.m_add_pj.parentElement))};this.m_add_tb.onclick=()=>{var d=this.turbobuilder.EngineInputs();
"Default"==d.name||engine_list.get(this.list_idx).constant?BlinkBad(this.m_add_tb.parentElement):(engine_list.get(this.list_idx).push(d),this.UpdateList(),BlinkGood(this.m_add_tb.parentElement))};this.m_add_el.onclick=()=>{var d=this.electricbuilder.EngineInputs();"Default"==d.name||engine_list.get(this.list_idx).constant?BlinkBad(this.m_add_el.parentElement):(engine_list.get(this.list_idx).push(d),this.UpdateList(),BlinkGood(this.m_add_el.parentElement))};this.m_save.onclick=()=>{download(JSON.stringify(engine_list.get(this.list_idx).toJSON()),
this.list_idx+".json","json")};this.m_load.setAttribute("type","file");this.m_load.multiple=!1;this.m_load.accept="application/JSON";this.m_load.onchange=d=>{if(0!=this.m_load.files.length){d=this.m_load.files[0];var e=new FileReader;e.onloadend=()=>{try{var f=JSON.parse(e.result),h=new EngineList(f.name);h.fromJSON(f);engine_list.has(h.name)&&engine_list.get(h.name).constant?BlinkBad(this.m_load.parentElement):(engine_list.set(h.name,h),this.UpdateList(),BlinkGood(this.m_load.parentElement))}catch(g){}};
e.readAsText(d);this.m_load.value=""}};this.m_list_create.onclick=()=>{var d=this.m_list_input.value;d=d.trim();d=d.replace(/\s+/g," ");""!=d?engine_list.has(d)&&engine_list.get(d).constant?BlinkBad(this.m_list_create.parentElement):(engine_list.set(d,new EngineList(d)),this.UpdateList(),BlinkGood(this.m_list_create.parentElement)):BlinkBad(this.m_list_create.parentElement)};this.m_list_delete.onclick=()=>{if(""!=this.list_idx&&"Custom"!=this.list_idx)if(engine_list.get(this.list_idx).constant)BlinkBad(this.m_list_delete.parentElement);
else{engine_list.delete(this.list_idx);window.localStorage.removeItem("engines."+this.list_idx);let e=JSON.parse(window.localStorage.getItem("engines_names"));var d=-1;for(let f=0;f<e.length;f++)e[f]==this.list_idx&&(d=f);-1!=d&&e.splice(d,1);window.localStorage.setItem("engines_names",JSON.stringify(e));this.list_idx="Custom";this.UpdateList();BlinkGood(this.m_list_delete.parentElement)}};this.m_save_csv.onclick=()=>{let d=[];var e=engine_list.get(this.list_idx);for(let f=0;f<e.length;f++){let h=
e.get_stats(f);d.push({name:h.name,power:h.stats.power,mass:h.stats.mass,drag:h.stats.drag,cooling:h.stats.cooling,reliability:h.stats.reliability,fuelconsumption:h.stats.fuelconsumption,overspeed:h.overspeed,cost:h.stats.cost})}e=new JSON2CSV;download(e.convert(d,{separator:",",flatten:!0,output_csvjson_variant:!1}),this.list_idx+".csv","csv")};CreateSelect("Lists",this.m_list_select,a);CreateSelect("Engines",this.m_select,a);a.appendChild(document.createElement("BR"));CreateButton("Save Engine List",
this.m_save,a);CreateButton("Load Engine List",this.m_load,a);CreateButton("Add From Engine Builder",this.m_add_eb,a);CreateButton("Add From Pulsejet Builder",this.m_add_pj,a);CreateButton("Add From Turbine Builder",this.m_add_tb,a);CreateButton("Delete Engine",this.m_delete,a);var b=document.createElement("SPAN"),c=document.createElement("LABEL");this.m_list_create.hidden=!0;this.m_list_create.id=GenerateID();c.htmlFor=this.m_list_create.id;c.innerHTML="<b>&nbsp;Create List&nbsp;&nbsp;</b>";c.classList.add("lbl_action");
c.classList.add("btn_th");b.appendChild(c);b.appendChild(this.m_list_create);b.appendChild(this.m_list_input);a.appendChild(b);a.appendChild(document.createElement("BR"));a.appendChild(document.createElement("BR"));CreateButton("Delete List",this.m_list_delete,a);CreateButton("Save Engine List as CSV",this.m_save_csv,a);this.UpdateList()}UpdateList(){for(var a=this.m_list_select.selectedIndex;0<this.m_list_select.options.length;)this.m_list_select.options.remove(this.m_list_select.options.length-
1);for(var b of engine_list.keys()){var c=document.createElement("OPTION");c.text=b;this.m_list_select.add(c);b==this.list_idx&&(a=this.m_list_select.options.length-1)}this.m_list_select.selectedIndex=a;for(a=this.m_select.selectedIndex;0<this.m_select.options.length;)this.m_select.options.remove(this.m_select.options.length-1);for(b=0;b<engine_list.get(this.list_idx).length;b++)c=document.createElement("OPTION"),c.text=engine_list.get(this.list_idx).get(b).name,this.m_select.add(c);a>=engine_list.get(this.list_idx).length&&
(a=engine_list.get(this.list_idx).length-1);this.m_select.selectedIndex=a}UpdateManual(){var a=new EngineStats;a.name=this.m_name.value;a.stats.power=this.m_pwr.valueAsNumber;a.stats.mass=this.m_mass.valueAsNumber;a.stats.drag=this.m_drag.valueAsNumber;a.stats.reliability=this.m_rely.valueAsNumber;a.stats.cooling=this.m_cool.valueAsNumber;a.overspeed=this.m_over.valueAsNumber;a.stats.fuelconsumption=this.m_fuel.valueAsNumber;a.altitude=this.m_alti.valueAsNumber;a.torque=this.m_torq.valueAsNumber;
a.rumble=this.m_rumb.valueAsNumber;a.stats.cost=this.m_cost.valueAsNumber;a.oiltank=this.m_oil.checked;a.pulsejet=this.m_pulsejet.checked;this.m_turbo.checked&&(a.stats.reqsections=1);a.Verify();return a}SetValues(a){var b=a.PartStats();switch(a.engine_type){case ENGINE_TYPE.PROPELLER:this.enginebuilder.name=a.name;this.enginebuilder.era_sel=a.era_sel;this.enginebuilder.cool_sel=a.type;this.enginebuilder.engine_displacement=a.displacement;this.enginebuilder.compression_ratio=a.compression;this.enginebuilder.num_cyl_per_row=
a.cyl_per_row;this.enginebuilder.num_rows=a.rows;this.enginebuilder.rpm_boost=a.RPM_boost;this.enginebuilder.material_fudge=a.material_fudge;this.enginebuilder.quality_fudge=a.quality_fudge;for(let c=0;c<this.enginebuilder.upg_sel.length;c++)this.enginebuilder.upg_sel[c]=a.upgrades[c];this.enginebuilder.compressor_type=a.compressor_type;this.enginebuilder.compressor_count=a.compressor_count;this.enginebuilder.min_IAF=a.min_IdealAlt;this.UpdateEngine();break;case ENGINE_TYPE.PULSEJET:this.pulsejetbuilder.era_sel=
a.era_sel;this.pulsejetbuilder.valve_sel=a.type;this.pulsejetbuilder.desired_power=a.power;this.pulsejetbuilder.build_quality=a.quality_cost;this.pulsejetbuilder.overall_quality=a.quality_rely;this.pulsejetbuilder.starter=a.starter;this.UpdatePulsejet();break;case ENGINE_TYPE.TURBOMACHINERY:this.turbobuilder.name=a.name;this.turbobuilder.era_sel=a.era_sel;this.turbobuilder.type_sel=a.type;this.turbobuilder.diameter=a.diameter;this.turbobuilder.compression_ratio=a.compression_ratio;this.turbobuilder.bypass_ratio=
a.bypass_ratio;this.turbobuilder.flow_adjustment=a.flow_adjustment;this.turbobuilder.afterburner=a.upgrades[0];this.UpdateTurboX();break;case ENGINE_TYPE.ELECTRIC:this.electricbuilder.name=a.name;this.electricbuilder.era_sel=a.era_sel;this.electricbuilder.winding_sel=a.winding_sel;this.electricbuilder.power=a.power;this.electricbuilder.chonk=a.material_fudge;this.electricbuilder.quality_fudge=a.quality_fudge;this.UpdateElectric();break;default:throw"engine_builder.SetValues New Engine Type";}this.m_name.value=
b.name;this.m_pwr.valueAsNumber=b.stats.power;this.m_mass.valueAsNumber=b.stats.mass;this.m_drag.valueAsNumber=b.stats.drag;this.m_rely.valueAsNumber=b.stats.reliability;this.m_cool.valueAsNumber=b.stats.cooling;this.m_over.valueAsNumber=b.overspeed;this.m_fuel.valueAsNumber=b.stats.fuelconsumption;this.m_alti.valueAsNumber=b.altitude;this.m_torq.valueAsNumber=b.torque;this.m_rumb.valueAsNumber=b.rumble;this.m_cost.valueAsNumber=b.stats.cost;this.m_oil.checked=b.oiltank;this.m_pulsejet.checked=b.pulsejet;
this.m_turbo.checked=0<b.stats.reqsections}SelectEngine(a){this.SetValues(engine_list.get(this.list_idx).get(a))}}var AIRCRAFT_TYPE;(function(a){a[a.AIRPLANE=0]="AIRPLANE";a[a.HELICOPTER=1]="HELICOPTER";a[a.AUTOGYRO=2]="AUTOGYRO";a[a.ORNITHOPTER_BASIC=3]="ORNITHOPTER_BASIC";a[a.ORNITHOPTER_FLUTTER=4]="ORNITHOPTER_FLUTTER";a[a.ORNITHOPTER_BUZZER=5]="ORNITHOPTER_BUZZER"})(AIRCRAFT_TYPE||={});
function IsAnyOrnithopter(a){return a==AIRCRAFT_TYPE.ORNITHOPTER_BASIC||a==AIRCRAFT_TYPE.ORNITHOPTER_FLUTTER||a==AIRCRAFT_TYPE.ORNITHOPTER_BUZZER}class Part{FormatEquipment(a,b,c){.5<Math.abs(c)?a.push({source:lu(b),charge:c.toString()}):0<c&&1E-6>c&&a.push({source:lu(b),charge:"-"});return a}}
function MergeElectrics(a,b){for(let c=0;c<b.equipment.length;c++){let d=!1;for(let e=0;e<a.equipment.length;e++)if(a.equipment[e].source==b.equipment[c].source&&!isNaN(parseInt(a.equipment[e].charge))){a.equipment[e].charge=(parseInt(a.equipment[e].charge)+parseInt(b.equipment[c].charge)).toString();d=!0;break}d||a.equipment.push(b.equipment[c])}return{storage:a.storage+b.storage,equipment:a.equipment}}
class Accessories extends Part{constructor(a){super();this.armour_coverage=[...Array(8).fill(0)];this.acft_rad=!1;this.skin_armour=0;this.electric_list=[];for(let b of a.electrical)this.electric_list.push({name:b.name,stats:new Stats(b),cp10s:b.cp10s,storage:b.storage});this.electrical_count=[...Array(this.electric_list.length).fill(0)];this.radio_list=[];this.radio_sel=0;for(let b of a.radios)this.radio_list.push({name:b.name,stats:new Stats(b)});this.recon_list=[];for(let b of a.recon)this.recon_list.push({name:b.name,
stats:new Stats(b)});this.recon_sel=Array(this.recon_list.length).fill(0);this.visi_list=[];for(let b of a.visibility)this.visi_list.push({name:b.name,stats:new Stats(b)});this.visi_sel=[...Array(this.visi_list.length).fill(!1)];this.can_visi=[...Array(this.visi_list.length).fill(!0)];this.clim_list=[];for(let b of a.climate)this.clim_list.push({name:b.name,stats:new Stats(b),req_radiator:b.req_radiator});this.clim_sel=[...Array(this.clim_list.length).fill(!1)];this.auto_list=[];this.auto_sel=0;for(let b of a.autopilots)this.auto_list.push({name:b.name,
stats:new Stats(b)});this.cont_list=[];this.cont_sel=0;for(let b of a.control)this.cont_list.push({name:b.name,max_mass_stress:b.max_mass_stress,max_total_stress:b.max_total_stress,stats:new Stats(b)})}toJSON(){return{v:2,armour_coverage:this.armour_coverage,electrical_count:this.electrical_count,radio_sel:this.radio_sel,recon_sel:this.recon_sel,visi_sel:this.visi_sel,clim_sel:this.clim_sel,auto_sel:this.auto_sel,cont_sel:this.cont_sel}}fromJSON(a,b){2==a.v&&(this.armour_coverage=a.armour_coverage);
11.85>b?(this.electrical_count=NumArr(a.electrical_count,this.electrical_count.length+1),this.electrical_count[0]+=this.electrical_count[1],this.electrical_count.splice(1,1)):this.electrical_count=NumArr(a.electrical_count,this.electrical_count.length);this.radio_sel=a.radio_sel;if(12.05>b){let c=BoolArr(a.info_sel,2);this.recon_sel=Array(this.recon_list.length).fill(0);c[0]&&(this.recon_sel[1]=1);c[1]&&(this.recon_sel[0]=1)}else this.recon_sel=NumArr(a.recon_sel,this.recon_sel.length);this.visi_sel=
BoolArr(a.visi_sel,this.visi_sel.length);this.clim_sel=BoolArr(a.clim_sel,this.clim_sel.length);11.95>b&&this.clim_sel.splice(2,1);this.auto_sel=a.auto_sel;this.cont_sel=a.cont_sel}serialize(a){a.PushNumArr(this.armour_coverage);a.PushNumArr(this.electrical_count);a.PushNum(this.radio_sel);a.PushNumArr(this.recon_sel);a.PushBoolArr(this.visi_sel);a.PushBoolArr(this.clim_sel);a.PushNum(this.auto_sel);a.PushNum(this.cont_sel)}deserialize(a){this.armour_coverage=a.GetNumArr(this.armour_coverage.length);
11.85>a.version?(this.electrical_count=a.GetNumArr(this.electrical_count.length+1),this.electrical_count[0]+=this.electrical_count[1],this.electrical_count.splice(1,1)):this.electrical_count=a.GetNumArr(this.electrical_count.length);this.radio_sel=a.GetNum();if(12.05>a.version){let b=a.GetBoolArr(2);this.recon_sel=Array(this.recon_list.length).fill(0);b[0]&&(this.recon_sel[1]=1);b[1]&&(this.recon_sel[0]=1)}else this.recon_sel=a.GetNumArr(this.recon_sel.length);this.visi_sel=a.GetBoolArr(this.visi_sel.length);
this.clim_sel=a.GetBoolArr(this.clim_sel.length);11.95>a.version&&this.clim_sel.splice(2,1);this.auto_sel=a.GetNum();this.cont_sel=a.GetNum()}GetCommunicationName(){return lu(this.radio_list[this.radio_sel].name)}GetArmourCoverage(){return this.armour_coverage}GetEffectiveCoverage(){var a=[],b=Math.max(0,Math.floor((this.vital_parts-8)/2));for(var c=0;c<this.armour_coverage.length;c++)a.push(Math.max(0,this.armour_coverage[c]));c=0;for(let d=this.armour_coverage.length-1;0<=d;d--)c+=a[d],a[d]=c-b;
return a}SetArmourCoverage(a,b){if(b!=b||0>b)b=0;b=Math.floor(1E-6+b);this.armour_coverage[a]=b;this.NormalizeCoverage();this.CalculateStats()}NormalizeCoverage(){var a=-8+Math.min(0,-Math.floor(1E-6+(this.vital_parts-8)/2));for(let b=this.armour_coverage.length-1;0<=b;b--)1==b&&(a+=this.skin_armour),this.armour_coverage[b]=Math.max(0,Math.min(Math.abs(a),this.armour_coverage[b])),a+=this.armour_coverage[b]}GetElectricalList(){return this.electric_list}GetElectricalCount(){return this.electrical_count}SetElectricalCount(a,
b){if(b!=b||0>b)b=0;b=Math.floor(1E-6+b);b=Math.min(b,50);this.electrical_count[a]=b;this.CalculateStats()}GetRadioList(){return this.radio_list}GetRadioSel(){return this.radio_sel}SetRadioSel(a){this.radio_sel=a;this.CalculateStats()}GetReconList(){return this.recon_list}GetReconSel(){return this.recon_sel}SetReconSel(a,b){b=Math.trunc(b);if(b!=b||0>b)b=0;this.recon_sel[a]=b;this.CalculateStats()}GetVisibilityList(){return this.visi_list}GetCanVisibility(){return this.can_visi}GetVisibilitySel(){return this.visi_sel}SetVisibilitySel(a,
b){this.visi_sel[a]=b;this.CalculateStats()}GetClimateList(){return this.clim_list}GetClimateSel(){return this.clim_sel}GetClimateEnable(){var a=[];for(let b of this.clim_list)!this.acft_rad&&b.req_radiator?a.push(!1):a.push(!0);return a}SetClimateSel(a,b){this.clim_sel[a]=b;this.CalculateStats()}GetAutopilotList(){return this.auto_list}GetAutopilotSel(){return this.auto_sel}SetAutopilotSel(a){this.auto_sel=a;this.CalculateStats()}GetControlList(){return this.cont_list}GetControlSel(){return this.cont_sel}SetControlSel(a){this.cont_sel=
a;this.CalculateStats()}SetAcftRadiator(a){this.acft_rad=a}IsElectrics(){for(var a of this.electrical_count)if(0<a)return!0;for(a=0;a<this.clim_list.length;a++)if(this.clim_sel[a]&&0!=this.clim_list[a].stats.charge)return!0;for(a=0;a<this.visi_list.length;a++)if(this.visi_sel[a]&&0!=this.visi_list[a].stats.charge)return!0;return 0!=this.radio_list[this.radio_sel].stats.charge||0!=this.auto_list[this.auto_sel].stats.charge?!0:!1}SetSkinArmor(a){a<this.skin_armour&&(this.armour_coverage[1]+=a-this.skin_armour);
this.skin_armour=a;this.armour_coverage[1]=Math.max(this.armour_coverage[1],this.skin_armour)}SetVitalParts(a){this.vital_parts=a;this.NormalizeCoverage()}GetMaxMassStress(){return this.cont_list[this.cont_sel].max_mass_stress}GetMaxTotalStress(){return this.cont_list[this.cont_sel].max_total_stress}SetCalculateStats(a){this.CalculateStats=a}GetStorage(){return 5*this.electrical_count[2]+5*this.electrical_count[3]}GetWindmill(){var a=0;for(let b=0;b<this.electrical_count.length;b++)a+=this.electric_list[b].cp10s*
this.electrical_count[b];return a}SetCanCutouts(a,b){for(let c=0;c<this.visi_list.length;c++){let d=!0;switch(this.visi_list[c].name){case "Wing Cutouts":d=a;break;case "Hull Cutouts":d=b}(this.can_visi[c]=d)||(this.visi_sel[c]=!1)}}PartStats(){var a=new Stats;this.armour_coverage[1]=Math.max(this.armour_coverage[1],this.skin_armour);var b="",c=this.GetEffectiveCoverage();for(let e=0;e<this.armour_coverage.length;e++){let f=e+1;var d=this.armour_coverage[e];2==f&&(d-=this.skin_armour);a.mass+=d*Math.pow(2,
f-1);a.cost+=Math.floor(1E-6+d*f/3);a.toughness+=this.armour_coverage[e]*f;0<c[e]&&(""!=b&&(b+=", "),b+=f.toString()+"/"+(11-c[e]).toString()+"+")}""!=b&&a.warnings.push({source:lu("Armour"),warning:b,color:WARNING_COLOR.WHITE});for(b=0;b<this.electrical_count.length;b++)0<this.electrical_count[b]&&(c=this.electric_list[b].stats.Clone(),c=c.Multiply(this.electrical_count[b]),a=a.Add(c));a=a.Add(this.radio_list[this.radio_sel].stats);for(b=0;b<this.recon_list.length;b++)0<this.recon_sel[b]&&(c=this.recon_list[b].stats.Clone(),
c=c.Multiply(this.recon_sel[b]),a=a.Add(c));for(b=0;b<this.visi_list.length;b++)this.visi_sel[b]&&(a=a.Add(this.visi_list[b].stats));for(b=0;b<this.clim_list.length;b++)!this.clim_sel[b]||this.clim_list[b].req_radiator&&!this.acft_rad||(a=a.Add(this.clim_list[b].stats));a=a.Add(this.auto_list[this.auto_sel].stats);a=a.Add(this.cont_list[this.cont_sel].stats);a.Round();return a}GetElectrics(){var a=0,b=[];for(var c=0;c<this.electric_list.length;c++){var d=this.electric_list[c],e=this.electrical_count[c];
0<e&&(a+=d.storage*e,0<d.cp10s?b.push({source:lu(d.name),charge:StringFmt.Format("{0}"+lu("Derived Per 10 Speed"),Math.floor(1E-6+e*d.cp10s))}):0!=d.stats.charge&&b.push({source:lu(d.name),charge:(e*d.stats.charge).toString()}))}c=this.radio_list[this.radio_sel];b=this.FormatEquipment(b,c.name,c.stats.charge);for(c=0;c<this.clim_list.length;c++)this.clim_sel[c]&&(d=this.clim_list[c],b=this.FormatEquipment(b,d.name,d.stats.charge));for(c=0;c<this.recon_list.length;c++)d=this.recon_list[c],e=this.recon_sel[c],
0<e&&(b=this.FormatEquipment(b,d.name,e*d.stats.charge));for(c=0;c<this.visi_list.length;c++)this.visi_sel[c]&&(d=this.visi_list[c],b=this.FormatEquipment(b,d.name,d.stats.charge));c=this.auto_list[this.auto_sel];b=this.FormatEquipment(b,c.name,c.stats.charge);c=this.cont_list[this.cont_sel];b=this.FormatEquipment(b,c.name,c.stats.charge);return{storage:a,equipment:b}}}
class Localization{constructor(a){this.lang="en";this.languages=a}GetLanguages(){var a=[];for(let b of this.languages.languages)a.push(b);return a}SetLanguages(a){this.languages[a]&&(this.lang=a)}e(a){if(this.languages[this.lang][a])return this.languages[this.lang][a];if(this.languages.en[a])return this.languages.en[a];console.error("Failed to find "+a);return"!"+a+"!"}}function lu(a,...b){return StringFmt.Format(local.e(a),...b)}
class Era extends Part{constructor(a){super();this.selected=0;this.vals=[];for(let b of a.options)a={name:b.name,maxbomb:b.maxbomb,cant_lift:b.cant_lift,stats:new Stats(b)},this.vals.push(a)}toJSON(){return{selected:this.selected}}fromJSON(a,b){this.selected=a.selected;10.35>b&&2<this.selected&&this.selected++}serialize(a){a.PushNum(this.selected)}deserialize(a){this.selected=a.GetNum()}GetSelected(){return this.selected}GetSelectedText(){return this.vals[this.selected].name}SetSelected(a){this.selected=
a;this.CalculateStats()}GetEraOptions(){return this.vals}GetLiftBleed(){return this.vals[this.selected].stats.liftbleed}GetMaxBomb(){return this.vals[this.selected].maxbomb}GetCantLift(){return this.vals[this.selected].cant_lift}PartStats(){var a=new Stats;return a=a.Add(this.vals[this.selected].stats)}SetCalculateStats(a){this.CalculateStats=a}GetElectrics(){return{storage:0,equipment:[]}}}
class Cockpit extends Part{constructor(a,b,c,d){super();this.stats=new Stats;this.types=a;this.upgrades=b;this.safety=c;this.gunsights=d;this.selected_type=0;this.selected_upgrades=[...Array(this.upgrades.length).fill(!1)];this.selected_safety=[...Array(this.safety.length).fill(!1)];this.selected_gunsights=[...Array(this.gunsights.length).fill(!1)];this.total_stress=[0,0];this.bombsight=this.seat_index=this.total_visibility=this.total_escape=0;this.is_armed=!1}toJSON(){return{type:this.selected_type,
upgrades:this.selected_upgrades,safety:this.selected_safety,sights:this.selected_gunsights,bombsight:this.bombsight}}fromJSON(a,b){this.selected_type=a.type;this.selected_upgrades=BoolArr(a.upgrades,this.selected_upgrades.length);this.selected_safety=BoolArr(a.safety,this.selected_safety.length);this.selected_gunsights=BoolArr(a.sights,this.selected_gunsights.length);this.IsPrimary()&&(this.selected_upgrades[0]=!1);10.35<b&&(this.bombsight=a.bombsight)}serialize(a){a.PushNum(this.selected_type);a.PushBoolArr(this.selected_upgrades);
a.PushBoolArr(this.selected_safety);a.PushBoolArr(this.selected_gunsights);a.PushNum(this.bombsight)}deserialize(a){this.selected_type=a.GetNum();this.selected_upgrades=a.GetBoolArr(this.selected_upgrades.length);this.selected_safety=a.GetBoolArr(this.selected_safety.length);this.selected_gunsights=a.GetBoolArr(this.selected_gunsights.length);this.IsPrimary()&&(this.selected_upgrades[0]=!1);10.35<a.version&&(this.bombsight=a.GetNum())}GetTypeList(){return this.types}GetUpgradeList(){return this.upgrades}GetSafetyList(){return this.safety}GetGunsightList(){return this.gunsights}GetType(){return this.selected_type}SetType(a){if(a>=
this.types.length)throw"Selected type is not in range of actual types.";this.selected_type=a;this.CalculateStats()}GetSelectedUpgrades(){return this.selected_upgrades}SetUpgrade(a,b){if(a>=this.upgrades.length)throw"Selected type is not in range of actual upgrades.";this.selected_upgrades[a]=b;this.CalculateStats()}GetSelectedSafety(){return this.selected_safety}CanSafety(){let a=Array(this.safety.length).fill(!0);a[5]=!this.types[this.selected_type].exposed;return a}SetSafety(a,b){if(a>=this.safety.length)throw"Selected type is not in range of actual safties.";
this.selected_safety[a]=b;this.CalculateStats()}GetSelectedGunsights(){return this.selected_gunsights}SetGunsight(a,b){if(a>=this.safety.length)throw"Selected type is not in range of actual gunsights.";this.selected_gunsights[a]=b;this.CalculateStats()}GetVisibility(){return-10>this.types[this.selected_type].stats.visibility?-1/0:this.total_visibility}GetFlightStress(){return this.total_stress}GetEscape(){return this.total_escape}GetCrash(){return this.total_crash}GetAttack(){var a=0;for(let b=0;b<
this.gunsights.length;b++)this.selected_gunsights[b]&&(a=Math.max(a,this.gunsights[b].attack));return a}SetSeatIndex(a){this.seat_index=a}IsPrimary(){return 0==this.seat_index}CanUpgrades(){var a=[...Array(this.upgrades.length).fill(!0)];this.IsPrimary()&&(a[0]=!1);return a}IsOpen(){return"Open"==this.types[this.selected_type].name||"Windscreen"==this.types[this.selected_type].name}GetBombsightQuality(){return this.bombsight}SetBombsightQuality(a){a!=a&&(a=0);a==this.bombsight-1&&(a=this.bombsight-
3);a==this.bombsight+1&&(a=this.bombsight+3);2>a&&(a=0);0<a&&(a=a-a%3+1);this.bombsight=a;this.CalculateStats()}SetHasRotary(a){this.has_rotary=a}IsElectrics(){return 0!=this.stats.charge}IsCopilot(){return this.selected_upgrades[0]}SetArmed(a){this.is_armed=a}GetName(){return this.IsPrimary()?"Crew Pilot":0<this.bombsight?"Crew Bombadier":this.IsCopilot()?"Crew Co-Pilot":this.is_armed?"Crew Gunner":"Crew Aircrew"}PartStats(){let a=new Stats;a.reqsections=1;a=a.Add(this.types[this.selected_type].stats);
for(var b=0;b<this.selected_upgrades.length;b++)this.selected_upgrades[b]&&(a=a.Add(this.upgrades[b].stats));b=this.CanSafety();for(let c=0;c<this.selected_safety.length;c++)b[c]||(this.selected_safety[c]=!1),this.selected_safety[c]&&(a=a.Add(this.safety[c].stats));for(b=0;b<this.selected_gunsights.length;b++)this.selected_gunsights[b]&&(a=a.Add(this.gunsights[b].stats));0<this.bombsight&&(a.cost+=Math.floor(2.000001+(this.bombsight-4)/3),a.warnings.push({source:lu("Bombsight"),warning:lu("Bombsight Warning 1")+
this.bombsight.toString()+lu("Bombsight Warning 2"),color:WARNING_COLOR.WHITE}),this.IsCopilot()&&a.warnings.push({source:lu("Bombadier Controls"),warning:lu("Bombadier Controls Warning"),color:WARNING_COLOR.WHITE}));this.stats=a.Clone();this.selected_upgrades[0]?(a.flightstress=this.upgrades[0].stats.flightstress,this.stats.flightstress-=a.flightstress):a.flightstress=0;return a}CrewUpdate(a,b,c,d,e,f){this.total_escape=this.stats.escape+a;let h=a=this.stats.flightstress;if(this.IsPrimary()||this.selected_upgrades[0])a+=
b,h+=b-2*d;a=Math.max(0,a);h=Math.max(0,h);a+=c;h+=c;this.IsOpen()&&this.has_rotary&&(a+=1,h+=1);a=Math.max(0,a);h=Math.max(0,h);this.total_stress=[a,h];this.total_visibility=this.stats.visibility+e;this.total_crash=this.stats.crashsafety+f}SetCalculateStats(a){this.CalculateStats=a}GetElectrics(){var a=[];for(var b=0;b<this.upgrades.length;b++)if(this.selected_upgrades[b]){var c=this.upgrades[b];a=this.FormatEquipment(a,c.name,c.stats.charge)}for(b=0;b<this.safety.length;b++)this.selected_safety[b]&&
(c=this.safety[b],a=this.FormatEquipment(a,c.name,c.stats.charge));for(b=0;b<this.gunsights.length;b++)this.selected_gunsights[b]&&(c=this.gunsights[b],a=this.FormatEquipment(a,c.name,c.stats.charge));return{storage:0,equipment:a}}}
class Cockpits extends Part{constructor(a){super();this.positions=[];this.types=[];for(var b of a.options){let d={name:b.name,exposed:b.exposed,stats:new Stats(b)};this.types.push(d)}this.upgrades=[];for(var c of a.upgrades)b={name:c.name,stats:new Stats(c)},this.upgrades.push(b);this.safety=[];for(let d of a.safety)c={name:d.name,stats:new Stats(d)},this.safety.push(c);this.gunsights=[];for(let d of a.gunsights)a={name:d.name,attack:d.attack,stats:new Stats(d)},this.gunsights.push(a)}toJSON(){var a=
[];for(let b of this.positions)a.push(b.toJSON());return{positions:a}}fromJSON(a,b){this.positions=[];for(let c of a.positions)a=new Cockpit(this.types,this.upgrades,this.safety,this.gunsights),a.SetSeatIndex(this.positions.length),a.fromJSON(c,b),a.SetCalculateStats(this.CalculateStats),this.positions.push(a)}serialize(a){a.PushNum(this.positions.length);for(let b of this.positions)b.serialize(a)}deserialize(a){var b=a.GetNum();this.positions=[];for(let c=0;c<b;c++){let d=new Cockpit(this.types,
this.upgrades,this.safety,this.gunsights);d.SetSeatIndex(this.positions.length);d.deserialize(a);d.SetCalculateStats(this.CalculateStats);this.positions.push(d)}}GetAttackList(){var a=[];for(let b of this.positions)a.push(b.GetAttack());return a}GetVisibilityList(){var a=[];for(let b of this.positions)a.push(b.GetVisibility());return a}GetStressList(){var a=[];for(let b of this.positions)a.push(b.GetFlightStress());return a}GetEscapeList(){var a=[];for(let b of this.positions)a.push(b.GetEscape());
return a}GetCrashList(){var a=[];for(let b of this.positions)a.push(b.GetCrash());return a}SetNumberOfCockpits(a){if(a!=a||1>a)a=1;for(a=Math.floor(1E-6+a);this.positions.length>a;)this.positions.pop();var b=null;for(0<this.positions.length&&(b=JSON.stringify(this.positions[this.positions.length-1].toJSON()));this.positions.length<a;){let c=new Cockpit(this.types,this.upgrades,this.safety,this.gunsights);c.SetSeatIndex(this.positions.length);b&&c.fromJSON(JSON.parse(b),1E3);c.SetCalculateStats(this.CalculateStats);
this.positions.push(c)}this.CalculateStats()}GetNumberOfCockpits(){return this.positions.length}GetCockpit(a){return this.positions[a]}SetHasRotary(a){for(let b of this.positions)b.SetHasRotary(a)}IsElectrics(){for(let a of this.positions)if(a.IsElectrics())return!0;return!1}PartStats(){var a=new Stats;let b=new Map;for(let d=0;d<this.positions.length;d++){var c=this.positions[d].PartStats();a=a.Add(c);for(let e of c.warnings)(c=b.get(e.source))?(c.push(d+1),b.set(e.source,c)):b.set(e.source,[d+1])}for(let d of a.warnings)d.source=
lu("Seats #",StringFmt.Join(",",b.get(d.source)))+" "+d.source;a.escape=0;a.visibility=0;a.crashsafety=0;return a}SetArmed(a){for(let b=0;b<this.positions.length;b++)this.positions[b].SetArmed(a[b])}UpdateCrewStats(a,b,c,d,e){let f=0;for(let h of this.positions)h.IsCopilot()&&(f+=1);for(let h of this.positions)h.CrewUpdate(a,b,c,f,d,e)}SetCalculateStats(a){this.CalculateStats=a}GetElectrics(){let a={storage:0,equipment:[]};for(let b of this.positions)a=MergeElectrics(a,b.GetElectrics());return a}}
class Passengers extends Part{constructor(a){super();this.beds=this.seats=0;this.connected=!1}toJSON(){return{seats:this.seats,beds:this.beds,connected:this.connected}}fromJSON(a,b){this.seats=a.seats;this.beds=a.beds;this.connected=a.connected}serialize(a){a.PushNum(this.seats);a.PushNum(this.beds);a.PushBool(this.connected)}deserialize(a){this.seats=a.GetNum();this.beds=a.GetNum();this.connected=a.GetBool()}GetSeats(){return this.seats}SetSeats(a){if(a!=a||0>a)a=0;this.seats=a=Math.floor(1E-6+a);
this.CalculateStats()}GetBeds(){return this.beds}SetBeds(a){if(a!=a||0>a)a=0;this.beds=a=Math.floor(1E-6+a);this.CalculateStats()}PossibleConnection(){return 0<this.seats+this.beds}GetConnected(){return this.connected}SetConnected(a){this.connected=a;this.CalculateStats()}PartStats(){var a=new Stats;a.reqsections=2*Math.ceil(-1E-6+(this.seats+2*this.beds)/5);0<this.seats+this.beds&&this.connected&&(a.mass=1);a.bomb_mass+=this.seats+this.beds;0<a.bomb_mass%5&&(a.bomb_mass+=5-a.bomb_mass%5);0<this.seats+
this.beds&&a.warnings.push({source:lu("Passengers Section Title"),warning:lu("Passengers Count",this.seats,this.beds),color:WARNING_COLOR.WHITE});return a}SetCalculateStats(a){this.CalculateStats=a}GetElectrics(){return{storage:0,equipment:[]}}}
class Engine extends Part{constructor(a,b){super();this.elist_idx="Custom";this.etype_stats=engine_list.get(this.elist_idx).get_stats(0);this.etype_inputs=engine_list.get(this.elist_idx).get(0);this.cooling_count=this.etype_stats.stats.cooling;this.radiator_index=-1;0<this.cooling_count&&(this.radiator_index=0);this.num_radiators=0;this.mount_list=a;this.mount_sel=0;this.torque_to_struct=this.use_pp=this.intake_fan=!1;this.cowl_list=b;this.cowl_sel=0;this.outboard_prop=this.use_ds=!1;this.total_reliability=
this.gpr_count=this.gp_count=0;this.has_alternator=this.is_generator=!1;if(0>=engine_list.get(this.elist_idx).length)throw"No Engine Stats Found.  Should be at least one.";}toJSON(){return{selected_stats:this.etype_stats.toJSON(),selected_inputs:this.etype_inputs.toJSON(),cooling_count:this.cooling_count,radiator_index:this.radiator_index,selected_mount:this.mount_sel,use_pushpull:this.use_pp,pp_torque_to_struct:this.torque_to_struct,use_driveshafts:this.use_ds,geared_propeller_ratio:this.gp_count,
geared_propeller_reliability:this.gpr_count,cowl_sel:this.cowl_sel,is_generator:this.is_generator,has_alternator:this.has_alternator,intake_fan:this.intake_fan,outboard_prop:this.outboard_prop}}oldJSON(a,b){a=a.selected_stats;this.etype_stats.fromJSON(a,b);this.etype_inputs=new EngineInputs;this.etype_stats.pulsejet&&a.input_pj?(this.etype_inputs=new EngineInputs,this.etype_inputs.name=this.etype_stats.name,this.etype_inputs.engine_type=ENGINE_TYPE.PULSEJET,b=a.input_pj,this.etype_inputs.type=b.type,
this.etype_inputs.power=b.power,this.etype_inputs.era_sel=b.era_sel,this.etype_inputs.quality_cost=b.quality_cost,this.etype_inputs.quality_rely=b.quality_rely,this.etype_inputs.starter=b.starter):a.input_eb?(this.etype_inputs.name=this.etype_stats.name,this.etype_inputs.engine_type=ENGINE_TYPE.PROPELLER,b=a.input_eb,this.etype_inputs.displacement=b.displacement,this.etype_inputs.compression=b.compression,this.etype_inputs.type=b.type,this.etype_inputs.cyl_per_row=b.cyl_per_row,this.etype_inputs.rows=
b.rows,this.etype_inputs.RPM_boost=b.RPM_boost,this.etype_inputs.era_sel=b.era_sel,this.etype_inputs.material_fudge=b.material_fudge,this.etype_inputs.quality_fudge=b.quality_fudge,this.etype_inputs.upgrades=b.upgrades,6==this.etype_inputs.upgrades.length?(this.etype_stats.altitude=10*this.etype_stats.altitude-1,this.etype_inputs.upgrades[0]&&(this.etype_inputs.compressor_type=2,this.etype_inputs.compressor_count=1),this.etype_inputs.upgrades[1]&&(this.etype_inputs.compressor_type=3,this.etype_inputs.compressor_count=
1),this.etype_inputs.upgrades.splice(0,2)):(this.etype_inputs.compressor_type=b.compressor_type,this.etype_inputs.compressor_count=b.compressor_count,this.etype_inputs.min_IdealAlt=b.min_IAF)):this.etype_stats.altitude=10*this.etype_stats.altitude-1;return this.etype_inputs}fromJSON(a,b){var c="";if(10.55<b){this.etype_stats.fromJSON(a.selected_stats,b);var d=new EngineInputs(a.selected_inputs);c=SearchAllEngineLists(this.etype_stats.name);""==c&&(c="Custom","Default"!=d.name&&engine_list.get(c).push(d));
this.etype_stats=engine_list.get(c).get_stats_name(this.etype_stats.name);this.etype_inputs=engine_list.get(c).get_name(this.etype_stats.name)}else d=this.oldJSON(a,b),"Default"!=d.name&&(c=SearchAllEngineLists(this.etype_stats.name),""==c&&(c="Custom",engine_list.get(c).push(d)),this.etype_stats=engine_list.get(c).get_stats_name(this.etype_stats.name),this.etype_inputs=engine_list.get(c).get_name(this.etype_stats.name));this.elist_idx=c;this.cooling_count=a.cooling_count;this.radiator_index=a.radiator_index;
this.mount_sel=a.selected_mount;this.use_pp=a.use_pushpull;this.torque_to_struct=a.pp_torque_to_struct;this.use_ds=a.use_driveshafts;this.gp_count=a.geared_propeller_ratio;this.gpr_count=a.geared_propeller_reliability;this.cowl_sel=a.cowl_sel;this.is_generator=a.is_generator;this.has_alternator=a.has_alternator;this.intake_fan=a.intake_fan;this.outboard_prop=12.15<=b?a.outboard_prop:!1}serialize(a){this.etype_stats.serialize(a);this.etype_inputs.serialize(a);a.PushNum(this.cooling_count);a.PushNum(this.radiator_index);
a.PushNum(this.mount_sel);a.PushBool(this.use_pp);a.PushBool(this.torque_to_struct);a.PushBool(this.use_ds);a.PushNum(this.gp_count);a.PushNum(this.gpr_count);a.PushNum(this.cowl_sel);a.PushBool(this.is_generator);a.PushBool(this.has_alternator);a.PushBool(this.intake_fan);a.PushBool(this.outboard_prop)}oldDeserialize(a){this.etype_stats.name=a.GetString();this.etype_stats.overspeed=a.GetNum();this.etype_stats.altitude=a.GetNum();this.etype_stats.torque=a.GetNum();this.etype_stats.rumble=a.GetNum();
this.etype_stats.oiltank=a.GetBool();this.etype_stats.pulsejet=a.GetBool();this.etype_inputs=new EngineInputs;10.45<a.version?(this.etype_inputs.name=this.etype_stats.name,this.etype_stats.pulsejet?(this.etype_inputs.engine_type=ENGINE_TYPE.PULSEJET,this.etype_inputs.power=a.GetNum(),this.etype_inputs.type=a.GetNum(),this.etype_inputs.era_sel=a.GetNum(),this.etype_inputs.quality_cost=a.GetNum(),this.etype_inputs.quality_rely=a.GetNum(),this.etype_inputs.starter=a.GetBool()):(this.etype_inputs.displacement=
a.GetNum(),this.etype_inputs.compression=a.GetNum(),this.etype_inputs.type=a.GetNum(),this.etype_inputs.cyl_per_row=a.GetNum(),this.etype_inputs.rows=a.GetNum(),this.etype_inputs.RPM_boost=a.GetNum(),this.etype_inputs.era_sel=a.GetNum(),this.etype_inputs.material_fudge=a.GetNum(),this.etype_inputs.quality_fudge=a.GetNum(),this.etype_inputs.upgrades=a.GetBoolArr(0),6==this.etype_inputs.upgrades.length?(this.etype_stats.altitude=10*this.etype_stats.altitude-1,this.etype_inputs.upgrades[0]&&(this.etype_inputs.compressor_type=
2,this.etype_inputs.compressor_count=1),this.etype_inputs.upgrades[1]&&(this.etype_inputs.compressor_type=3,this.etype_inputs.compressor_count=1),this.etype_inputs.upgrades.splice(0,2)):(this.etype_inputs.compressor_type=a.GetNum(),this.etype_inputs.compressor_count=a.GetNum(),this.etype_inputs.min_IdealAlt=a.GetNum()))):this.etype_stats.altitude=10*this.etype_stats.altitude-1;this.etype_stats.stats.deserialize(a);return this.etype_inputs}deserialize(a){var b="";if(10.55<a.version){this.etype_stats.deserialize(a);
var c=new EngineInputs;c.deserialize(a);b=SearchAllEngineLists(this.etype_stats.name);""==b&&(b="Custom","Default"!=c.name&&engine_list.get(b).push(c));this.etype_stats=engine_list.get(b).get_stats_name(this.etype_stats.name);this.etype_inputs=engine_list.get(b).get_name(this.etype_stats.name)}else c=this.oldDeserialize(a),"Default"!=c.name&&(b=SearchAllEngineLists(this.etype_stats.name),""==b&&(b="Custom",engine_list.get(b).push(c)),this.etype_stats=engine_list.get(b).get_stats_name(this.etype_stats.name),
this.etype_inputs=engine_list.get(b).get_name(this.etype_stats.name));this.cooling_count=a.GetNum();this.radiator_index=a.GetNum();this.mount_sel=a.GetNum();this.use_pp=a.GetBool();this.torque_to_struct=a.GetBool();this.use_ds=a.GetBool();this.gp_count=a.GetNum();this.gpr_count=a.GetNum();this.cowl_sel=a.GetNum();this.is_generator=a.GetBool();this.has_alternator=a.GetBool();this.intake_fan=a.GetBool();this.outboard_prop=12.15<=a.version?a.GetBool():!1;this.elist_idx=b}GetMinAltitude(){return this.etype_inputs.min_IdealAlt}GetMaxAltitude(){return this.GetMinAltitude()+
this.etype_stats.altitude}GetMinIAF(){return Math.floor(1E-6+this.GetMinAltitude()/10)}GetMaxIAF(){return Math.floor(1E-6+this.GetMaxAltitude()/10)}CanSelectIndex(){var a=engine_list.get(this.elist_idx),b=[...Array(a.length).fill(!0)];if(this.is_internal)for(let c=0;c<a.length;c++)if(a.get(c).engine_type==ENGINE_TYPE.PULSEJET||a.get(c).engine_type==ENGINE_TYPE.TURBOMACHINERY&&(1==a.get(c).type||2==a.get(c).type))b[c]=!1;return b}SetSelectedIndex(a){this.etype_stats=engine_list.get(this.elist_idx).get_stats(a);
this.etype_inputs=engine_list.get(this.elist_idx).get(a);this.cooling_count=this.use_pp?2*this.etype_stats.stats.cooling:this.etype_stats.stats.cooling;0>this.radiator_index&&(this.radiator_index=0);this.PulseJetCheck();this.VerifyCowl(this.cowl_sel);this.CalculateStats()}GetSelectedIndex(){return engine_list.get(this.elist_idx).find_name(this.etype_stats.name)}GetCurrentStats(){return this.etype_stats.Clone()}NeedCooling(){return 0<this.etype_stats.stats.cooling}WarnCoolingReliability(){return this.cooling_count<
this.etype_stats.stats.cooling}SetCooling(a){if(a!=a||0>a)a=0;this.cooling_count=a=Math.floor(1E-6+a);this.NeedCooling()&&(this.cooling_count=Math.max(1,this.cooling_count));this.CalculateStats()}GetCooling(){return this.cooling_count}GetMaxCooling(){return this.use_pp?2*this.etype_stats.stats.cooling:this.etype_stats.stats.cooling}SetNumRadiators(a){this.num_radiators=a;this.radiator_index>=a&&(this.radiator_index=a-1);0>this.radiator_index&&0<a&&(this.radiator_index=0)}GetNumRadiators(){return this.num_radiators}SetRadiator(a){this.radiator_index=
a;this.CalculateStats()}GetRadiator(){return this.radiator_index}CanIntakeFan(){return this.IsAirCooled()}SetIntakeFan(a){this.intake_fan=a;this.CalculateStats()}GetIntakeFan(){return this.intake_fan}CanOutboardProp(){return this.use_ds&&(this.IsTractor()||"Fuselage Push-Pull"==this.mount_list[this.mount_sel].name)}GetOutboardProp(){return this.outboard_prop}SetOutboardProp(a){this.outboard_prop=a&&this.use_ds?!0:!1;this.CalculateStats()}SetSelectedList(a){a!=this.elist_idx&&(this.elist_idx=a,this.SetSelectedIndex(0))}GetSelectedList(){return this.elist_idx}GetListOfEngines(){return engine_list.get(this.elist_idx)}RequiresExtendedDriveshafts(){return this.is_internal?
!1:this.mount_list[this.mount_sel].reqED}SetTailMods(a,b,c){!this.mount_list[this.mount_sel].reqTail||a||b||this.GetGenerator()||(this.use_ds=!0);!this.mount_list[this.mount_sel].reqED||this.GetGenerator()||c&&(a||b)||(this.use_ds=!0)}CanMountIndex(){var a=[...Array(this.mount_list.length).fill(!0)];if(this.is_internal)for(var b=0;b<a.length;++b)a[b]=this.mount_list[b].helicopter;else if(this.GetIsTurbine()&&!this.GetIsTurboprop())for(b=0;b<a.length;++b)a[b]=this.mount_list[b].turbine;else if(this.is_generator)a=
[...Array(this.mount_list.length).fill(!1)],a[0]=!0;else if(this.use_pp)for(b=0;b<a.length;++b)"fuselage"==this.mount_list[b].mount_type&&"Fuselage Push-Pull"!=this.mount_list[b].name&&(a[b]=!1),this.mount_list[b].turbine&&(a[b]=!1);else for(b=0;b<a.length;++b)"Fuselage Push-Pull"==this.mount_list[b].name&&(a[b]=!1),this.mount_list[b].turbine&&(a[b]=!1);return a}SetMountIndex(a){if(a>=this.mount_list.length)throw"Index outside of mount_list range.";this.mount_sel=a;this.mount_list[this.mount_sel].reqED&&
this.SetUseExtendedDriveshaft(!0);this.CalculateStats()}GetMountIndex(){return this.GetIsPulsejet()?-1:this.mount_sel}CanUsePushPull(){return!(this.is_generator||this.GetIsJet()||this.is_internal||this.mount_list[this.mount_sel].helicopter)}SetUsePushPull(a){(this.use_pp=a)?(this.cooling_count*=2,"fuselage"==this.mount_list[this.mount_sel].mount_type&&(this.mount_sel=8)):(this.cooling_count=Math.floor(1E-6+this.cooling_count/2),"Fuselage Push-Pull"==this.mount_list[this.mount_sel].name&&(this.mount_sel=
0));this.CalculateStats()}GetUsePushPull(){return this.use_pp}GetMountList(){return this.mount_list}CanUseExtendedDriveshaft(){return!(0==this.GetNumPropellers()||this.is_internal||this.GetGenerator()||this.mount_list[this.mount_sel].helicopter)}SetUseExtendedDriveshaft(a){this.GetGenerator()||this.is_internal?this.use_ds=!1:this.use_ds=a;this.CalculateStats()}GetUseExtendedDriveshaft(){return this.use_ds}CanUseGears(){return!(0==this.GetNumPropellers()||this.GetGenerator())}SetGearCount(a){if(a!=
a||0>a)a=0;this.gp_count=a=Math.floor(1E-6+a);this.SetGearReliability(this.gpr_count)}GetGearCount(){return this.gp_count}SetGearReliability(a){if(a!=a||0>a)a=0;a=Math.floor(1E-6+a);this.gpr_count=Math.min(a,this.gp_count);this.CalculateStats()}GetGearReliability(){return this.gpr_count}SetTorqueToStruct(a){this.torque_to_struct=a;this.use_pp||(this.torque_to_struct=!1);this.CalculateStats()}GetTorqueToStruct(){return this.torque_to_struct}CanTorqueToStruct(){return this.use_pp&&0<this.etype_stats.torque&&
"pod"!=this.mount_list[this.mount_sel].mount_type}UpdateReliability(a){this.total_reliability=this.etype_stats.stats.reliability;this.total_reliability-=this.gp_count-this.gpr_count;this.total_reliability+=this.cowl_list[this.cowl_sel].stats.reliability;this.NeedCooling()&&(this.total_reliability-=this.GetMaxCooling()-this.cooling_count);this.GetIntakeFan()&&(this.total_reliability+=6);this.total_reliability+=a}GetReliability(){return this.use_pp?this.outboard_prop?this.total_reliability.toString()+
"/"+(this.total_reliability-2).toString():this.total_reliability.toString()+"/"+this.total_reliability.toString():this.outboard_prop?(this.total_reliability-2).toString():this.total_reliability.toString()}GetOverspeed(){return this.is_generator?1E3:this.etype_stats.overspeed+Math.floor(1E-6+this.gp_count*this.etype_stats.overspeed/2)}GetIsPulsejet(){return this.etype_stats.pulsejet}GetIsJet(){return this.GetIsPulsejet()||this.GetIsTurbine()&&!this.GetIsTurboprop()}PulseJetCheck(){this.GetIsPulsejet()&&
(this.use_ds=this.use_pp=!1,this.cooling_count=this.gpr_count=this.gp_count=0,this.is_generator=this.has_alternator=!1,this.cowl_sel=0,this.radiator_index=-1)}GetIsTurbine(){return this.etype_inputs.engine_type==ENGINE_TYPE.TURBOMACHINERY}GetIsTurboprop(){return this.etype_inputs.engine_type==ENGINE_TYPE.TURBOMACHINERY&&3==this.etype_inputs.type}TurbineCheck(){this.GetIsTurbine()&&(0==this.GetNumPropellers()&&(this.use_ds=!1,this.gpr_count=this.gp_count=0),this.cowl_sel=this.cooling_count=0,this.radiator_index=
-1)}GetNumPropellers(){return!(this.GetIsPulsejet()||this.GetIsTurbine()||this.GetGenerator())||this.GetIsTurboprop()||this.is_internal?this.use_pp?2:1:0}GetIsTractorNacelle(){return 0<this.GetNumPropellers()&&!this.GetUsePushPull()&&.8==this.mount_list[this.mount_sel].powerfactor&&!this.is_internal?!0:!1}IsLiquidCooled(){return this.NeedCooling()}IsRotary(){return this.etype_stats.oiltank}IsContraRotary(){return this.GetIsPulsejet()||this.GetIsTurbine()||""==this.elist_idx||3!=this.etype_inputs.type?
!1:!0}IsAirCooled(){return!this.GetIsPulsejet()&&!this.GetIsTurbine()&&!this.IsLiquidCooled()&&!this.IsRotary()}GetCowlList(){return this.cowl_list}GetCowl(){return this.cowl_sel}GetCowlEnabled(){let a=[];for(let b of this.cowl_list)this.GetIsPulsejet()||this.GetIsTurbine()?a.push(b.air&&b.rotary&&b.liquid):this.IsLiquidCooled()?a.push(b.liquid):this.IsRotary()?a.push(b.rotary):a.push(b.air);return a}GetHasOilTank(){return this.etype_stats.oiltank}GetHasOilCooler(){return 0<this.etype_stats.stats.cooling}GetHasOilPan(){return this.IsAirCooled()}VerifyCowl(a){var b=
this.GetCowlEnabled();b[a]&&(this.cowl_sel=a);b[this.cowl_sel]||(this.cowl_sel=0)}SetCowl(a){this.VerifyCowl(a);this.CalculateStats()}GetGeneratorEnabled(){return!(this.GetIsPulsejet()||this.use_pp)}GetGenerator(){return this.is_generator}SetGenerator(a){this.GetGeneratorEnabled()?this.is_generator=a:this.is_generator=!1;this.is_generator&&(this.gpr_count=this.gp_count=0,this.use_ds=!1);this.CalculateStats()}GetAlternatorEnabled(){return!this.GetIsPulsejet()&&!this.is_generator&&this.etype_inputs.engine_type!=
ENGINE_TYPE.ELECTRIC}GetAlternator(){return this.has_alternator}SetAlternator(a){this.GetAlternatorEnabled()?this.has_alternator=a:this.has_alternator=!1;this.CalculateStats()}GetRumble(){return this.etype_stats.rumble}IsTractor(){return this.is_internal||this.GetGenerator()?!1:"Tractor"==this.mount_list[this.mount_sel].name||"Center-Mounted Tractor"==this.mount_list[this.mount_sel].name||"Fuselage Push-Pull"==this.mount_list[this.mount_sel].name}GetTractorSpinner(){return{has:this.IsTractor()&&!(this.outboard_prop&&
!this.use_pp),spinner:this.GetSpinner()}}IsPusher(){return this.is_internal||this.GetGenerator()?!1:"Rear-Mounted Pusher"==this.mount_list[this.mount_sel].name||"Center-Mounted Pusher"==this.mount_list[this.mount_sel].name||"Fuselage Push-Pull"==this.mount_list[this.mount_sel].name}GetPusherSpinner(){return{has:this.IsPusher()&&!this.outboard_prop,spinner:this.GetSpinner()}}GetSpinner(){if(0<this.gp_count&&!this.GetGenerator()&&!this.outboard_prop){if(this.use_ds&&("Center-Mounted Tractor"==this.mount_list[this.mount_sel].name||
"Center-Mounted Pusher"==this.mount_list[this.mount_sel].name||"Fuselage Push-Pull"==this.mount_list[this.mount_sel].name))return[!0,!0];if(!this.etype_stats.oiltank)return[!0,!1]}return[!1,!1]}IsElectrics(){return this.has_alternator||this.GetGenerator()}GetEngineHeight(){return this.GetGenerator()?5:"Pod"==this.mount_list[this.mount_sel].name||this.etype_stats.pulsejet||this.is_internal||this.outboard_prop?2:"Nacelle (Offset)"==this.mount_list[this.mount_sel].name?1:"Nacelle (Inside)"==this.mount_list[this.mount_sel].name||
"Channel Tractor"==this.mount_list[this.mount_sel].name||"Wing Pod"==this.mount_list[this.mount_sel].name?0:-1}IsTractorRotary(){return this.GetGenerator()?!1:this.IsRotary()&&("Tractor"==this.mount_list[this.mount_sel].name||"Fuselage Push-Pull"==this.mount_list[this.mount_sel].name)}IsDiesel(){return this.etype_inputs.upgrades[3]}SetCalculateStats(a){this.CalculateStats=a}SetInternal(a){if(this.is_internal=a)this.use_ds=!1}VerifyMount(){if(this.GetIsTurbine()&&!this.GetIsTurboprop())for(;!this.mount_list[this.mount_sel].turbine;)this.mount_sel++;
else if(this.GetIsPulsejet()){if("fuselage"==this.mount_list[this.mount_sel].mount_type)for(let a=0;a<this.mount_list.length&&(this.mount_sel=a,"fuselage"==this.mount_list[this.mount_sel].mount_type);a++);}else this.is_internal?this.CanMountIndex()[this.mount_sel]||(this.mount_sel=1):this.is_generator?this.mount_sel=0:this.mount_list[this.mount_sel].turbine&&(this.mount_sel=this.use_pp?8:0)}VerifyCooling(){this.NeedCooling()&&0>this.radiator_index?this.radiator_index=0:this.NeedCooling()||(this.radiator_index=
-1)}ElectricCheck(){this.etype_inputs.engine_type==ENGINE_TYPE.ELECTRIC&&(this.has_alternator=!1)}PartStats(){this.VerifyMount();this.VerifyCooling();this.PulseJetCheck();this.TurbineCheck();this.ElectricCheck();this.CanUseExtendedDriveshaft()||(this.use_ds=!1);this.CanOutboardProp()||(this.outboard_prop=!1);let a=new Stats;a=a.Add(this.etype_stats.stats);a.upkeep=a.power/10;this.etype_stats.oiltank&&(a.mass+=1);this.mount_list[this.mount_sel].helicopter&&this.IsRotary();this.torque_to_struct?a.structure-=
this.etype_stats.torque:"wing"==this.mount_list[this.mount_sel].mount_type?a.maxstrain-=this.etype_stats.torque:"fuselage"==this.mount_list[this.mount_sel].mount_type&&(a.latstab-=this.etype_stats.torque);this.IsContraRotary()&&(this.gp_count=Math.max(1,this.gp_count));a.cost+=this.gp_count+this.gpr_count;0<this.gp_count&&a.era.push({name:"Propeller Gearing",era:"WWI"});0<this.gpr_count&&a.era.push({name:"Reliable Gearing",era:"Roaring 20s"});this.use_ds&&(a.mass+=1);a=a.Add(this.cowl_list[this.cowl_sel].stats);
a.mass+=Math.floor(1E-6+a.drag*this.cowl_list[this.cowl_sel].mpd);a.drag=Math.floor(1E-6+a.drag*this.cowl_list[this.cowl_sel].ed);this.use_pp&&(a.power*=2,a.mass*=2,a.cooling*=2,a.fuelconsumption*=2,a.cost*=2,a.latstab*=2,a.structure*=2,a.maxstrain*=2,a.upkeep*=2,a.reqsections*=2,a.power=Math.floor(1E-6+this.mount_list[this.mount_sel].powerfactor*a.power));0==this.cowl_sel||"Rear-Mounted Pusher"!=this.mount_list[this.mount_sel].name&&"Center-Mounted Pusher"!=this.mount_list[this.mount_sel].name&&
"Fuselage Push-Pull"!=this.mount_list[this.mount_sel].name||(a.cost+=2);this.IsAirCooled()&&this.intake_fan?(a.mass+=3,a.latstab*=2,a.structure*=2,a.maxstrain*=2,a.cost+=4,a.era.push({name:"Air Cooling Fan",era:"WWII"})):this.intake_fan=!1;this.GetHasOilCooler()&&(a.drag+=Math.floor(a.power/15));this.GetIsPulsejet()||(a=a.Add(this.mount_list[this.mount_sel].stats),a.maxstrain-=Math.floor(1E-6+this.mount_list[this.mount_sel].strainfactor*this.etype_stats.stats.mass),a.drag+=Math.floor(1E-6+this.mount_list[this.mount_sel].dragfactor*
this.etype_stats.stats.mass));this.is_generator?(a.charge=Math.floor(1E-6+2*a.power/10)+2,a.power=0):this.has_alternator&&(a.charge=Math.floor(1E-6+a.power/10)+1,a.mass+=1,a.cost+=2);this.outboard_prop&&(a.drag+=3,this.use_pp&&(a.escape+=2));a.pitchspeed=0;a.reliability=0;return a}GetElectrics(){return{storage:0,equipment:[]}}}
class Radiator extends Part{constructor(a,b,c){super();this.need_cool=0;this.idx_mount=this.idx_type=1;this.engine_count=this.metal_area=this.idx_coolant=0;this.type_list=a;this.mount_list=b;this.coolant_list=c;this.harden_cool=!1}toJSON(){return{type:this.idx_type,mount:this.idx_mount,coolant:this.idx_coolant,harden_cool:this.harden_cool}}fromJSON(a,b){this.idx_type=a.type;this.idx_mount=a.mount;this.idx_coolant=a.coolant;10.85<b&&(this.harden_cool=a.harden_cool)}serialize(a){a.PushNum(this.idx_type);
a.PushNum(this.idx_mount);a.PushNum(this.idx_coolant);a.PushBool(this.harden_cool)}derserialize(a){this.idx_type=a.GetNum();this.idx_mount=a.GetNum();this.idx_coolant=a.GetNum();10.85<a.version&&(this.harden_cool=a.GetBool())}GetTypeList(){return this.type_list}GetMountList(){return this.mount_list}GetCoolantList(){return this.coolant_list}CanType(){var a=[...Array(this.type_list.length).fill(!0)];for(let b=0;b<this.type_list.length;b++)"Evaporation"==this.type_list[b].name&&this.metal_area<5*this.engine_count&&
(a[b]=!1);return a}SetTypeIndex(a){this.idx_type=a;this.CalculateStats()}GetTypeIndex(){return this.idx_type}SetParasol(a){this.has_parasol=a;this.CanMount()[this.idx_mount]||(this.idx_mount=0)}CanMount(){var a=[...Array(this.mount_list.length).fill(!0)];for(let b=0;b<this.mount_list.length;b++)"High Offset"!=this.mount_list[b].name||this.has_parasol||(a[b]=!1);return a}SetMountIndex(a){this.CanMount()[a]&&(this.idx_mount=a,this.CalculateStats())}GetMountIndex(){return this.idx_mount}SetCoolantIndex(a){this.idx_coolant=
a;this.CalculateStats()}GetCoolantIndex(){return this.idx_coolant}SetNeedCool(a,b){this.need_cool=a;this.engine_count=b}SetMetalArea(a){this.metal_area=a;this.CanType()[this.idx_type]||(this.idx_type=0)}GetHarden(){return this.harden_cool}SetHarden(a){this.harden_cool=a;this.CalculateStats()}VerifyHarden(){this.coolant_list[this.idx_coolant].harden&&(this.harden_cool=!0)}GetIsFlammable(){return this.coolant_list[this.idx_coolant].flammable}PartStats(){this.VerifyHarden();var a=new Stats;a.mass=3;
a=a.Add(this.type_list[this.idx_type].stats);a=a.Add(this.mount_list[this.idx_mount].stats);a=a.Add(this.coolant_list[this.idx_coolant].stats);a.drag+=Math.ceil(-1E-6+this.type_list[this.idx_type].dragpercool*(this.need_cool-a.cooling));this.harden_cool&&(a.cost+=2);return a}SetCalculateStats(a){this.CalculateStats=a}GetElectrics(){return{storage:0,equipment:[]}}}
class Engines extends Part{constructor(a){super();this.engines=[];this.radiators=[];this.mount_list=[];for(let b of a.mounts){let c={name:b.name,stats:new Stats(b),strainfactor:b.strainfactor,dragfactor:b.dragfactor,mount_type:b.location,powerfactor:b.powerfactor,reqED:!1,reqTail:!1,helicopter:b.helicopter,turbine:b.turbine};b.reqED&&(c.reqED=!0);b.reqTail&&(c.reqTail=!0);this.mount_list.push(c)}this.is_asymmetric=!1;this.r_type_list=[];for(let b of a["radiator-type"])this.r_type_list.push({name:b.name,
stats:new Stats(b),dragpercool:parseFloat(b.dragpercool)});this.r_mount_list=[];for(let b of a["radiator-mount"])this.r_mount_list.push({name:b.name,stats:new Stats(b)});this.r_coolant_list=[];for(let b of a["radiator-coolant"])this.r_coolant_list.push({name:b.name,harden:b.harden,flammable:b.flammable,stats:new Stats(b)});this.cowl_list=[];for(let b of a.cowling)this.cowl_list.push({name:b.name,stats:new Stats(b),ed:b.ed,mpd:b.mpd,air:b.air,liquid:b.liquid,rotary:b.rotary})}toJSON(){var a=[];for(var b of this.engines)a.push(b.toJSON());
b=[];for(let c of this.radiators)b.push(c.toJSON());return{engines:a,radiators:b,is_asymmetric:this.is_asymmetric}}fromJSON(a,b){this.radiators=[];for(var c of a.radiators){let d=new Radiator(this.r_type_list,this.r_mount_list,this.r_coolant_list);d.fromJSON(c,b);d.SetCalculateStats(this.CalculateStats);this.radiators.push(d)}this.engines=[];for(let d of a.engines)c=new Engine(this.mount_list,this.cowl_list),c.fromJSON(d,b),c.SetCalculateStats(this.CalculateStats),this.engines.push(c),c.SetNumRadiators(this.GetNumberOfRadiators());
this.is_asymmetric=a.is_asymmetric}serialize(a){a.PushNum(this.engines.length);for(let b of this.engines)b.serialize(a);a.PushNum(this.radiators.length);for(let b of this.radiators)b.serialize(a);a.PushBool(this.is_asymmetric)}deserialize(a){var b=a.GetNum();this.engines=[];for(var c=0;c<b;c++){var d=new Engine(this.mount_list,this.cowl_list);d.deserialize(a);d.SetCalculateStats(this.CalculateStats);this.engines.push(d)}b=a.GetNum();this.radiators=[];for(c=0;c<b;c++)d=new Radiator(this.r_type_list,
this.r_mount_list,this.r_coolant_list),d.derserialize(a),d.SetCalculateStats(this.CalculateStats),this.radiators.push(d);this.is_asymmetric=a.GetBool();for(let e of this.engines)e.SetNumRadiators(this.GetNumberOfRadiators())}GetHasOilTank(){for(let a of this.engines)if(a.GetCurrentStats().oiltank)return!0;return!1}GetReliabilityList(){var a=[];for(let b of this.engines)a.push(b.GetReliability());return a}GetMinIAF(){var a=0;for(let b of this.engines)a=Math.max(a,b.GetMinIAF());return a}GetMaxIAF(){var a=
100;for(let b of this.engines)a=Math.min(a,b.GetMaxIAF());return a}GetMinAltitude(){var a=0;for(let b of this.engines)a=Math.max(a,b.GetMinAltitude());return a}GetMaxAltitude(){var a=1E3;for(let b of this.engines)a=Math.min(a,b.GetMaxAltitude());return a}SetNumberOfEngines(a){if(a!=a||0>a)a=0;a=Math.floor(1E-6+a);for(a=Math.min(20,a);this.engines.length>a;)this.engines.pop();var b=null;for(0<this.engines.length&&(b=JSON.stringify(this.engines[this.engines.length-1].toJSON()));this.engines.length<
a;){let c=new Engine(this.mount_list,this.cowl_list);c.SetCalculateStats(this.CalculateStats);b&&c.fromJSON(JSON.parse(b),1E3);this.engines.push(c);c.SetNumRadiators(this.GetNumberOfRadiators())}this.CalculateStats()}GetNumberOfEngines(){var a=0;for(let b of this.engines)b.GetGenerator()||a++;return a}GetNumberOfItems(){return this.engines.length}GetEngine(a){return this.engines[a]}GetRadiator(a){return this.radiators[a]}SetNumberOfRadiators(a){if(a!=a||0>a)a=0;for(a=Math.floor(1E-6+a);this.radiators.length>
a;)this.radiators.pop();for(;this.radiators.length<a;){let b=new Radiator(this.r_type_list,this.r_mount_list,this.r_coolant_list);b.SetCalculateStats(this.CalculateStats);this.radiators.push(b)}for(let b of this.engines)b.SetNumRadiators(a);this.CalculateStats()}GetNumberOfRadiators(){0==this.radiators.length&&this.NeedCooling()?this.SetNumberOfRadiators(1):0<this.radiators.length&&!this.NeedCooling()&&this.SetNumberOfRadiators(0);return this.radiators.length}NeedCooling(){var a=!1;for(let b of this.engines)a=
a||b.NeedCooling();return a}UpdateReliability(a){for(let b of this.engines){let c=new Stats;b.GetRadiator()<this.radiators.length&&0<=b.GetRadiator()&&(c=this.radiators[b.GetRadiator()].PartStats());b.UpdateReliability(a.reliability+c.reliability)}}SetAsymmetry(a){this.is_asymmetric=a;this.CalculateStats()}GetAsymmetry(){return this.is_asymmetric}GetNumPropellers(){var a=0;for(let b of this.engines)a+=b.GetNumPropellers();return a}GetOverspeed(){var a=100;for(let b of this.engines)a=Math.min(a,b.GetOverspeed());
return a}GetRumble(){var a=0;for(let b of this.engines)a+=b.GetRumble();return a}GetMaxRumble(){var a=0;for(let b of this.engines)a=Math.max(a,b.GetRumble());return a}GetTractorSpinner(){var a={have:!1,spin_count:0,arty_spin_count:0};for(let c of this.engines){var b=c.GetTractorSpinner();b.has&&(a.have=!0,b.spinner[0]&&a.spin_count++,b.spinner[1]&&a.arty_spin_count++)}return a}GetPusherSpinner(){var a={have:!1,spin_count:0,arty_spin_count:0};for(let c of this.engines){var b=c.GetPusherSpinner();b.has&&
(a.have=!0,b.spinner[0]&&a.spin_count++,b.spinner[1]&&a.arty_spin_count++)}return a}IsElectrics(){for(let a of this.engines)if(a.IsElectrics())return!0;return!1}HaveParasol(a){for(let b of this.radiators)b.SetParasol(a)}SetMetalArea(a){for(let b of this.radiators)b.SetMetalArea(a)}SetTailMods(a,b,c){for(let d of this.engines)d.SetTailMods(a,b,c)}GetEngineHeight(){var a=2;for(let b of this.engines)a=Math.min(a,b.GetEngineHeight());return a}HasTractorRotary(){for(let a of this.engines)if(a.IsTractorRotary())return!0;
return!1}SetInternal(a){for(let b of this.engines)b.SetInternal(a);if(a)for(let b of this.radiators)b.SetMetalArea(0),b.SetParasol(!1)}HasPulsejet(){for(let a of this.engines)if(a.GetIsPulsejet())return!0;return!1}HasTurbineNoProp(){for(let a of this.engines)if(a.GetIsTurbine()&&0==a.GetNumPropellers())return!0;return!1}HasDiesel(){for(let a of this.engines)if(a.IsDiesel())return!0;return!1}GetEngineTypes(){var a=[];for(let b of this.engines)0<b.GetNumPropellers()?a.push({type:DRIVE_TYPE.PROPELLER,
num:b.GetNumPropellers()}):b.GetIsPulsejet()?a.push({type:DRIVE_TYPE.PULSEJET,num:0}):b.GetIsTurbine()&&a.push({type:DRIVE_TYPE.TURBINE,num:b.GetCurrentStats().stats.pitchspeed});return a}GetIsFlammable(){for(let a of this.radiators)if(a.GetIsFlammable())return!0;return!1}PartStats(){var a=new Stats,b=Array(this.GetNumberOfRadiators()).fill(null).map(()=>({cool:0,count:0})),c=0,d=100;for(var e of this.engines){var f=e.PartStats();a=a.Add(f);e.NeedCooling()&&(b[e.GetRadiator()].cool+=e.GetCooling(),
b[e.GetRadiator()].count+=1);c+=e.GetCurrentStats().stats.cost;0<f.pitchspeed&&(d=Math.min(d,f.pitchspeed))}100>d&&(a.pitchspeed=d);a.upkeep=Math.floor(1E-6+Math.min(a.upkeep,c));c=new Stats;d=new Map;for(e=0;e<this.radiators.length;e++){f=this.radiators[e];f.SetNeedCool(b[e].cool,b[e].count);f=f.PartStats();c=c.Add(f);for(let h of f.warnings)(f=d.get(h.source))?(f.push(e+1),d.set(h.source,f)):d.set(h.source,[e+1])}for(let h of c.warnings)h.source=lu("Radiators #",StringFmt.Join(",",d.get(h.source)))+
" "+h.source;a=a.Add(c);this.is_asymmetric&&(a.latstab-=3);this.HasPulsejet()&&a.warnings.push({source:lu("Pulsejets"),warning:lu("Pulsejet Boost Warning"),color:WARNING_COLOR.WHITE});this.HasTurbineNoProp()&&a.warnings.push({source:lu("Turbine"),warning:lu("Turbine Boost Warning"),color:WARNING_COLOR.WHITE});this.HasDiesel()&&a.warnings.push({source:lu("Diesel"),warning:lu("Diesel Warning"),color:WARNING_COLOR.WHITE});b=0;for(let h of this.engines)!h.IsRotary()||h.GetUsePushPull()&&h.GetTorqueToStruct()||
(h.GetUsePushPull()&&h.IsTractor()?b+=2:h.IsTractor()?b++:h.IsPusher()&&b--);0<b?a.warnings.push({source:lu("Rotary"),warning:lu("Rotary Right Warning"),color:WARNING_COLOR.WHITE}):0>b&&a.warnings.push({source:lu("Rotary"),warning:lu("Rotary Left Warning"),color:WARNING_COLOR.WHITE});a.reliability=0;return a}SetCalculateStats(a){this.CalculateStats=a}GetHasTractorNacelles(){let a=0;for(let b of this.engines)b.GetIsTractorNacelle()&&a++;return 1<a}GetElectrics(){let a={storage:0,equipment:[]};for(let b=
0;b<this.engines.length;b++){let c=this.engines[b].PartStats();0!=c.charge&&a.equipment.push({source:lu("Vital Part Engine",b),charge:c.charge.toString()})}for(let b of this.radiators)a=MergeElectrics(a,b.GetElectrics());return a}}
class Propeller extends Part{constructor(a){super();this.engines=[];this.idx_prop=2;this.prop_list=[];for(let b of a.props)this.prop_list.push({name:b.name,stats:new Stats(b),energy:b.energy,turn:b.turn});this.idx_upg=0;this.upg_list=[];for(let b of a.upgrades)this.upg_list.push({name:b.name,stats:new Stats(b),energy:b.energy,turn:b.turn})}toJSON(){return{type:this.idx_prop,upgrade:this.idx_upg}}fromJSON(a,b){this.idx_prop=a.type;11.35>b?(this.idx_upg=0,a.use_variable&&(this.idx_upg=1),5==this.idx_prop&&
(this.idx_prop=this.idx_upg=2)):this.idx_upg=a.upgrade}serialize(a){a.PushNum(this.idx_prop);a.PushNum(this.idx_upg)}deserialize(a){this.idx_prop=a.GetNum();11.35>a.version?(this.idx_upg=0,a.GetBool()&&(this.idx_upg=1),5==this.idx_prop&&(this.idx_prop=this.idx_upg=2)):this.idx_upg=a.GetNum()}GetPropList(){return this.prop_list}GetUpgradeList(){return this.upg_list}SetPropIndex(a){this.idx_prop=a;this.CalculateStats()}GetPropIndex(){return this.idx_prop}SetUpgradeIndex(a){this.idx_upg=a;this.CalculateStats()}GetUpgradeIndex(){return this.idx_upg}SetEngineTypes(a){this.engines=
a}GetNumPropellers(){var a=0;for(let b of this.engines)b.type==DRIVE_TYPE.PROPELLER&&(a+=b.num);return a}GetEnergy(){if(this.acft_type==AIRCRAFT_TYPE.HELICOPTER)return 2.5;if(this.acft_type==AIRCRAFT_TYPE.ORNITHOPTER_BASIC)return 6;if(this.acft_type==AIRCRAFT_TYPE.ORNITHOPTER_FLUTTER)return 8;if(this.acft_type==AIRCRAFT_TYPE.ORNITHOPTER_BUZZER)return 5;if(0==this.engines.length)return 2.5;var a=999;for(let b of this.engines)switch(b.type){case DRIVE_TYPE.PROPELLER:a=Math.min(a,this.prop_list[this.idx_prop].energy+
this.upg_list[this.idx_upg].energy);break;case DRIVE_TYPE.PULSEJET:a=Math.min(a,5);break;case DRIVE_TYPE.TURBINE:a=Math.min(a,9);break;default:throw"Not a known Engine Type.";}return a}GetTurn(){if(this.acft_type==AIRCRAFT_TYPE.HELICOPTER)return 6;if(this.acft_type==AIRCRAFT_TYPE.ORNITHOPTER_BASIC)return 7;if(this.acft_type==AIRCRAFT_TYPE.ORNITHOPTER_FLUTTER)return 8;if(this.acft_type==AIRCRAFT_TYPE.ORNITHOPTER_BUZZER)return 5;if(0==this.engines.length)return 6;var a=999;for(let b of this.engines)switch(b.type){case DRIVE_TYPE.PROPELLER:a=
Math.min(a,this.prop_list[this.idx_prop].turn+this.upg_list[this.idx_upg].turn);break;case DRIVE_TYPE.PULSEJET:a=Math.min(a,7);break;case DRIVE_TYPE.TURBINE:a=Math.min(a,4);break;default:throw"Not a known Engine Type.";}return a}SetAcftType(a){this.acft_type=a}PartStats(){var a=new Stats;0!=this.GetNumPropellers()&&(a=a.Add(this.prop_list[this.idx_prop].stats.Multiply(this.GetNumPropellers())),a=a.Add(this.upg_list[this.idx_upg].stats.Multiply(this.GetNumPropellers())));if(this.acft_type==AIRCRAFT_TYPE.HELICOPTER)a.pitchboost=
.6,a.pitchspeed=1;else if(this.acft_type==AIRCRAFT_TYPE.ORNITHOPTER_BASIC)a.pitchboost=.6,a.pitchspeed=.8;else if(this.acft_type==AIRCRAFT_TYPE.ORNITHOPTER_FLUTTER)a.pitchboost=.8,a.pitchspeed=.8;else if(this.acft_type==AIRCRAFT_TYPE.ORNITHOPTER_BUZZER)a.pitchboost=1,a.pitchspeed=.6;else if(0==this.engines.length)a.pitchboost=.6,a.pitchspeed=1;else{a.pitchboost=999;a.pitchspeed=999;for(let b of this.engines)switch(b.type){case DRIVE_TYPE.PROPELLER:a.pitchboost=Math.min(a.pitchboost,this.prop_list[this.idx_prop].stats.pitchboost+
this.upg_list[this.idx_upg].stats.pitchboost);a.pitchspeed=Math.min(a.pitchspeed,this.prop_list[this.idx_prop].stats.pitchspeed+this.upg_list[this.idx_upg].stats.pitchspeed);break;case DRIVE_TYPE.PULSEJET:a.pitchboost=Math.min(a.pitchboost,.6);a.pitchspeed=Math.min(a.pitchspeed,1);break;case DRIVE_TYPE.TURBINE:a.pitchboost=Math.min(a.pitchboost,.2);a.pitchspeed=Math.min(a.pitchspeed,b.num);break;default:throw"Not a known Engine Type.";}}return a}SetCalculateStats(a){this.CalculateStats=a}GetElectrics(){return{storage:0,
equipment:[]}}}
class Frames extends Part{constructor(a){super();this.frame_list=[];for(let b of a.frames)this.frame_list.push({name:b.name,stats:new Stats(b),basestruct:b.basestructure,basecost:b.basecost,geodesic:b.geodesic});this.sel_skin=0;this.skin_list=[];for(let b of a.skin)this.skin_list.push({name:b.name,stats:new Stats(b),monocoque:b.monocoque,monocoque_structure:b.monocoque_structure,flammable:b.flammable,dragfactor:b.dragfactor,massfactor:b.massfactor});this.has_tractor_nacelles=this.boom=this.farman=
!1;this.sel_tail=2;this.tail_list=[];for(let b of a.tail)this.tail_list.push({name:b.name,stats:new Stats(b)});this.is_tandem=this.flying_wing=!1;this.section_list=[];this.tail_section_list=[];this.SetRequiredSections(1)}toJSON(){return{sections:this.section_list,tail_sections:this.tail_section_list,tail_index:this.sel_tail,use_farman:this.farman,use_boom:this.boom,flying_wing:this.flying_wing,sel_skin:this.sel_skin}}fromJSON(a,b){this.section_list=[];for(let c of a.sections)this.section_list.push({frame:c.frame,
geodesic:c.geodesic,monocoque:c.monocoque,lifting_body:c.lifting_body,internal_bracing:c.internal_bracing}),10.25>b&&(this.sel_skin=c.skin);this.tail_section_list=[];for(let c of a.tail_sections)this.tail_section_list.push({frame:c.frame,geodesic:c.geodesic,monocoque:c.monocoque,lifting_body:c.lifting_body,internal_bracing:c.internal_bracing}),10.25>b&&(this.sel_skin=c.skin);this.farman=a.use_farman;this.boom=a.use_boom;this.sel_tail=a.tail_index;this.flying_wing=a.flying_wing;10.25<b&&(this.sel_skin=
a.sel_skin)}serialize(a){a.PushNum(this.section_list.length);for(var b=0;b<this.section_list.length;b++){var c=this.section_list[b];a.PushNum(c.frame);a.PushBool(c.geodesic);a.PushBool(c.monocoque);a.PushBool(c.lifting_body);a.PushBool(c.internal_bracing)}a.PushNum(this.tail_section_list.length);for(b=0;b<this.tail_section_list.length;b++)c=this.tail_section_list[b],a.PushNum(c.frame),a.PushBool(c.geodesic),a.PushBool(c.monocoque),a.PushBool(c.lifting_body),a.PushBool(c.internal_bracing);a.PushNum(this.sel_tail);
a.PushBool(this.farman);a.PushBool(this.boom);a.PushBool(this.flying_wing);a.PushNum(this.sel_skin)}deserialize(a){var b=a.GetNum();this.section_list=[];for(var c=0;c<b;c++){var d={frame:0,skin:0,geodesic:!1,monocoque:!1,lifting_body:!1,internal_bracing:!1};d.frame=a.GetNum();10.25>a.version&&(this.sel_skin=a.GetNum());d.geodesic=a.GetBool();d.monocoque=a.GetBool();d.lifting_body=a.GetBool();d.internal_bracing=a.GetBool();this.section_list.push(d)}b=a.GetNum();this.tail_section_list=[];for(c=0;c<
b;c++)d={frame:0,skin:0,geodesic:!1,monocoque:!1,lifting_body:!1,internal_bracing:!1},d.frame=a.GetNum(),10.25>a.version&&(this.sel_skin=a.GetNum()),d.geodesic=a.GetBool(),d.monocoque=a.GetBool(),d.lifting_body=a.GetBool(),d.internal_bracing=a.GetBool(),this.tail_section_list.push(d);this.sel_tail=a.GetNum();this.farman=a.GetBool();this.boom=a.GetBool();this.flying_wing=a.GetBool();10.25<a.version&&(this.sel_skin=a.GetNum())}DuplicateSection(a,b=1){var c=this.section_list[a];c={frame:c.frame,geodesic:c.geodesic,
monocoque:c.monocoque,lifting_body:c.lifting_body,internal_bracing:c.internal_bracing};if(!c.internal_bracing||this.CountSections()+this.tail_section_list.length!=this.CountInternalBracing()){for(let d=0;d<b;d++)this.section_list.splice(a,0,c);this.CalculateStats()}}DuplicateTailSection(a,b=1){var c=this.tail_section_list[a];c={frame:c.frame,geodesic:c.geodesic,monocoque:c.monocoque,lifting_body:c.lifting_body,internal_bracing:c.internal_bracing};if(!c.internal_bracing||this.CountSections()!=this.CountInternalBracing()){for(let d=
0;d<b;d++)this.tail_section_list.splice(a,0,c);this.CalculateStats()}}DeleteSection(a){if(this.required_sections!=this.CountSections()||this.section_list[a].internal_bracing){this.section_list.splice(a,1);if(this.CountInternalBracing()>this.CountSections()+this.tail_section_list.length)for(a=this.section_list.length-1;0<=a;a--)if(this.section_list[a].internal_bracing){this.section_list.splice(a,1);break}this.CalculateStats()}}SetRequiredSections(a){this.required_sections=a;if(this.required_sections>
this.CountSections()&&(0==this.section_list.length&&this.section_list.push({frame:0,geodesic:!1,monocoque:!1,lifting_body:!1,internal_bracing:!1}),0<this.required_sections-this.CountSections()))for(a=this.section_list.length-1;0<=a;a--)if(!this.section_list[a].internal_bracing){this.DuplicateSection(a,this.required_sections-this.CountSections());break}}SetRequiredTailSections(a){a>this.tail_section_list.length&&(0==this.tail_section_list.length&&this.tail_section_list.push({frame:0,geodesic:!1,monocoque:!1,
lifting_body:!1,internal_bracing:!1}),0<a-this.tail_section_list.length&&this.DuplicateTailSection(this.tail_section_list.length-1,a-this.tail_section_list.length));for(;a<this.tail_section_list.length;)this.tail_section_list.pop();for(;this.CountSections()+a<this.CountInternalBracing();){let b=this.section_list.length-1;for(;0<b&&!this.section_list[b].internal_bracing;b--);this.DeleteSection(b)}this.CalculateStats()}CountSections(){var a=0;for(let b of this.section_list)b.internal_bracing||a++;return a}GetNumFrames(){return this.CountSections()+
this.tail_section_list.length}CountInternalBracing(){var a=0;for(let b of this.section_list)b.internal_bracing&&a++;return a}BaseType(){var a=[...Array(this.frame_list.length).fill(0)];for(var b of this.section_list)b.internal_bracing||a[b.frame]++;for(var c of this.tail_section_list)c.internal_bracing||a[c.frame]++;c=b=0;for(let d=a.length-1;0<=d;d--)a[d]>c&&(c=a[d],b=d);return b}GetFrameList(){return this.frame_list}GetSkinList(){return this.skin_list}GetSectionList(){return this.section_list}SetFrame(a,
b){this.section_list[a].frame=b;this.frame_list[b].geodesic||(this.section_list[a].geodesic=!1);this.CalculateStats()}SetGeodesic(a,b){this.frame_list[this.section_list[a].frame].geodesic&&(this.section_list[a].geodesic=b,this.CalculateStats())}SetMonocoque(a,b){this.skin_list[this.sel_skin].monocoque&&(this.section_list[a].monocoque=b,this.CalculateStats())}SetLiftingBody(a,b){this.skin_list[this.sel_skin].monocoque&&(this.section_list[a].lifting_body=b,this.CalculateStats())}SetInternalBracing(a,
b){b&&!this.section_list[a].internal_bracing&&this.PossibleInternalBracing(!0)&&this.CountSections()>this.required_sections?(this.section_list[a].internal_bracing=!0,this.section_list[a].monocoque=!1,this.section_list[a].lifting_body=!1,this.CalculateStats()):b||(this.section_list[a].internal_bracing=!1,this.CalculateStats())}PossibleInternalBracing(a=!1){var b=this.CountSections();this.farman||(b+=this.tail_section_list.length);a&&--b;return this.CountInternalBracing()+1<=b}PossibleGeodesic(a){return this.frame_list[this.section_list[a].frame].geodesic&&
!this.section_list[a].monocoque}PossibleMonocoque(a){return this.skin_list[this.sel_skin].monocoque&&!this.section_list[a].internal_bracing&&!this.section_list[a].lifting_body}PossibleLiftingBody(a){return this.skin_list[this.sel_skin].monocoque&&!this.section_list[a].internal_bracing&&!this.section_list[a].monocoque}PossibleTailGeodesic(a){return this.frame_list[this.tail_section_list[a].frame].geodesic&&!this.tail_section_list[a].monocoque}PossibleTailMonocoque(a){return this.skin_list[this.sel_skin].monocoque&&
!this.farman&&!this.tail_section_list[a].lifting_body}PossibleTailLiftingBody(a){return this.skin_list[this.sel_skin].monocoque&&!this.farman&&!this.tail_section_list[a].monocoque}PossibleRemoveSections(){return this.CountSections()>this.required_sections}GetFarmanOrBoom(){return this.farman||this.boom}SectionStats(a){var b=new Stats;b=b.Add(this.frame_list[a.frame].stats);a.geodesic&&(b.structure*=1.5,b.cost*=2,b.era.push({name:"Geodesic",era:"Coming Storm"}));a.lifting_body&&(b.wingarea+=3);a.internal_bracing||
(b.drag+=4,a.monocoque&&(b.mass=0,b.cost+=1,b.structure=this.skin_list[this.sel_skin].monocoque_structure),b=b.Add(this.skin_list[this.sel_skin].stats));return b}TailSectionStats(a){var b=new Stats;b=b.Add(this.frame_list[a.frame].stats);a.geodesic&&(b.structure*=1.5,b.cost*=2,b.era.push({name:"Geodesic",era:"Coming Storm"}));a.lifting_body&&(b.wingarea+=3);b.drag+=4;this.farman||(a.monocoque&&(b.mass=0,b.cost+=1,b.structure=this.skin_list[this.sel_skin].monocoque_structure),b=b.Add(this.skin_list[this.sel_skin].stats));
return b}CountMainLiftingBody(){var a=0;for(let b of this.section_list)b.lifting_body&&a++;return a}CountTailLiftingBody(){var a=0;for(let b of this.tail_section_list)b.lifting_body&&a++;return a}CountLiftingBody(){return this.CountMainLiftingBody()+this.CountTailLiftingBody()}SetIsTandem(a){this.is_tandem!=a&&(this.is_tandem=a,this.SetTailType(this.sel_tail))}SetTailType(a){0==this.tail_list[a].stats.reqsections&&this.is_tandem&&a++;this.sel_tail=a;this.SetRequiredTailSections(this.tail_list[a].stats.reqsections)}GetTailType(){return this.sel_tail}GetTailList(){return this.tail_list}GetTailSectionList(){return this.tail_section_list}SetUseFarman(a){(this.farman=
a)&&this.boom&&(this.boom=!1);if(this.farman)for(let b of this.tail_section_list)b.monocoque=!1,b.lifting_body=!1;this.CalculateStats()}GetUseFarman(){return this.farman}SetUseBoom(a){(this.boom=a)&&this.farman&&(this.farman=!1);this.CalculateStats()}GetUseBoom(){return this.boom}SetTailFrame(a,b){this.tail_section_list[a].frame=b;this.frame_list[b].geodesic||(this.tail_section_list[a].geodesic=!1);this.CalculateStats()}SetTailGeodesic(a,b){this.frame_list[this.tail_section_list[a].frame].geodesic&&
(this.tail_section_list[a].geodesic=b,this.CalculateStats())}SetTailMonocoque(a,b){this.skin_list[this.sel_skin].monocoque&&!this.farman&&(this.tail_section_list[a].monocoque=b,this.CalculateStats())}SetTailLiftingBody(a,b){this.skin_list[this.sel_skin].monocoque&&!this.farman&&(this.tail_section_list[a].lifting_body=b,this.CalculateStats())}SetHasTractorNacelles(a){this.has_tractor_nacelles=a}GetHasTractorNacelles(){return this.has_tractor_nacelles}CanFlyingWing(){for(let a of this.section_list)if(a.lifting_body)return!0;
for(let a of this.tail_section_list)if(a.lifting_body)return!0;return!1}GetFlyingWing(){return this.flying_wing}SetFlyingWing(a){a&&this.CanFlyingWing()?this.flying_wing=!0:this.flying_wing=!1;this.CalculateStats()}GetIsTailless(){return 0==this.tail_section_list.length}SetAllFrame(a){for(let b of this.section_list)b.frame=a,this.frame_list[a].geodesic||(b.geodesic=!1);for(let b of this.tail_section_list)b.frame=a,this.frame_list[a].geodesic||(b.geodesic=!1);this.CalculateStats()}SetAllSkin(a){this.sel_skin=
a;for(let b of this.section_list)b.internal_bracing||this.skin_list[a].monocoque||(b.monocoque=!1,b.lifting_body=!1);for(let b of this.tail_section_list)b.internal_bracing||this.skin_list[a].monocoque||(b.monocoque=!1,b.lifting_body=!1);this.CalculateStats()}GetArmor(){return"Dragon Skin"==this.skin_list[this.sel_skin].name?5:0}GetIsFlammable(){return this.skin_list[this.sel_skin].flammable?!0:!1}GetSkin(){return this.sel_skin}CanCutout(){let a=this.section_list.length*this.skin_list[this.sel_skin].stats.visibility;
a=this.farman?a+this.tail_section_list.length:a+this.tail_section_list.length*this.skin_list[this.sel_skin].stats.visibility;return 3>a}SetCalculateStats(a){this.CalculateStats=a}PartStats(){this.CanFlyingWing()||(this.flying_wing=!1);var a=new Stats,b=this.BaseType();a.structure=this.frame_list[b].basestruct;a.cost=this.frame_list[b].basecost;b=0>this.skin_list[this.sel_skin].monocoque_structure;for(var c of this.section_list)a=a.Add(this.SectionStats(c)),b=b&&(c.internal_bracing||c.monocoque);c=
new Stats;for(var d of this.tail_section_list)c=c.Add(this.TailSectionStats(d)),this.farman||(b=b&&(d.internal_bracing||d.monocoque));b&&(a.structure+=30);a=a.Add(this.tail_list[this.sel_tail].stats);this.boom&&(c.maxstrain-=c.mass,this.has_tractor_nacelles||(c.drag=Math.floor(1E-6+1.5*c.drag)));this.farman?(a.drag*=this.skin_list[this.sel_skin].dragfactor,a.mass*=this.skin_list[this.sel_skin].massfactor,a.visibility+=this.tail_section_list.length,c.mass=Math.floor(1E-6+.5*c.mass),a=a.Add(c)):(a=
a.Add(c),a.drag*=this.skin_list[this.sel_skin].dragfactor,a.mass*=this.skin_list[this.sel_skin].massfactor);d=this.CountLiftingBody();a.cost+=d;this.flying_wing?a.liftbleed+=5:a.drag+=d;this.PossibleRemoveSections()&&this.CountMainLiftingBody()<this.CountSections()&&a.warnings.push({source:lu("Frame Count"),warning:lu("Frame Count Warning"),color:WARNING_COLOR.YELLOW});a.structure=Math.floor(1E-6+a.structure);a.cost=Math.floor(1E-6+a.cost);a.visibility=Math.min(a.visibility,3);a.Round();return a}GetElectrics(){return{storage:0,
equipment:[]}}}var WING_DECK;(function(a){a[a.PARASOL=0]="PARASOL";a[a.SHOULDER=1]="SHOULDER";a[a.MID=2]="MID";a[a.LOW=3]="LOW";a[a.GEAR=4]="GEAR"})(WING_DECK||={});
class Wings extends Part{constructor(a){super();this.skin_list=[];for(let b of a.surface)this.skin_list.push({name:b.name,flammable:b.flammable,stats:new Stats(b),strainfactor:b.strainfactor,dragfactor:b.dragfactor,metal:b.metal,transparent:b.transparent});this.stagger_list=[];for(let b of a.stagger)this.stagger_list.push({name:b.name,inline:b.inline,wing_count:b.wing_count,hstab:b.hstab,stats:new Stats(b)});this.deck_list=[];for(let b of a.decks)this.deck_list.push({name:b.name,limited:b.limited,
stats:new Stats(b)});this.long_list=[];for(let b of a.largest)this.long_list.push({dragfactor:b.dragfactor,stats:new Stats(b)});this.wing_list=[];this.mini_wing_list=[];this.wing_stagger=Math.floor(1E-6+this.stagger_list.length/2);this.is_closed=this.is_swept=!1;this.rotor_span=0}toJSON(){return{wing_list:this.wing_list,mini_wing_list:this.mini_wing_list,wing_stagger:this.wing_stagger,is_swept:this.is_swept,is_closed:this.is_closed}}fromJSON(a,b){11.15<b?(this.wing_list=a.wing_list,this.mini_wing_list=
a.mini_wing_list):(this.wing_list=this.OldtoNew(a.wing_list),this.mini_wing_list=this.OldtoNew(a.mini_wing_list));this.wing_stagger=a.wing_stagger;this.is_swept=a.is_swept;this.is_closed=a.is_closed}OldtoNew(a){var b=[];for(let c of a)b.push({surface:c.surface,area:c.area,span:c.span,anhedral:c.anhedral,dihedral:c.dihedral,gull:!1,deck:c.deck});return b}serialize(a){a.PushNum(this.wing_list.length);for(var b=0;b<this.wing_list.length;b++){var c=this.wing_list[b];a.PushNum(c.surface);a.PushNum(c.area);
a.PushNum(c.span);a.PushNum(c.dihedral);a.PushNum(c.anhedral);a.PushBool(c.gull);a.PushNum(c.deck)}a.PushNum(this.mini_wing_list.length);for(b=0;b<this.mini_wing_list.length;b++)c=this.mini_wing_list[b],a.PushNum(c.surface),a.PushNum(c.area),a.PushNum(c.span),a.PushNum(c.dihedral),a.PushNum(c.anhedral),a.PushBool(c.gull),a.PushNum(c.deck);a.PushNum(this.wing_stagger);a.PushBool(this.is_swept);a.PushBool(this.is_closed)}deserialize(a){var b=a.GetNum();this.wing_list=[];for(var c=0;c<b;c++){var d={surface:0,
area:0,span:0,anhedral:0,dihedral:0,gull:!1,deck:0};d.surface=a.GetNum();d.area=a.GetNum();d.span=a.GetNum();11.15<a.version?(d.dihedral=a.GetNum(),d.anhedral=a.GetNum(),d.gull=a.GetBool()):(d.dihedral=a.GetNum(),d.anhedral=a.GetNum(),d.gull=!1);d.deck=a.GetNum();this.wing_list.push(d)}b=a.GetNum();this.mini_wing_list=[];for(c=0;c<b;c++)d={surface:0,area:0,span:0,anhedral:0,dihedral:0,gull:!1,deck:0},d.surface=a.GetNum(),d.area=a.GetNum(),d.span=a.GetNum(),11.15<a.version?(d.dihedral=a.GetNum(),d.anhedral=
a.GetNum(),d.gull=a.GetBool()):(d.dihedral=a.GetNum(),d.anhedral=a.GetNum(),d.gull=!1),d.deck=a.GetNum(),this.mini_wing_list.push(d);this.wing_stagger=a.GetNum();this.is_swept=a.GetBool();this.is_closed=a.GetBool()}SetRotorSpan(a){this.rotor_span=a}GetWingList(){return this.wing_list}GetMiniWingList(){return this.mini_wing_list}GetSkinList(){return this.skin_list}GetStaggerList(){return this.stagger_list}GetDeckList(){return this.deck_list}DeckCountFull(){var a=[...Array(this.deck_list.length).fill(0)];
for(let b of this.wing_list)a[b.deck]++;return a}DeckCountMini(){var a=[...Array(this.deck_list.length).fill(0)];for(let b of this.mini_wing_list)a[b.deck]++;return a}CanStagger(){var a=[...Array(this.stagger_list.length).fill(!1)];if(this.acft_type==AIRCRAFT_TYPE.ORNITHOPTER_FLUTTER)1<this.wing_list.length?a[1]=!0:a[0]=!0;else{if(1<this.wing_list.length)for(let b=1;b<this.stagger_list.length;b++)a[b]=!0;1==this.wing_list.length&&(a[0]=!0)}return a}SetAcftType(a){this.acft_type=a;a==AIRCRAFT_TYPE.ORNITHOPTER_FLUTTER&&
(this.wing_stagger=1<this.wing_list.length?1:0)}SetStagger(a){for(this.wing_stagger=a;this.stagger_list[a].wing_count<this.wing_list.length;)this.wing_list.pop();if(!this.stagger_list[a].inline){a=this.DeckCountFull();for(let b=this.wing_list.length-1;0<=b;b--){let c=this.wing_list[b];1<a[c.deck]&&this.deck_list[c.deck].limited&&(a[c.deck]--,this.wing_list.splice(b,1))}}this.CalculateStats()}GetStagger(){return 0<this.wing_list.length?this.wing_stagger:-1}CanAddFullWing(a){a>=this.deck_list.length&&
console.log("Deck out of Bounds");return!this.stagger_list[this.wing_stagger].inline&&(a==WING_DECK.SHOULDER&&this.HasPolishWing()||this.DeckCountFull()[a]==WING_DECK.SHOULDER&&this.deck_list[a].limited)||0!=this.DeckCountMini()[a]?!1:!0}CanAddMiniWing(a){var b=this.DeckCountFull(),c=this.DeckCountMini();return 0!=b[a]||0!=c[a]?!1:!0}CanMoveFullWing(a,b){var c=this.wing_list[a];this.wing_list.splice(a,1);b=this.CanAddFullWing(b);this.wing_list.splice(a,0,c);return b}CanMoveMiniWing(a,b){var c=this.mini_wing_list[a];
this.mini_wing_list.splice(a,1);b=this.CanAddMiniWing(b);this.mini_wing_list.splice(a,0,c);return b}GetWingHeight(){var a=0;for(let b of this.wing_list)a=Math.max(a,4-b.deck);return a}CanClosed(){return 1<this.wing_list.length}SetClosed(a){this.is_closed=0<this.wing_list.length?a:!1;this.CalculateStats()}GetClosed(){return this.is_closed}CanSwept(){return 0<this.wing_list.length}SetSwept(a){this.is_swept=0<this.wing_list.length?a:!1;this.CalculateStats()}GetSwept(){return this.is_swept}GetTandem(){return this.stagger_list[this.wing_stagger].inline&&
1<this.wing_list.length}GetMonoplane(){return 1==this.wing_list.length}GetStaggered(){return 0!=this.stagger_list[this.wing_stagger].stats.liftbleed}SetFullWing(a,b){this.wing_list.length!=a&&this.wing_list.splice(a,1);b.area!=b.area&&(b.area=3);b.area=Math.floor(1E-6+b.area);b.span!=b.span&&(b.span=1);b.span=Math.floor(1E-6+b.span);0<=b.deck&&(b.area=Math.max(b.area,3),b.span=Math.max(b.span,1),this.CanAddFullWing(b.deck)&&this.wing_list.splice(a,0,b));1<this.wing_list.length&&0==this.wing_stagger?
this.wing_stagger=4:1>=this.wing_list.length&&(this.wing_stagger=0);b.dihedral=Math.min(b.dihedral,b.span-1);b.anhedral=Math.min(b.anhedral,b.span-1-b.dihedral);this.CalculateStats()}SetMiniWing(a,b){this.mini_wing_list.length!=a&&this.mini_wing_list.splice(a,1);b.area!=b.area&&(b.area=2);b.area=Math.floor(1E-6+b.area);b.span!=b.span&&(b.span=1);b.span=Math.floor(1E-6+b.span);0<=b.deck&&(b.area=Math.max(b.area,1),b.area=Math.min(b.area,2),b.span=Math.max(b.span,1),this.CanAddMiniWing(b.deck)&&this.mini_wing_list.splice(a,
0,b));this.CalculateStats()}HasNonGullDeck(a){for(let b of this.wing_list)if(b.deck==a&&!b.gull)return!0;return!1}CanGull(a){if(a==WING_DECK.PARASOL){if(!this.GetTandem()&&this.HasNonGullDeck(WING_DECK.SHOULDER))return!1}else if(a==WING_DECK.SHOULDER||!this.GetTandem()&&this.HasNonGullDeck(a-1))return!1;return!0}IsFlammable(){for(let a of this.wing_list)if(this.skin_list[a.surface].flammable)return!0;for(let a of this.mini_wing_list)if(this.skin_list[a.surface].flammable)return!0;return!1}NeedHStab(){return this.stagger_list[this.wing_stagger].hstab}NeedTail(){return this.NeedHStab()||
!this.is_swept}GetSpan(){var a=0;for(let b of this.wing_list)a=Math.max(a,b.span);for(let b of this.mini_wing_list)a=Math.max(a,b.span);return a}GetArea(){var a=0;for(let b of this.wing_list)a+=b.area;for(let b of this.mini_wing_list)a+=b.area;return a}GetParasol(){for(let a of this.wing_list)if(a.deck==WING_DECK.PARASOL)return!0;for(let a of this.mini_wing_list)if(a.deck==WING_DECK.PARASOL)return!0;return!1}GetMetalArea(){var a=0;for(let b of this.wing_list)this.skin_list[b.surface].metal&&(a+=b.area);
for(let b of this.mini_wing_list)this.skin_list[b.surface].metal&&(a+=b.area);return a}GetWingDrag(){var a=0,b=this.DeckCountFull();for(let e of this.wing_list){var c=e.span;let f=e.area;e.gull&&(f=Math.floor(1E-6+1.1*f));c=Math.max(1,6*f*f/(c*c));c=Math.max(1,c*this.skin_list[e.surface].dragfactor);this.stagger_list[this.wing_stagger].inline&&1<b[e.deck]&&(c=Math.floor(1E-6+.75*c),c=Math.max(1,c));c=Math.floor(1E-6+c);a+=c}for(var d of this.mini_wing_list)b=d.span,c=Math.max(1,6*d.area*d.area/(b*
b)),c=Math.max(1,c*this.skin_list[d.surface].dragfactor),c=Math.floor(1E-6+c),a+=c;d=this.GetIsSesquiplane();(d.is||this.GetMonoplane())&&-1!=d.deck&&(a-=Math.floor(1E-6+0*(1-this.long_list[d.deck].dragfactor)));return a}GetIsFlammable(){for(let a of this.wing_list)if(this.skin_list[a.surface].flammable)return!0;for(let a of this.mini_wing_list)if(this.skin_list[a.surface].flammable)return!0;return!1}SetAircraftMass(a){this.plane_mass=a}GetPaperMass(){var a=0;for(let c of this.wing_list){var b=this.skin_list[c.surface].stats.Multiply(c.area);
b.Round();0>b.mass&&(a+=b.mass)}for(let c of this.mini_wing_list)b=this.skin_list[c.surface].stats.Multiply(c.area),b.Round(),0>b.mass&&(a+=b.mass);return Math.max(-Math.floor(1E-6+.25*this.plane_mass),a)}GetIsSesquiplane(){var a=0,b=-1,c=0,d=1E100,e=0;for(let f of this.wing_list)f.area>a?(a=f.area,b=f.deck,c=f.span):f.area==a&&(b=-1),d>f.area&&(d=f.area,e=f.span);return(a=a>=2*d&&!this.GetMonoplane()&&!this.GetTandem())?{is:a,deck:b,super_small:.75*c>=e}:{is:!1,deck:b,super_small:!1}}HasPolishWing(){for(let a of this.wing_list)if(a.deck==
WING_DECK.PARASOL&&1==a.gull)return!0;return!1}HasInvertedGull(){var a=-1;for(let b of this.wing_list)b.gull&&b.deck>WING_DECK.SHOULDER&&(a=Math.max(a,b.deck));return a}CanCutout(){let a=0;for(let b of this.wing_list)this.skin_list[b.surface].transparent&&(a+=1);return 3>a}PartStats(){this.CanClosed()||(this.is_closed=!1);this.CanSwept()||(this.is_swept=!1);var a=new Stats,b=!1,c=this.DeckCountFull(),d=!1,e=this.rotor_span,f=0,h=0;for(let k of this.wing_list){e=Math.max(e,k.span);b?(a.control+=3,
a.liftbleed+=5,--a.visibility):b=!0;var g=new Stats;g=g.Add(this.skin_list[k.surface].stats.Multiply(k.area));g.wingarea=k.area;g.maxstrain+=Math.min(0,-(2*k.span+k.area-10));this.acft_type==AIRCRAFT_TYPE.ORNITHOPTER_BUZZER&&(g.maxstrain+=Math.min(0,-(2*k.span+k.area-10)));g.maxstrain*=this.skin_list[k.surface].strainfactor;this.skin_list[k.surface].transparent&&3>h&&(g.visibility+=1,h+=1);let m=k.span,n=k.area;k.gull&&(n=Math.floor(1E-6+1.1*n));g.drag+=Math.max(1,6*n*n/(m*m));g.drag=Math.max(1,g.drag*
this.skin_list[k.surface].dragfactor);this.stagger_list[this.wing_stagger].inline&&1<c[k.deck]&&(g.drag=Math.floor(1E-6+.75*g.drag),g.drag=Math.max(1,g.drag));a=a.Add(this.deck_list[k.deck].stats);g.latstab+=k.dihedral-k.anhedral;g.liftbleed+=k.dihedral+k.anhedral;g.Round();e==k.span&&(f=g.drag);0>g.mass&&(g.mass=0);a=a.Add(g)}for(let k of this.mini_wing_list)e=Math.max(e,k.span),a.control+=1,d?a.liftbleed+=1:d=!0,g=this.skin_list[k.surface].stats.Multiply(k.area),g.wingarea=k.area,g.maxstrain+=Math.min(0,
-(2*k.span+k.area-10)),g.maxstrain*=this.skin_list[k.surface].strainfactor,b=k.span,g.drag=Math.max(1,g.drag+6*k.area*k.area/(b*b)),g.drag=Math.max(1,g.drag*this.skin_list[k.surface].dragfactor),g.latstab+=k.dihedral-k.anhedral,g.liftbleed+=k.dihedral+k.anhedral,g.Round(),0>g.mass&&(g.mass=0),a=a.Add(g);a.control+=8-e;a.latstab+=Math.min(0,e-8);d=this.GetIsSesquiplane();(d.is||this.GetMonoplane())&&-1!=d.deck&&(a=a.Add(this.long_list[d.deck].stats),a.drag-=Math.floor(1E-6+(1-this.long_list[d.deck].dragfactor)*
f));d.is&&(a.liftbleed-=2,a.control+=2);if(this.stagger_list[this.wing_stagger].inline)for(let k of c)1<k&&(a.liftbleed+=3*(k-1));this.HasPolishWing()&&(a.visibility+=1,a.maxstrain+=10);switch(this.HasInvertedGull()){case 4:a.maxstrain+=10,a.crashsafety+=1}(0<this.HasInvertedGull()||this.HasPolishWing())&&a.era.push({name:"Gull Wing",era:"Coming Storm"});this.is_swept&&(a.liftbleed+=5,a.latstab--);this.is_closed&&(c=Math.floor(1E-6+this.wing_list.length/2),a.mass+=1*c,a.control-=5*c,a.maxstrain+=
20*c);1<this.wing_list.length&&(a=a.Add(this.stagger_list[this.wing_stagger].stats));return a}SetCalculateStats(a){this.CalculateStats=a}GetElectrics(){let a={storage:0,equipment:[]};var b=0,c="";for(let d of this.wing_list){let e=this.skin_list[d.surface];0!=e.stats.charge&&(c=lu(e.name),b+=e.stats.charge*d.area)}b=Math.floor(1E-6+b);0!=b&&a.equipment.push({source:c,charge:b.toString()});return a}}
class Stabilizers extends Part{constructor(a){super();this.have_tail=!0;this.is_heli=this.is_swept=this.is_tandem=!1;this.hstab_sel=0;this.hstab_count=1;this.hstab_list=[];for(let b of a.hstab)this.hstab_list.push({name:b.name,is_canard:b.is_canard,increment:b.increment,stats:new Stats(b),dragfactor:b.dragfactor,is_vtail:b.is_vtail,is_tail:b.is_tail});this.vstab_sel=0;this.vstab_count=1;this.vstab_list=[];for(let b of a.vstab)this.vstab_list.push({name:b.name,increment:b.increment,stats:new Stats(b),
dragfactor:b.dragfactor,is_vtail:b.is_vtail,is_tail:b.is_tail})}toJSON(){return{hstab_sel:this.hstab_sel,hstab_count:this.hstab_count,vstab_sel:this.vstab_sel,vstab_count:this.vstab_count}}fromJSON(a,b){this.hstab_sel=a.hstab_sel;this.hstab_count=a.hstab_count;this.vstab_sel=a.vstab_sel;this.vstab_count=a.vstab_count}serialize(a){a.PushNum(this.hstab_sel);a.PushNum(this.hstab_count);a.PushNum(this.vstab_sel);a.PushNum(this.vstab_count)}deserialize(a){this.hstab_sel=a.GetNum();this.hstab_count=a.GetNum();
this.vstab_sel=a.GetNum();this.vstab_count=a.GetNum()}GetHStabList(){return this.hstab_list}GetVStabList(){return this.vstab_list}GetHStabType(){return this.hstab_sel}SetHStabType(a){if("The Wings"!=this.hstab_list[a].name||this.is_tandem||this.is_swept)this.hstab_list[a].is_vtail?this.SetVTail():this.hstab_list[this.hstab_sel].is_vtail&&(this.vstab_sel=0,this.vstab_count=1),this.hstab_sel=a,this.SetHStabCount(this.hstab_count),this.CalculateStats()}GetHValidList(){var a=[];if(this.is_heli)a=Array(this.hstab_list.length).fill(!1),
this.have_tail?a[0]=!0:a[1]=!0;else for(let b of this.hstab_list)"The Wings"!=b.name&&"Outboard"!=b.name||this.is_tandem||this.is_swept?b.is_tail&&!this.have_tail?a.push(!1):a.push(!0):a.push(!1);return a}GetIsVTail(){return this.hstab_list[this.hstab_sel].is_vtail}SetVTail(){for(var a=0;a<this.hstab_list.length;a++)this.hstab_list[a].is_vtail&&(this.hstab_sel=a);for(a=0;a<this.vstab_list.length;a++)this.vstab_list[a].is_vtail&&(this.vstab_sel=a);this.hstab_count=1;this.vstab_count=0}GetVStabType(){return this.vstab_sel}SetVStabType(a){if("Outboard"!=
this.vstab_list[a].name||this.CanVOutboard())this.vstab_list[a].is_vtail?this.SetVTail():this.vstab_list[this.vstab_sel].is_vtail&&(this.hstab_sel=0,this.vstab_count=1),this.vstab_sel=a,this.SetVStabCount(this.vstab_count),this.CalculateStats()}GetVValidList(){var a=[];if(this.is_heli)a=Array(this.vstab_list.length).fill(!1),a[0]=!0;else for(let b of this.vstab_list)"Outboard"!=b.name||this.CanVOutboard()?b.is_tail&&!this.have_tail?a.push(!1):a.push(!0):a.push(!1);return a}GetHStabCount(){return this.hstab_count}SetHStabCount(a){if(a!=
a||0>a)a=0;this.hstab_count=a=Math.floor(1E-6+a);if(0!=this.hstab_list[this.hstab_sel].increment)for(;0!=this.hstab_count%this.hstab_list[this.hstab_sel].increment;)this.hstab_count++;else this.hstab_count=0;this.CalculateStats()}GetHStabIncrement(){return 0<=this.hstab_sel?this.hstab_list[this.hstab_sel].increment:1}GetVStabCount(){return this.vstab_count}SetVStabCount(a){if(a!=a||0>a)a=0;this.vstab_count=a=Math.floor(1E-6+a);if(0!=this.vstab_list[this.vstab_sel].increment)for(;0!=this.vstab_count%
this.vstab_list[this.vstab_sel].increment;)this.vstab_count++;else this.vstab_count=0;this.CalculateStats()}GetVStabIncrement(){return 0<=this.vstab_sel?this.vstab_list[this.vstab_sel].increment:1}SetEngineCount(a){this.engine_count=a}GetIsTandem(){return this.is_tandem}SetIsTandem(a){this.is_tandem=a}SetIsSwept(a){this.is_swept=a}CanVOutboard(){return this.is_swept||this.is_tandem||this.hstab_list[this.hstab_sel].is_canard&&0<this.hstab_count}GetVOutboard(){return"Outboard"==this.vstab_list[this.vstab_sel].name}GetCanard(){return this.hstab_list[this.hstab_sel].is_canard}SetLiftingArea(a){this.lifting_area=
a}SetHaveTail(a){this.have_tail=a;a||(this.GetHValidList()[this.hstab_sel]||(this.hstab_sel=2),a=this.GetVValidList(),a[this.vstab_sel]||(a[1]||(this.hstab_sel=2),this.vstab_sel=1,0!=this.vstab_count%2&&this.vstab_count++));this.is_heli&&(this.hstab_sel=this.have_tail?0:1,this.hstab_count=1)}SetHelicopter(a){if(this.is_heli=a)this.have_tail=!0,this.is_swept=this.is_tandem=!1,this.hstab_sel=this.engine_count=this.lifting_area=0,this.hstab_count=1,this.vstab_sel=0,this.vstab_count=1}SetCalculateStats(a){this.CalculateStats=
a}PartStats(){var a=this.GetHValidList();a[this.hstab_sel]||(this.hstab_sel=0,a[this.hstab_sel]||(this.hstab_count=this.hstab_sel=0));a=this.GetVValidList();a[this.vstab_sel]||(this.vstab_sel=0,a[this.vstab_sel]||(this.vstab_count=this.vstab_sel=0));a=new Stats;if(0<this.hstab_count)if(a=a.Add(this.hstab_list[this.hstab_sel].stats),this.is_heli){var b=Math.floor(1E-6+this.wing_drag/8*this.hstab_list[this.hstab_sel].dragfactor);a.drag+=Math.max(Math.ceil(1*this.hstab_list[this.hstab_sel].dragfactor),
b)}else b=Math.floor(1E-6+this.wing_drag/4*this.hstab_list[this.hstab_sel].dragfactor),a.drag+=Math.max(1,b);else if(0>this.hstab_sel||0!=this.hstab_list[this.hstab_sel].increment)a.pitchstab-=Math.floor(1E-6+this.lifting_area/2),a.liftbleed+=5;if(0<this.vstab_count)a=a.Add(this.vstab_list[this.vstab_sel].stats),this.is_heli?(b=Math.floor(1E-6+this.wing_drag/16*this.vstab_list[this.vstab_sel].dragfactor),a.drag+=Math.max(Math.ceil(1*this.hstab_list[this.hstab_sel].dragfactor),b)):(b=Math.floor(1E-6+
this.wing_drag/8*this.vstab_list[this.vstab_sel].dragfactor),a.drag+=Math.max(1,b));else if(0>this.vstab_sel||0!=this.vstab_list[this.vstab_sel].increment||0==this.vstab_list[this.vstab_sel].increment&&0==this.hstab_count)a.latstab-=this.lifting_area;a.drag+=2*(Math.max(0,this.hstab_count-1)+Math.max(0,this.vstab_count-1));if(0<=this.vstab_sel&&0!=this.vstab_list[this.vstab_sel].increment){b=Math.max(0,this.hstab_count-1);var c=Math.min(this.engine_count-1,this.vstab_count-1);b+=Math.max(0,this.vstab_count-
1-c)}else c=Math.max(0,Math.min(this.engine_count-1,this.hstab_count-1)),b=Math.max(0,this.hstab_count-1-c);a.control+=3*c+b;return a}GetElectrics(){return{storage:0,equipment:[]}}}
class ControlSurfaces extends Part{constructor(a){super();this.mp=this.wing_area=this.is_cantilever=this.span=0;this.is_boom=!1;this.acft_type=AIRCRAFT_TYPE.AIRPLANE;this.aileron_sel=0;this.aileron_list=[];for(let b of a.ailerons)this.aileron_list.push({name:b.name,warping:b.warping,stats:new Stats(b)});this.rudder_sel=0;this.rudder_list=[];for(let b of a.rudders)this.rudder_list.push({name:b.name,stats:new Stats(b)});this.elevator_sel=0;this.elevator_list=[];for(let b of a.elevators)this.elevator_list.push({name:b.name,
stats:new Stats(b)});this.flaps_sel=0;this.flaps_list=[];for(let b of a.flaps)this.flaps_list.push({name:b.name,costfactor:b.costfactor,stats:new Stats(b)});this.slats_sel=0;this.slats_list=[];for(let b of a.slats)this.slats_list.push({name:b.name,stats:new Stats(b)});this.drag_list=[];for(let b of a.drag_inducers)this.drag_list.push({name:b.name,stats:new Stats(b)});this.drag_sel=[...Array(this.drag_list.length).fill(!1)]}toJSON(){return{aileron_sel:this.aileron_sel,rudder_sel:this.rudder_sel,elevator_sel:this.elevator_sel,
flaps_sel:this.flaps_sel,slats_sel:this.slats_sel,drag_sel:this.drag_sel}}fromJSON(a,b){this.aileron_sel=a.aileron_sel;this.rudder_sel=a.rudder_sel;this.elevator_sel=a.elevator_sel;this.flaps_sel=a.flaps_sel;this.slats_sel=a.slats_sel;this.drag_sel=BoolArr(a.drag_sel,this.drag_sel.length)}serialize(a){a.PushNum(this.aileron_sel);a.PushNum(this.rudder_sel);a.PushNum(this.elevator_sel);a.PushNum(this.flaps_sel);a.PushNum(this.slats_sel);a.PushBoolArr(this.drag_sel)}deserialize(a){this.aileron_sel=a.GetNum();
this.rudder_sel=a.GetNum();this.elevator_sel=a.GetNum();this.flaps_sel=a.GetNum();this.slats_sel=a.GetNum();this.drag_sel=a.GetBoolArr(this.drag_sel.length)}GetAileronList(){return this.aileron_list}CanAileron(){var a=[];if(IsAnyOrnithopter(this.acft_type))for(let b of this.aileron_list)a.push(b.warping);else for(let b of this.aileron_list)b.warping&&0==this.wing_area?a.push(!1):a.push(!0);return a}GetAileron(){return this.aileron_sel}SetAileron(a){this.aileron_sel=a;this.CalculateStats()}GetRudderList(){return this.rudder_list}CanRudder(){return this.can_rudder}SetCanRudder(a){this.can_rudder=
a;a||(this.rudder_sel=0)}GetRudder(){return this.rudder_sel}SetRudder(a){this.rudder_sel=a;this.CalculateStats()}GetElevatorList(){return this.elevator_list}CanElevator(){return this.can_elevator}SetCanElevator(a){this.can_elevator=a;a||(this.elevator_sel=0)}GetElevator(){return this.elevator_sel}SetElevator(a){this.elevator_sel=a;this.CalculateStats()}GetFlapsList(){return this.flaps_list}GetFlaps(){return this.flaps_sel}SetFlaps(a){this.flaps_sel=a;this.CalculateStats()}GetFlapCost(a){a&&(this.mp=
a);return 0<this.flaps_list[this.flaps_sel].costfactor?Math.max(1,Math.floor(1E-6+this.flaps_list[this.flaps_sel].costfactor*this.mp)):0}GetSlatsList(){return this.slats_list}GetSlats(){return this.slats_sel}SetSlats(a){this.slats_sel=a;this.CalculateStats()}GetDragList(){return this.drag_list}GetDrag(){return this.drag_sel}SetDrag(a,b){this.drag_sel[a]=b;this.CalculateStats()}SetNumCantilever(a){this.is_cantilever=a}SetSpan(a){this.span=a}SetWingArea(a){this.wing_area=a}SetAcftType(a){this.acft_type=
a;if(this.acft_type==AIRCRAFT_TYPE.HELICOPTER){this.slats_sel=this.flaps_sel=this.elevator_sel=this.rudder_sel=this.aileron_sel=0;for(a=0;a<this.drag_sel.length;a++)this.drag_sel[a]=!1;this.wing_area=this.is_cantilever=this.span=0}else IsAnyOrnithopter(this.acft_type)&&(this.aileron_sel=this.CanAileron().findIndex(b=>b),this.is_cantilever=0)}SetBoomTail(a){this.is_boom=a}SetIsVTail(a){a&&(this.rudder_sel=this.elevator_sel)}SetCalculateStats(a){this.CalculateStats=a}PartStats(){var a=new Stats;this.aileron_list[this.aileron_sel].warping&&
0==this.wing_area&&(this.aileron_sel=0);a=a.Add(this.aileron_list[this.aileron_sel].stats);this.aileron_list[this.aileron_sel].warping&&(a.maxstrain-=this.span,this.is_cantilever&&(a.cost+=2*this.is_cantilever,a.era.push({name:lu("Cantilever Wing Warping"),era:"Last Hurrah"})),this.is_boom&&(a.pitchstab-=2,a.latstab-=2,a.warnings.push({source:lu("Wing Warping"),warning:lu("Wing Warping Warning"),color:WARNING_COLOR.WHITE})));a=a.Add(this.rudder_list[this.rudder_sel].stats);a=a.Add(this.elevator_list[this.elevator_sel].stats);
a=a.Add(this.flaps_list[this.flaps_sel].stats);a=a.Add(this.slats_list[this.slats_sel].stats);for(let b=0;b<this.drag_list.length;b++)this.drag_sel[b]&&(a=a.Add(this.drag_list[b].stats));return a}GetElectrics(){return{storage:0,equipment:[]}}}
class Reinforcement extends Part{constructor(a){super();this.ext_wood_list=[];for(let b of a.external_wood)this.ext_wood_list.push({name:b.name,tension:b.tension,config:b.config,first:b.first,small_sqp:b.small_sqp,ornith:b.ornith,stats:new Stats(b)});this.ext_wood_count=[...Array(this.ext_wood_list.length).fill(0)];this.ext_steel_list=[];for(let b of a.external_steel)this.ext_steel_list.push({name:b.name,tension:b.tension,config:b.config,first:b.first,small_sqp:b.small_sqp,ornith:b.ornith,stats:new Stats(b)});
this.ext_steel_count=[...Array(this.ext_steel_list.length).fill(0)];this.ext_cabane_list=[];for(let b of a.cabane)this.ext_cabane_list.push({name:b.name,tension:b.tension,stats:new Stats(b)});this.cabane_sel=0;this.cant_list=[];for(let b of a.cantilever)this.cant_list.push({name:b.name,limited:b.limited,stats:new Stats(b)});this.cant_count=[...Array(this.cant_list.length).fill(0)];this.is_monoplane=this.is_tandem=this.is_staggered=this.wing_blades=this.wires=!1;this.can_external=!0;this.cant_lift=
this.acft_structure=0;this.acft_type=AIRCRAFT_TYPE.AIRPLANE}toJSON(){return{ext_wood_count:this.ext_wood_count,ext_steel_count:this.ext_steel_count,cant_count:this.cant_count,wires:this.wires,cabane_sel:this.cabane_sel,wing_blades:this.wing_blades}}fromJSON(a,b){this.ext_wood_count=NumArr(a.ext_wood_count,this.ext_wood_count.length);this.ext_steel_count=NumArr(a.ext_steel_count,this.ext_steel_count.length);this.cant_count=NumArr(a.cant_count,this.cant_count.length);this.wires=a.wires;this.cabane_sel=
a.cabane_sel;this.wing_blades=10.25<b?a.wing_blades:!1;10.45>b&&(this.cant_count[0]*=2,this.cant_count[1]*=2,this.cant_count[2]*=3,this.cant_count[3]*=2)}serialize(a){a.PushNumArr(this.ext_wood_count);a.PushNumArr(this.ext_steel_count);a.PushNumArr(this.cant_count);a.PushBool(this.wires);a.PushNum(this.cabane_sel);a.PushBool(this.wing_blades)}deserialize(a){this.ext_wood_count=a.GetNumArr(this.ext_wood_count.length);this.ext_steel_count=a.GetNumArr(this.ext_steel_count.length);this.cant_count=a.GetNumArr(this.cant_count.length);
this.wires=a.GetBool();this.cabane_sel=a.GetNum();this.wing_blades=10.25<a.version?a.GetBool():!1;10.45>a.version&&(this.cant_count[0]*=2,this.cant_count[1]*=2,this.cant_count[2]*=3,this.cant_count[3]*=2)}GetExternalList(){return this.ext_wood_list}GetCantileverList(){return this.cant_list}CanExternalWood(){var a=[...Array(this.ext_wood_list.length).fill(this.can_external)];for(let b=0;b<this.ext_wood_list.length;b++)this.acft_type==AIRCRAFT_TYPE.ORNITHOPTER_FLUTTER?a[b]=this.ext_wood_list[b].ornith:
this.limited_sqp&&(a[b]=this.ext_wood_list[b].small_sqp),this.wires||"Wing Truss"!=this.ext_wood_list[b].name&&"Wire Root"!=this.ext_wood_list[b].name||(a[b]=!1);return a}GetExternalWoodCount(){return this.ext_wood_count}SetExternalWoodCount(a,b){if(b!=b||0>b)b=0;b=Math.floor(1E-6+b);this.ext_wood_count[a]=b;this.CalculateStats()}CanExternalSteel(){var a=[...Array(this.ext_steel_list.length).fill(this.can_external)];for(let b=0;b<this.ext_steel_list.length;b++)this.acft_type==AIRCRAFT_TYPE.ORNITHOPTER_FLUTTER?
a[b]=this.ext_steel_list[b].ornith:this.limited_sqp&&(a[b]=this.ext_steel_list[b].small_sqp),this.wires||"Steel Wing Truss"!=this.ext_steel_list[b].name&&"Steel Wire Root"!=this.ext_steel_list[b].name||(a[b]=!1);return a}GetExternalSteelCount(){return this.ext_steel_count}SetExternalSteelCount(a,b){if(b!=b||0>b)b=0;b=Math.floor(1E-6+b);this.ext_steel_count[a]=b;this.CalculateStats()}GetCantileverCount(){return this.cant_count}GetTotalCantilevers(){var a=0;for(let b=0;b<this.cant_count.length;b++)a+=
this.cant_count[b];return a}GetIsCantilever(){var a=0;for(let b of this.cant_count)a+=b;return 0<a}SetCantileverCount(a,b){if(b!=b||0>b)b=0;b=Math.floor(1E-6+b);this.ImplSCC(a,b);this.CalculateStats()}ImplSCC(a,b){var c=b-this.cant_count[a];if(this.cant_list[a].limited&&0<b){b=this.TotalStructure();for(let d=0;d<this.cant_list.length;d++)this.cant_list[d].limited&&(b-=5*this.cant_count[d]*this.cant_list[d].stats.mass);c=Math.min(c,Math.floor(1E-6+b/(5*this.cant_list[a].stats.mass)))}this.cant_count[a]+=
c;return 0!=c}GetWires(){return this.wires}SetWires(a){this.wires=a;this.CalculateStats()}SetStaggered(a){this.is_staggered=a}SetTandem(a){this.is_tandem=a}SetMonoplane(a){this.is_monoplane=a}SetCanUseExternal(a){this.can_external=a}SetAcftStructure(a){var b=this.acft_structure;this.acft_structure=a;a=!1;if(b>this.acft_structure)for(b=this.cant_list.length-1;0<=b;b--)a=a||this.ImplSCC(b,this.cant_count[b]);a&&this.CalculateStats()}TotalStructure(){var a=this.ext_cabane_list[this.cabane_sel].stats.structure,
b=!1;for(let c=0;c<this.ext_wood_list.length;c++)if(a+=this.ext_wood_count[c]*this.ext_wood_list[c].stats.structure,a+=this.ext_steel_count[c]*this.ext_steel_list[c].stats.structure,0<this.ext_wood_count[c]||0<this.ext_steel_count[c])b=!0;b&&(a+=5);return this.acft_structure+a}GetCantileverType(){var a=this.cant_count[0]+this.cant_count[4];return 0<this.cant_count[1]+this.cant_count[2]+this.cant_count[3]?2:0<a?1:0}GetCabaneList(){return this.ext_cabane_list}GetCabane(){return this.cabane_sel}SetCabane(a){this.cabane_sel=
a;this.CalculateStats()}SetCantLift(a){this.cant_lift=a}CanWingBlade(){for(let a of this.ext_wood_count)if(0<a)return!1;for(let a of this.ext_steel_count)if(0<a)return!1;return 0==this.cabane_sel&&0<this.cant_count[2]}GetWingBlade(){return this.wing_blades}SetWingBlade(a){this.wing_blades=a;this.CalculateStats()}SetAircraftType(a){this.acft_type=a;a==AIRCRAFT_TYPE.HELICOPTER&&(this.is_staggered=this.is_tandem=this.is_monoplane=this.can_external=!1);a==AIRCRAFT_TYPE.ORNITHOPTER_BUZZER&&(this.can_external=
!1);a=this.CanExternalWood();for(var b=0;b<this.ext_wood_count.length;b++)a[b]||(this.ext_wood_count[b]=0);a=this.CanExternalSteel();for(b=0;b<this.ext_steel_count.length;b++)a[b]||(this.ext_steel_count[b]=0)}SetSesquiplane(a){this.tension_sqp=a.is&&a.super_small;if(this.limited_sqp=a.is&&!a.super_small){for(a=0;a<this.ext_wood_list.length;a++)this.ext_wood_list[a].small_sqp||(this.ext_wood_count[a]=0);for(a=0;a<this.ext_steel_list.length;a++)this.ext_steel_list[a].small_sqp||(this.ext_steel_count[a]=
0)}}SetCalculateStats(a){this.CalculateStats=a}PartStats(){var a=new Stats;switch(this.acft_type){case AIRCRAFT_TYPE.HELICOPTER:case AIRCRAFT_TYPE.ORNITHOPTER_BUZZER:case AIRCRAFT_TYPE.ORNITHOPTER_FLUTTER:this.cabane_sel=0}var b=1;this.is_monoplane?b=.6:this.is_tandem?b=.8:this.is_staggered&&(b=.9);this.tension_sqp&&(b-=.15);this.acft_type==AIRCRAFT_TYPE.ORNITHOPTER_BASIC&&(b=.5);if(!this.can_external){for(var c=0;c<this.ext_wood_count.length;c++)this.ext_wood_count[c]=0;for(c=0;c<this.ext_steel_count.length;c++)this.ext_steel_count[c]=
0;this.cabane_sel=0;this.wires=!1}var d=c=0,e=!1;for(var f=0;f<this.ext_wood_list.length;f++)if(d+=this.ext_wood_count[f],0<this.ext_wood_count[f]){e=e||this.ext_wood_list[f].first;var h=this.ext_wood_list[f].stats;h=h.Multiply(this.ext_wood_count[f]);a=a.Add(h);c=this.ext_wood_list[f].config?c+b*this.ext_wood_list[f].tension*this.ext_wood_count[f]:c+this.ext_wood_list[f].tension*this.ext_wood_count[f]}for(f=0;f<this.ext_steel_list.length;f++)d+=this.ext_steel_count[f],0<this.ext_steel_count[f]&&
(e=e||this.ext_wood_list[f].first,h=this.ext_steel_list[f].stats.Clone(),h=h.Multiply(this.ext_steel_count[f]),a=a.Add(h),c=this.ext_steel_list[f].config?c+b*this.ext_steel_list[f].tension*this.ext_steel_count[f]:c+this.ext_steel_list[f].tension*this.ext_steel_count[f]);this.acft_type==AIRCRAFT_TYPE.ORNITHOPTER_BASIC&&(a.maxstrain=Math.floor(1E-6+.5*a.maxstrain));e&&(a.structure+=5,a.maxstrain+=10,c+=10);e=this.ext_cabane_list[this.cabane_sel].stats.Clone();a=a.Add(e);c+=b*this.ext_cabane_list[this.cabane_sel].tension;
0<this.cabane_sel&&(d+=1);this.wires&&(a.maxstrain+=Math.floor(1E-6+c),a.drag+=3*d);b=!1;for(c=0;c<this.cant_list.length;c++)0<this.cant_count[c]&&(b=!0,d=this.cant_list[c].stats,d=d.Multiply(this.cant_count[c]),a=a.Add(d));this.CanWingBlade()?this.wing_blades&&(a.mass*=2,a.warnings.push({source:lu("Wing Blades"),warning:lu("Wing Blades Warning"),color:WARNING_COLOR.WHITE})):this.wing_blades=!1;b&&(a.cost+=5,a.liftbleed-=this.cant_lift);return a}GetElectrics(){return{storage:0,equipment:[]}}}
class Fuel extends Part{constructor(a){super();this.tank_stats=[];this.tank_count=[];for(let b of a.tanks)this.tank_stats.push({name:b.name,stats:new Stats(b),internal:b.internal,cantilever:b.cantilever}),this.tank_count.push(0);this.is_cantilever=this.self_sealing=!1;this.wing_area=-1}toJSON(){return{tank_count:this.tank_count,self_sealing:this.self_sealing,fire_extinguisher:this.fire_extinguisher}}fromJSON(a,b){this.tank_count=NumArr(a.tank_count,this.tank_count.length);this.self_sealing=a.self_sealing;
this.fire_extinguisher=a.fire_extinguisher;this.wing_area=-1}serialize(a){a.PushNumArr(this.tank_count);a.PushBool(this.self_sealing);a.PushBool(this.fire_extinguisher)}deserialize(a){this.tank_count=a.GetNumArr(this.tank_count.length);this.self_sealing=a.GetBool();this.fire_extinguisher=a.GetBool();this.wing_area=-1}GetTankList(){return this.tank_stats}GetTankEnabled(){var a=[];for(let b of this.tank_stats)!this.is_cantilever&&b.cantilever?a.push(!1):a.push(!0);return a}GetTankCount(){return this.tank_count}SetTankCount(a,
b){if(b!=b||0>b)b=0;b=Math.floor(1E-6+b);this.tank_count[a]=b;this.VerifyOK();this.CalculateStats()}SetCantilever(a){this.is_cantilever&&!a&&(this.is_cantilever=a,this.VerifyOK()&&this.CalculateStats());this.is_cantilever=a}SetArea(a){this.wing_area>a&&(this.wing_area=a,this.VerifyOK()&&this.CalculateStats());this.wing_area=a}VerifyOK(){if(-1!=this.wing_area){var a=0;for(var b=0;b<this.tank_count.length;b++)this.tank_stats[b].cantilever&&(a+=this.tank_count[b]);b=Math.floor(1E-6+this.wing_area/10);
this.is_cantilever||(b=0);b=a-b;for(a=0<b;0<b;)for(let c=this.tank_count.length-1;0<=c;c--)if(this.tank_stats[c].cantilever){this.tank_count[c]--;b--;break}for(b=0;b<this.tank_count.length;b++)0==this.tank_stats[b].stats.wetmass&&(this.tank_count[b]=Math.min(4,this.tank_count[b]));return a}return!1}GetSealingEnabled(){var a=0;for(let b=0;b<this.tank_count.length;b++)this.tank_stats[b].internal&&(a+=this.tank_count[b]);return 0<a}GetSelfSealing(){return this.self_sealing}SetSelfSealing(a){this.self_sealing=
a;this.CalculateStats()}GetExtinguisher(){return this.fire_extinguisher}SetExtinguisher(a){this.fire_extinguisher=a;this.CalculateStats()}SetCalculateStats(a){this.CalculateStats=a}PartStats(){var a=new Stats,b=0;for(let c=0;c<this.tank_count.length;c++){let d=this.tank_stats[c].stats.Clone();d=d.Multiply(this.tank_count[c]);a=a.Add(d);this.tank_stats[c].internal&&(b+=this.tank_count[c])}a.reqsections=Math.ceil(-1E-6+a.reqsections);this.self_sealing&&(a.mass+=b,a.cost+=2*b,a.era.push({name:"Self-Sealing Gas Tank",
era:"Roaring 20s"}),a.warnings.push({source:lu("Self-Sealing Gas Tank"),warning:lu("Self-Sealing Gas Tank Warning"),color:WARNING_COLOR.WHITE}));this.fire_extinguisher&&(a.mass+=2,a.cost+=3,a.era.push({name:"Remote Fire Extinguisher",era:"WWII"}),a.warnings.push({source:lu("Remote Fire Extinguisher"),warning:lu("Remote Fire Extinguisher Warning"),color:WARNING_COLOR.WHITE}));0<a.wetmass%5&&(a.wetmass+=5-a.wetmass%5);return a}GetElectrics(){return{storage:0,equipment:[]}}}
class Munitions extends Part{constructor(){super();this.internal_bay_count=this.rocket_count=this.bomb_count=0;this.internal_bay_2=this.internal_bay_1=!1}toJSON(){return{bomb_count:this.bomb_count,rocket_count:this.rocket_count,bay_count:this.internal_bay_count,bay1:this.internal_bay_1,bay2:this.internal_bay_2}}fromJSON(a,b){this.bomb_count=a.bomb_count;this.internal_bay_count=a.bay_count;this.internal_bay_1=a.bay1;this.internal_bay_2=a.bay2;10.75<b&&(this.rocket_count=a.rocket_count)}serialize(a){a.PushNum(this.bomb_count);
a.PushNum(this.internal_bay_count);a.PushBool(this.internal_bay_1);a.PushBool(this.internal_bay_2);a.PushNum(this.rocket_count)}deserialize(a){this.bomb_count=a.GetNum();this.internal_bay_count=a.GetNum();this.internal_bay_1=a.GetBool();this.internal_bay_2=a.GetBool();10.75<a.version&&(this.rocket_count=a.GetNum())}GetRocketCount(){return this.rocket_count}GetBombCount(){return this.bomb_count}GetInternalBombCount(){var a=10*this.internal_bay_count;0<this.bomb_count&&0<this.internal_bay_count&&this.internal_bay_1&&
(a*=2,this.internal_bay_2&&(a*=2));return a}GetMaxBombSize(){var a=0,b=this.GetInternalBombCount();0<this.bomb_count&&0<this.internal_bay_count&&(a=this.internal_bay_1?this.internal_bay_2?Math.floor(1E-6+b):Math.floor(1E-6+b/2):Math.floor(1E-6+b/4));return a}SetRocketCount(a){if(a!=a||0>a)a=0;this.rocket_count=a=Math.floor(1E-6+a);this.LimitMass();this.CalculateStats()}SetBombCount(a){if(a!=a||0>a)a=0;this.bomb_count=a=Math.floor(1E-6+a);this.LimitMass();this.CalculateStats()}GetBayCount(){return this.internal_bay_count}GetBay1(){return this.internal_bay_1}GetBay2(){return this.internal_bay_2}SetBayCount(a){if(a!=
a||0>a)a=0;this.internal_bay_count=a=Math.floor(1E-6+a);this.CalculateStats()}SetUseBays(a,b){this.internal_bay_1=a;this.internal_bay_2=b;!this.internal_bay_1&&this.internal_bay_2&&(this.internal_bay_1=!0,this.internal_bay_2=!1);this.CalculateStats()}LimitMass(){var a=!1,b=Math.min(this.GetInternalBombCount(),Math.floor(1E-6+3*this.acft_struct*this.maxbomb));var c=this.bomb_count>b?b:this.bomb_count;b=this.rocket_count+c>b?b-c:this.rocket_count;var d=this.bomb_count-c;var e=this.rocket_count-b;for(var f=
Math.floor(1E-6+this.acft_struct*this.maxbomb-(c+b)/3)*this.gull_factor;d+e>f;)0<e?e--:d--;this.bomb_count>c+d&&(a=!0,this.bomb_count=c+d);this.rocket_count>b+e&&(a=!0,this.rocket_count=b+e);return a}GetExternalMass(){return Math.max(0,this.bomb_count+this.rocket_count-this.GetInternalBombCount())}SetAcftParameters(a,b,c){this.acft_struct=a;this.maxbomb=b;switch(c){case 2:case 3:this.gull_factor=1.1;break;case 4:this.gull_factor=1.2;break;default:this.gull_factor=1}this.LimitMass()&&this.CalculateStats()}SetCalculateStats(a){this.CalculateStats=
a}PartStats(){var a=new Stats,b=this.GetExternalMass();a.reqsections+=this.internal_bay_count;if(0<this.internal_bay_count){var c=a.reqsections;this.internal_bay_1&&(a.reqsections+=c,this.internal_bay_2&&(a.reqsections+=c))}b=Math.ceil(-1E-6+b/5);a.mass+=b;a.drag+=b;a.bomb_mass=this.bomb_count+this.rocket_count;a.reqsections=Math.ceil(-1E-6+a.reqsections);0<a.bomb_mass%5&&(a.bomb_mass+=5-a.bomb_mass%5);return a}GetElectrics(){return{storage:0,equipment:[]}}}
class CargoAndPassengers extends Part{constructor(a){super();this.cargo_list=[];for(let b of a.spaces)this.cargo_list.push({name:b.name,stats:new Stats(b)});this.cargo_sel=0}toJSON(){return{space_sel:this.cargo_sel}}fromJSON(a,b){this.cargo_sel=a.space_sel}serialize(a){a.PushNum(this.cargo_sel)}deserialize(a){this.cargo_sel=a.GetNum()}GetSpaceList(){return this.cargo_list}GetSpace(){return this.cargo_sel}SetSpace(a){this.cargo_sel=a;this.CalculateStats()}SetCalculateStats(a){this.CalculateStats=a}PartStats(){var a=
new Stats;a=a.Add(this.cargo_list[this.cargo_sel].stats);a.bomb_mass+=3*a.reqsections;0<a.bomb_mass%5&&(a.bomb_mass+=5-a.bomb_mass%5);return a}GetElectrics(){return{storage:0,equipment:[]}}}
class LandingGear extends Part{constructor(a){super();this.gear_list=[];this.gear_sel=0;this.retract=!1;for(let b of a.gear)this.gear_list.push({name:b.name,stats:new Stats(b),DpLMP:b.DpLMP,SpLMP:b.SpLMP,can_retract:b.can_retract});this.extra_list=[];for(let b of a.extras)this.extra_list.push({name:b.name,stats:new Stats(b),MpLMP:b.MpLMP});this.extra_sel=[...Array(this.extra_list.length).fill(!1)]}toJSON(){return{gear_sel:this.gear_sel,retract:this.retract,extra_sel:this.extra_sel}}fromJSON(a,b){this.gear_sel=
a.gear_sel;this.retract=a.retract;this.extra_sel=BoolArr(a.extra_sel,this.extra_sel.length)}serialize(a){a.PushNum(this.gear_sel);a.PushBool(this.retract);a.PushBoolArr(this.extra_sel)}deserialize(a){this.gear_sel=a.GetNum();this.retract=a.GetBool();this.extra_sel=a.GetBoolArr(this.extra_sel.length)}GetGearName(){return this.retract&&"Boat Hull"==this.gear_list[this.gear_sel].name?lu("Retractable Gear + Boat Hull"):this.retract?lu("Retractable ")+lu(this.gear_list[this.gear_sel].name):lu(this.gear_list[this.gear_sel].name)}GetGearList(){return this.gear_list}CanGear(){var a=
[...Array(this.gear_list.length).fill(!0)];for(let b=0;b<this.gear_list.length;b++)"Boat Hull"!=this.gear_list[b].name||this.can_boat||(a[b]=!1);return a}GetGear(){return this.gear_sel}SetGear(a){this.CanGear()[a]&&(this.gear_sel=a);this.CalculateStats()}CanRetract(){return this.gear_list[this.gear_sel].can_retract||"Boat Hull"==this.gear_list[this.gear_sel].name}GetRetract(){return this.retract}SetRetract(a){this.retract=a&&this.CanRetract();this.CalculateStats()}GetExtraList(){return this.extra_list}GetExtraSelected(){return this.extra_sel}SetExtraSelected(a,
b){this.extra_sel[a]=b;this.CalculateStats()}SetLoadedMass(a){this.loadedMass=a}CanBoat(a,b){this.can_boat=2==a?!0:1==a&&3<=b?!0:0==a&&4<=b?!0:!1}SetGull(a){this.gull_deck=a}SetCalculateStats(a){this.CalculateStats=a}IsVital(){return!0}PartStats(){var a=new Stats;this.CanGear()[this.gear_sel]||(this.gear_sel=0);var b=this.loadedMass;for(var c=0;c<this.extra_list.length;c++)this.extra_sel[c]&&(a=a.Add(this.extra_list[c].stats),b+=this.extra_list[c].stats.mass,a.mass+=Math.floor(1E-6+this.extra_list[c].MpLMP*
Math.floor(1E-6+b/5)));a=a.Add(this.gear_list[this.gear_sel].stats);c=this.gear_list[this.gear_sel].DpLMP*Math.floor(1E-6+b/5);"Boat Hull"==this.gear_list[this.gear_sel].name&&this.retract&&(a.drag+=c,c=this.gear_list[0].DpLMP*Math.floor(1E-6+b/5));if("Boat Hull"!=this.gear_list[this.gear_sel].name||this.retract)switch(this.gull_deck){case 1:c-=Math.floor(1E-6+.1*c);break;case 2:case 3:c-=Math.floor(1E-6+.15*c);break;case 4:c-=Math.floor(1E-6+.25*c)}this.retract?(a.mass+=Math.floor(1E-6+c/2),a.cost+=
Math.floor(1E-6+c/2)):a.drag+=c;a.structure+=this.gear_list[this.gear_sel].SpLMP*Math.floor(1E-6+b/5);a.Round();return a}GetElectrics(){return{storage:0,equipment:[]}}}
class Optimization extends Part{constructor(){super();this.drag=this.reliability=this.maxstrain=this.toughness=this.mass=this.escape=this.bleed=this.cost=this.free_dots=0;this.acft_stats=new Stats}toJSON(){return{free_dots:this.free_dots,cost:this.cost,bleed:this.bleed,escape:this.escape,mass:this.mass,toughness:this.toughness,maxstrain:this.maxstrain,reliability:this.reliability,drag:this.drag}}fromJSON(a,b){this.free_dots=a.free_dots;this.cost=a.cost;this.bleed=a.bleed;this.escape=a.escape;this.mass=
a.mass;this.toughness=a.toughness;this.maxstrain=a.maxstrain;this.reliability=a.reliability;this.drag=a.drag}serialize(a){a.PushNum(this.free_dots);a.PushNum(this.cost);a.PushNum(this.bleed);a.PushNum(this.escape);a.PushNum(this.mass);a.PushNum(this.toughness);a.PushNum(this.maxstrain);a.PushNum(this.reliability);a.PushNum(this.drag)}deserialize(a){this.free_dots=a.GetNum();this.cost=a.GetNum();this.bleed=a.GetNum();this.escape=a.GetNum();this.mass=a.GetNum();this.toughness=a.GetNum();this.maxstrain=
a.GetNum();this.reliability=a.GetNum();this.drag=a.GetNum()}GetUnassignedCount(){return this.free_dots-this.cost-this.bleed-this.escape-this.mass-this.toughness-this.maxstrain-this.reliability-this.drag}ReduceDots(){var a=-this.GetUnassignedCount();if(0<a){let b=Math.min(a,this.drag);b=Math.max(b,0);this.drag-=b;a-=b;b=Math.min(a,this.reliability);b=Math.max(b,0);this.reliability-=b;a-=b;b=Math.min(a,this.maxstrain);b=Math.max(b,0);this.maxstrain-=b;a-=b;b=Math.min(a,this.toughness);b=Math.max(b,
0);this.toughness-=b;a-=b;b=Math.min(a,this.mass);b=Math.max(b,0);this.mass-=b;a-=b;b=Math.min(a,this.escape);b=Math.max(b,0);this.escape-=b;a-=b;b=Math.min(a,this.bleed);b=Math.max(b,0);this.bleed-=b;a-=b;b=Math.min(a,this.cost);b=Math.max(b,0);this.cost-=b}}GetFreeDots(){return this.free_dots}SetFreeDots(a){if(a!=a||0>a)a=0;a=Math.floor(1E-6+a);this.free_dots=a=Math.max(a,0);this.ReduceDots();this.CalculateStats()}GetCost(){return this.cost}SetCost(a){a!=a&&(a=0);a=Math.floor(1E-6+a);a=Math.max(a,
-3);this.cost=a=Math.min(a,3);this.ReduceDots();this.CalculateStats()}GetBleed(){return this.bleed}SetBleed(a){a!=a&&(a=0);a=Math.floor(1E-6+a);a=Math.max(a,-3);this.bleed=a=Math.min(a,3);this.ReduceDots();this.CalculateStats()}GetEscape(){return this.escape}SetEscape(a){a!=a&&(a=0);a=Math.floor(1E-6+a);a=Math.max(a,-3);this.escape=a=Math.min(a,3);this.ReduceDots();this.CalculateStats()}GetMass(){return this.mass}SetMass(a){a!=a&&(a=0);a=Math.floor(1E-6+a);a=Math.max(a,-3);this.mass=a=Math.min(a,
3);this.ReduceDots();this.CalculateStats()}GetToughness(){return this.toughness}SetToughness(a){a!=a&&(a=0);a=Math.floor(1E-6+a);a=Math.max(a,-3);this.toughness=a=Math.min(a,3);this.ReduceDots();this.CalculateStats()}GetMaxStrain(){return this.maxstrain}SetMaxStrain(a){a!=a&&(a=0);a=Math.floor(1E-6+a);a=Math.max(a,-3);this.maxstrain=a=Math.min(a,3);this.ReduceDots();this.CalculateStats()}GetReliabiilty(){return this.reliability}SetReliability(a){a!=a&&(a=0);a=Math.floor(1E-6+a);a=Math.max(a,-3);this.reliability=
a=Math.min(a,3);this.ReduceDots();this.CalculateStats()}GetDrag(){return this.drag}SetDrag(a){a!=a&&(a=0);a=Math.floor(1E-6+a);a=Math.max(a,-3);this.drag=a=Math.min(a,3);this.ReduceDots();this.CalculateStats()}SetAcftStats(a){this.acft_stats=a}SetCalculateStats(a){this.CalculateStats=a}PartStats(){var a=new Stats;a.cost=Math.floor(1E-6+-(this.cost*this.acft_stats.cost/10));a.liftbleed=Math.floor(1E-6+3*-this.bleed);a.escape=this.escape;a.visibility=this.escape;a.mass=Math.floor(1E-6+-(this.mass*this.acft_stats.mass/
10));a.toughness=Math.floor(1E-6+this.toughness*this.acft_stats.toughness/4);a.reliability=2*this.reliability;a.drag=Math.floor(1E-6+-(this.drag*this.acft_stats.drag/10));return a}GetElectrics(){return{storage:0,equipment:[]}}}var SynchronizationType;(function(a){a[a.NONE=-1]="NONE";a[a.INTERRUPT=0]="INTERRUPT";a[a.SYNCH=1]="SYNCH";a[a.SPINNER=2]="SPINNER";a[a.DEFLECT=3]="DEFLECT";a[a.NO_INTERFERENCE=4]="NO_INTERFERENCE";a[a.ENUM_MAX=5]="ENUM_MAX"})(SynchronizationType||={});var ProjectileType;
(function(a){a[a.BULLETS=0]="BULLETS";a[a.HEATRAY=1]="HEATRAY";a[a.PNEUMATIC=2]="PNEUMATIC";a[a.ENUM_MAX=3]="ENUM_MAX";a[a.GYROJETS=4]="GYROJETS"})(ProjectileType||={});var ActionType;(function(a){a[a.STANDARD=0]="STANDARD";a[a.MECHANICAL=1]="MECHANICAL";a[a.GAST=2]="GAST";a[a.ROTARY=3]="ROTARY";a[a.ENUM_MAX=4]="ENUM_MAX"})(ActionType||={});
class Weapon extends Part{constructor(a,b,c,d=!1){super();this.weapon_type=a;this.fixed=d;this.wing=!0;this.free_accessible=this.accessible=this.covered=!1;this.synchronization=d?SynchronizationType.NONE:SynchronizationType.INTERRUPT;this.w_count=1;this.wing_reinforcement=this.repeating=!1}toJSON(){return{fixed:this.fixed,wing:this.wing,covered:this.covered,accessible:this.accessible,free_accessible:this.free_accessible,synchronization:this.synchronization,w_count:this.w_count}}fromJSON(a,b){this.fixed=
a.fixed;this.wing=a.wing;this.covered=a.covered;this.accessible=a.accessible;this.free_accessible=a.free_accessible;this.synchronization=a.synchronization;this.w_count=a.w_count;10.95>b&&(this.repeating=a.repeating)}serialize(a){a.PushBool(this.fixed);a.PushBool(this.wing);a.PushBool(this.covered);a.PushBool(this.accessible);a.PushBool(this.free_accessible);a.PushNum(this.synchronization);a.PushNum(this.w_count)}deserialize(a){this.fixed=a.GetBool();this.wing=a.GetBool();this.covered=a.GetBool();
this.accessible=a.GetBool();this.free_accessible=a.GetBool();this.synchronization=a.GetNum();this.w_count=a.GetNum();10.95>a.version&&(this.repeating=a.GetBool())}SetWeaponType(a,b,c){this.weapon_type=a;this.action=b;16==this.weapon_type.size&&(this.w_count=1);this.SetCount(this.w_count)}GetFixed(){return this.fixed}SetFixed(a){a!=this.fixed&&(a?this.fixed=!0:(this.fixed=!1,this.synchronization=SynchronizationType.NONE),this.CalculateStats())}SetCanWing(a){this.canwing=a;this.wing&&!a&&(this.wing=
!1)}GetWing(){return this.wing}CanWing(){return 16>=this.weapon_type.size&&this.canwing}SetWing(a){a&&this.CanWing()?(this.wing=!0,this.free_accessible=!1,this.synchronization=SynchronizationType.NONE):this.wing=!1;this.CalculateStats()}CanCovered(){return this.wing?this.has_cantilever&&!(16==this.weapon_type.size&&!this.fixed):!(this.GetArty()&&!this.fixed)}GetCovered(){return this.covered}SetCovered(a){this.covered=a;this.CalculateStats()}GetAccessible(){return this.accessible||this.free_accessible}SetAccessible(a){a&&
this.free_accessible&&(a=!1);this.accessible=a;this.CalculateStats()}GetFreeAccessible(){return this.free_accessible}SetFreeAccessible(a){a&&!this.wing&&this.can_free_accessible?(this.free_accessible=!0,this.accessible=!1):this.free_accessible=!1;this.CalculateStats()}CanSynchronization(){var a=[];for(let b=-1;b<SynchronizationType.ENUM_MAX;b++)a.push(this.CanSynch(b));return a}CanSynch(a){return this.fixed||this.wing?this.can_synchronize&&a==SynchronizationType.NONE||!this.can_synchronize&&a!=SynchronizationType.NONE||
"Fliergerflammenwerfer"==this.weapon_type.name&&a!=SynchronizationType.NONE&&a!=SynchronizationType.SPINNER&&a!=SynchronizationType.NO_INTERFERENCE||this.action==ActionType.MECHANICAL&&!(a==SynchronizationType.NONE||a==SynchronizationType.SYNCH||a==SynchronizationType.SPINNER&&this.CanSpinner())||this.action==ActionType.GAST&&a==SynchronizationType.SPINNER||!(a!=SynchronizationType.INTERRUPT&&a!=SynchronizationType.SYNCH||this.weapon_type.synched)||a==SynchronizationType.SPINNER&&!this.CanSpinner()||
a==SynchronizationType.DEFLECT&&this.GetArty()?!1:!0:this.can_synchronize?a==SynchronizationType.NONE||a==SynchronizationType.DEFLECT||a==SynchronizationType.NO_INTERFERENCE?!0:!1:a==SynchronizationType.NONE?!0:!1}GetSynchronization(){return this.synchronization}SetSynchronization(a){this.CanSynch(a)?this.synchronization=a:this.synchronization=SynchronizationType.NONE;this.synchronization==SynchronizationType.SPINNER&&(this.w_count=1);this.CalculateStats()}GetCount(){return this.w_count}SetCount(a){a!=
a&&(a=1);a=Math.max(1,a);this.synchronization==SynchronizationType.SPINNER&&(a=1);for("Precision Rifle"==this.weapon_type.name&&(a=1);16<a*this.weapon_type.size;)--a;this.w_count=a;this.CalculateStats()}CanRepeating(){return!this.weapon_type.rapid||0<this.weapon_type.reload}GetRepeating(){return this.repeating}SetRepeating(a){a&&this.CanRepeating()?this.repeating=!0:this.repeating=!1;this.CalculateStats()}ResolveSynch(){var a=this.synchronization;this.synchronization=SynchronizationType.ENUM_MAX;
if(this.CanSynch(a))this.synchronization=this.action==ActionType.MECHANICAL&&a!=SynchronizationType.SPINNER?SynchronizationType.SYNCH:a;else{for(a=-1;a<SynchronizationType.ENUM_MAX;a++)if(this.CanSynch(a)){this.synchronization=a;break}this.synchronization==SynchronizationType.ENUM_MAX&&this.SetWing(!0)}this.wing&&(this.synchronization=SynchronizationType.NONE);this.synchronization==SynchronizationType.SPINNER&&(this.w_count=1,this.covered=!0);this.IsLightningArc()&&(this.synchronization=SynchronizationType.NO_INTERFERENCE)}GetArty(){return 16==
this.weapon_type.size}CanSpinner(){return this.GetArty()?this.can_spinner&&this.can_arty_spinner:this.can_spinner}GetJam(){if(this.weapon_type.rapid){var a=this.weapon_type.jam.split("/");a=[parseInt(a[0]),parseInt(a[1])];this.synchronization==SynchronizationType.INTERRUPT&&(a[0]++,a[1]++);this.repeating&&(a[0]++,a[1]++);return a}a=parseInt(this.weapon_type.jam);this.synchronization==SynchronizationType.INTERRUPT&&(a+=1);this.repeating&&(a+=1);return a}IsLightningArc(){return"Lightning Arc"==this.weapon_type.name}SetTurret(a){this.turret=
a}SetCalculateStats(a){this.CalculateStats=a}PartStats(){var a=new Stats;this.ResolveSynch();!this.CanCovered()&&this.covered&&(this.covered=!1);16==this.weapon_type.size&&(this.covered=this.fixed);var b=0;for(var c=0;c<this.w_count;c++)a=a.Add(this.weapon_type.stats),b+=this.weapon_type.size;this.covered&&(c=0,1>=this.weapon_type.size?c=0:2>=this.weapon_type.size?c=1:4>=this.weapon_type.size?c=2:8>=this.weapon_type.size?c=5:16>=this.weapon_type.size&&(c=0),c*=this.w_count,this.fixed||(c*=2),this.synchronization!=
SynchronizationType.SPINNER&&(a.cost+=c),a.drag*=0);this.wing&&!this.covered&&(a.drag+=this.w_count);if(this.turret&&8<b||16==this.weapon_type.size)a.reqsections+=1;this.accessible&&(a.cost+=Math.max(1,Math.floor(1E-6+this.w_count/2)));if(!(this.fixed||2>=b))if(4>=b)a.cost+=1;else if(8>=b)a.mass+=1,a.cost+=3;else if(16>=b)a.mass+=2,a.cost+=5;else throw"Weapon size screwup in Turret size cost.";this.synchronization==SynchronizationType.INTERRUPT?(a.cost+=2*this.w_count,"Light Machine Cannon"==this.weapon_type.name&&
(a.cost+=2*this.w_count),a.era.push({name:lu("Interruptor Gear"),era:lu("WWI")})):this.synchronization==SynchronizationType.SYNCH&&this.action!=ActionType.MECHANICAL?(a.cost+=3*this.w_count,"Light Machine Cannon"==this.weapon_type.name&&(a.cost+=3*this.w_count),a.era.push({name:lu("Synchronization Gear"),era:lu("Roaring 20s")})):this.synchronization==SynchronizationType.DEFLECT?(a.cost+=1,a.warnings.push({source:lu(this.weapon_type.name),warning:lu("Deflector Plate Warning"),color:WARNING_COLOR.WHITE})):
this.synchronization!=SynchronizationType.NO_INTERFERENCE||this.IsLightningArc()||a.warnings.push({source:lu(this.weapon_type.name)+" "+lu("No Interference"),warning:lu("No Interference Warning"),color:WARNING_COLOR.WHITE});this.wing_reinforcement&&(a.mass+=2);a.Round();return a}GetElectrics(){return{storage:0,equipment:[]}}}
class WeaponSystem extends Part{constructor(a,b){super();this.weapon_list=a;this.wl_permute=b;this.directions=[...Array(6).fill(!1)];this.fixed=this.directions[0]=!0;this.ammo=1;this.raw_weapon_type=this.weapon_type=0;this.weapons=[];this.action_sel=ActionType.STANDARD;this.projectile_sel=ProjectileType.BULLETS;this.has_propeller=!0;this.sticky_guns=0;this.repeating=!1;this.seat=0;this.final_weapon={name:"",abrv:"",era:"",size:0,stats:new Stats,damage:0,hits:0,ammo:0,ap:0,jam:"",reload:0,rapid:!1,
synched:!1,shells:!1,can_action:!1,can_projectile:!1,deflection:0};this.MakeFinalWeapon();this.SWC(1)}toJSON(){var a=[];for(let b of this.weapons)a.push(b.toJSON());return{weapon_type:this.raw_weapon_type,fixed:this.fixed,directions:this.directions,weapons:a,ammo:this.ammo,action:this.action_sel,projectile:this.projectile_sel,repeating:this.repeating,seat:this.seat}}fromJSON(a,b){this.raw_weapon_type=a.weapon_type;this.weapon_type=this.wl_permute[this.raw_weapon_type];this.fixed=a.fixed;this.directions=
BoolArr(a.directions,this.directions.length);this.weapons=[];this.ammo=a.ammo;null==this.ammo&&(this.ammo=1);10.25>b?(this.action_sel=ActionType.STANDARD,this.projectile_sel=ProjectileType.BULLETS):(this.action_sel=a.action,this.projectile_sel=a.projectile);11.75>b&&(this.projectile_sel==ProjectileType.PNEUMATIC?this.projectile_sel=ProjectileType.BULLETS:this.projectile_sel==ProjectileType.ENUM_MAX&&(this.projectile_sel=ProjectileType.PNEUMATIC));this.MakeFinalWeapon();for(let d of a.weapons){var c=
new Weapon(this.final_weapon,this.action_sel,this.projectile_sel,this.fixed);c.SetCalculateStats(this.CalculateStats);c.fromJSON(d,b);this.weapons.push(c)}if(10.95>b){this.repeating=!1;for(let d of this.weapons)this.repeating=this.repeating||d.GetRepeating()}else this.repeating=a.repeating;this.seat=11.65<b?a.seat:0;this.MakeFinalWeapon();for(let d of this.weapons)d.SetWeaponType(this.final_weapon,this.action_sel,this.projectile_sel)}serialize(a){a.PushNum(this.raw_weapon_type);a.PushBool(this.fixed);
a.PushBoolArr(this.directions);a.PushNum(this.ammo);a.PushNum(this.weapons.length);for(let b of this.weapons)b.serialize(a);a.PushNum(this.action_sel);a.PushNum(this.projectile_sel);a.PushBool(this.repeating);a.PushNum(this.seat)}deserialize(a){this.raw_weapon_type=a.GetNum();this.weapon_type=this.wl_permute[this.raw_weapon_type];this.fixed=a.GetBool();this.directions=a.GetBoolArr(this.directions.length);this.ammo=a.GetNum();var b=a.GetNum();this.weapons=[];this.MakeFinalWeapon();for(let d=0;d<b;d++){var c=
new Weapon(this.final_weapon,this.action_sel,this.projectile_sel,this.fixed);c.SetCalculateStats(this.CalculateStats);c.deserialize(a);this.weapons.push(c)}10.25>a.version?(this.action_sel=ActionType.STANDARD,this.projectile_sel=ProjectileType.BULLETS):(this.action_sel=a.GetNum(),this.projectile_sel=a.GetNum());11.75>a.version&&(this.projectile_sel==ProjectileType.PNEUMATIC?this.projectile_sel=ProjectileType.BULLETS:this.projectile_sel==ProjectileType.ENUM_MAX&&(this.projectile_sel=ProjectileType.PNEUMATIC));
if(10.95>a.version){this.repeating=!1;for(let d of this.weapons)this.repeating=this.repeating||d.GetRepeating()}else this.repeating=a.GetBool();this.seat=11.65<a.version?a.GetNum():0;this.MakeFinalWeapon();for(let d of this.weapons)d.SetWeaponType(this.final_weapon,this.action_sel,this.projectile_sel)}GetWeaponSelected(){return this.weapon_type}MakeFinalWeapon(){var a=this.weapon_type;this.final_weapon.can_action=this.weapon_list[a].can_action;this.final_weapon.can_projectile=this.weapon_list[a].can_projectile;
this.final_weapon.ammo=this.weapon_list[a].ammo;this.final_weapon.ap=this.weapon_list[a].ap;this.final_weapon.damage=this.weapon_list[a].damage;this.final_weapon.era=this.weapon_list[a].era;this.final_weapon.name=this.weapon_list[a].name;this.final_weapon.abrv=this.weapon_list[a].abrv;this.final_weapon.reload=this.weapon_list[a].reload;this.final_weapon.shells=this.weapon_list[a].shells;this.final_weapon.size=this.weapon_list[a].size;this.final_weapon.stats=this.weapon_list[a].stats.Clone();this.final_weapon.deflection=
this.weapon_list[a].deflection;this.final_weapon.jam=this.weapon_list[a].jam;this.final_weapon.stats.era=[];this.final_weapon.stats.era.push({name:this.weapon_list[a].name,era:this.weapon_list[a].era});0==this.weapon_list[a].hits&&(this.action_sel==ActionType.MECHANICAL&&(this.action_sel=ActionType.STANDARD),this.projectile_sel==ProjectileType.GYROJETS||this.projectile_sel==ProjectileType.HEATRAY)&&(this.projectile_sel=ProjectileType.BULLETS);if(this.action_sel==ActionType.STANDARD)this.final_weapon.hits=
this.weapon_list[a].hits,this.final_weapon.rapid=this.weapon_list[a].rapid,this.final_weapon.synched=this.weapon_list[a].synched;else if(this.action_sel==ActionType.MECHANICAL)this.final_weapon.hits=this.weapon_list[a].hits,this.final_weapon.stats.warnings.push({source:lu("Mechanical Action"),warning:lu("Mechanical Action Warning"),color:WARNING_COLOR.WHITE}),this.final_weapon.jam="0/0",this.final_weapon.rapid=!0,this.final_weapon.stats.cost+=this.weapon_list[a].stats.cost,this.final_weapon.synched=
!0,this.final_weapon.stats.era.push({name:lu("Mechanical Action"),era:lu("WWI")});else if(this.action_sel==ActionType.GAST)this.final_weapon.hits=2*this.weapon_list[a].hits,this.final_weapon.ammo=this.weapon_list[a].ammo/2,this.final_weapon.rapid=this.weapon_list[a].rapid,this.final_weapon.stats.cost+=this.weapon_list[a].stats.cost,this.final_weapon.synched=!1,this.final_weapon.stats.era.push({name:lu("Gast Principle"),era:lu("WWI")});else if(this.action_sel==ActionType.ROTARY){this.final_weapon.stats.mass+=
this.weapon_list[a].stats.mass;this.final_weapon.stats.cost+=this.weapon_list[a].stats.cost;this.final_weapon.size+=this.weapon_list[a].size;this.final_weapon.size=Math.min(16,this.final_weapon.size);this.final_weapon.hits=3*this.weapon_list[a].hits;--this.final_weapon.deflection;this.final_weapon.synched=!1;var b=this.final_weapon.jam.split("/");b[0]="9999";b[1]=(parseInt(b[1])+1).toString();this.final_weapon.jam=b.join("/");this.final_weapon.stats.era.push({name:lu("Rotary_Gun"),era:lu("WWI")})}this.repeating&&
0!=this.final_weapon.reload&&(this.final_weapon.reload=0,this.final_weapon.stats.cost+=Math.max(1,Math.floor(1E-6+.5*this.weapon_list[a].stats.cost)));this.action_sel!=ActionType.GAST&&this.action_sel!=ActionType.MECHANICAL||this.projectile_sel!=ProjectileType.HEATRAY||(this.projectile_sel=ProjectileType.BULLETS);this.action_sel!=ActionType.GAST&&this.action_sel!=ActionType.ROTARY||this.projectile_sel!=ProjectileType.PNEUMATIC||(this.projectile_sel=ProjectileType.BULLETS);this.projectile_sel==ProjectileType.HEATRAY?
(this.final_weapon.stats.cost+=this.weapon_list[a].stats.cost,this.final_weapon.shells=!1,this.final_weapon.ammo=0,this.final_weapon.deflection=0,this.final_weapon.ap=Math.max(0,this.final_weapon.ap-1),this.final_weapon.stats.warnings.push({source:lu("Heat Ray"),warning:lu("Heat Ray Warning"),color:WARNING_COLOR.WHITE}),this.final_weapon.stats.era.push({name:lu("Heat Ray"),era:lu("Himmilgard")})):this.projectile_sel==ProjectileType.GYROJETS?(this.final_weapon.stats.cost+=Math.max(1,Math.floor(1E-6+
.5*this.weapon_list[a].stats.cost)),this.final_weapon.shells=!1,--this.final_weapon.damage,this.final_weapon.stats.warnings.push({source:lu("Gyrojets"),warning:lu("Gyrojets Warning"),color:WARNING_COLOR.WHITE}),this.final_weapon.stats.era.push({name:lu("Gyrojets"),era:lu("Roaring 20s")})):this.projectile_sel==ProjectileType.PNEUMATIC&&(this.final_weapon.ammo*=2,this.final_weapon.shells=!1,this.final_weapon.rapid&&(b=this.final_weapon.jam.split("/"),b[1]="9999",this.final_weapon.jam=b.join("/"),this.final_weapon.stats.warnings.push({source:lu("Pneumatic"),
warning:lu("Pneumatic Warning 1"),color:WARNING_COLOR.WHITE}),this.final_weapon.stats.era.push({name:lu("Pneumatic"),era:lu("Pioneer")})),0<this.final_weapon.hits&&this.final_weapon.stats.warnings.push({source:lu("Pneumatic"),warning:lu("Pneumatic Warning 2"),color:WARNING_COLOR.WHITE}));0!=this.final_weapon.deflection&&this.final_weapon.stats.warnings.push({source:lu(this.final_weapon.name),warning:lu("Deflection Warning",this.final_weapon.deflection),color:WARNING_COLOR.WHITE})}SetWeaponSelected(a){var b=
this.IsLightningArc();this.weapon_type=a;this.raw_weapon_type=this.wl_permute.findIndex(d=>d==a);if(16==this.weapon_list[a].size)for(;1<this.weapons.length;)this.weapons.pop();this.weapon_list[a].can_action&&this.GetCanAction()[this.action_sel]||(this.action_sel=ActionType.STANDARD);this.weapon_list[a].can_projectile&&this.GetCanProjectile()[this.projectile_sel]||(this.projectile_sel=ProjectileType.BULLETS);this.weapon_list[a].rapid?this.repeating=!1:this.repeating||this.action_sel!=ActionType.GAST||
(this.action_sel=ActionType.STANDARD);this.CanRepeating()||(this.repeating=!1);this.MakeFinalWeapon();for(var c of this.weapons)c.SetWeaponType(this.final_weapon,this.action_sel,this.projectile_sel);if(this.IsLightningArc())for(this.SetFixed(!0),this.directions[0]=!0,c=1;c<this.directions.length;c++)this.directions[c]=!1;b&&!this.IsLightningArc()&&this.weapons[0].SetSynchronization(SynchronizationType.NONE);this.CalculateStats()}CanRepeating(){return(!this.weapon_list[this.weapon_type].rapid||0<this.weapon_list[this.weapon_type].reload)&&
0<this.weapon_list[this.weapon_type].ammo&&"Precision Rifle"!=this.weapon_list[this.weapon_type].name}GetRepeating(){return this.repeating}SetRepeating(a){a&&this.CanRepeating()?this.repeating=!0:(this.repeating=!1,this.weapon_list[this.weapon_type].rapid||this.action_sel!=ActionType.GAST||(this.action_sel=ActionType.STANDARD));this.MakeFinalWeapon();for(let b of this.weapons)b.SetWeaponType(this.final_weapon,this.action_sel,this.projectile_sel);this.CalculateStats()}GetFixed(){return this.fixed}SetFixed(a){this.IsLightningArc()&&
(a=!0);if(this.fixed!=a){this.fixed=a;for(var b of this.weapons)b.SetFixed(this.fixed);if(a)for(a=!1,b=0;b<this.directions.length;b++)this.directions[b]&&a?this.directions[b]=!1:this.directions[b]&&(a=!0)}this.CalculateStats()}CanDirection(){if(this.IsLightningArc())return[...Array(this.directions.length).fill(!1)];var a=[...Array(this.directions.length).fill(!0)];if(this.weapons[0].GetArty()&&this.fixed&&!this.weapons[0].GetWing()){var b=this.weapons[0].GetSynchronization()==SynchronizationType.SPINNER;
!this.tractor||this.spinner_t||b&&this.directions[0]||(a[0]=!1);!this.pusher||this.spinner_p||b&&this.directions[1]||(a[1]=!1);this.heli&&(a[2]=!1)}return a}GetDirection(){return this.directions}SetDirection(a,b){this.fixed&&this.directions[a]&&!b&&(b=!0);this.fixed&&(this.directions=[...Array(6).fill(!1)],this.weapons[0].GetArty()&&!this.weapons[0].GetWing()&&(0==a&&this.tractor&&!this.spinner_t&&(a=1),1==a&&this.pusher&&!this.spinner_p&&(a=3),2==a&&this.heli&&(a=3)));this.directions[a]=b;this.CalculateStats()}GetMountingCount(){return this.weapons.length}GetWeaponCount(){var a=
0;for(let b of this.weapons)a+=b.GetCount();return a}SWC(a){if(a!=a||1>a)a=1;for(a=Math.floor(1E-6+a);a>this.weapons.length;){var b=new Weapon(this.final_weapon,this.action_sel,this.projectile_sel,this.fixed);b.SetCalculateStats(this.CalculateStats);this.weapons.push(b)}for(;a<this.weapons.length;)this.weapons.pop()}SetMountingCount(a){if(16==this.final_weapon.size||"Precision Rifle"==this.final_weapon.name)a=1;this.SWC(a);this.CalculateStats()}GetWeapons(){return this.weapons}SetCanFreelyAccessible(a){for(let b of this.weapons)b.GetWing()?
b.can_free_accessible=!1:b.can_free_accessible=a}SetTractorPusher(a,b,c,d,e,f,h){this.tractor=a;this.pusher=d;this.heli=h;this.spinner_t=c;this.spinner_p=f;if(this.directions[0]&&a)for(let g of this.weapons)g.GetFixed()&&!g.GetWing()?(g.can_synchronize=!0,g.can_spinner=b||g.GetSynchronization()==SynchronizationType.SPINNER,g.can_arty_spinner=c||g.GetSynchronization()==SynchronizationType.SPINNER):(g.GetFixed()||g.GetWing()?g.can_synchronize=!1:g.can_synchronize=!0,g.can_spinner=!1,g.can_arty_spinner=
!1);else if(this.directions[1]&&d)for(let g of this.weapons)g.GetFixed()&&!g.GetWing()?(g.can_synchronize=!0,g.can_spinner=e||g.GetSynchronization()==SynchronizationType.SPINNER,g.can_arty_spinner=f||g.GetSynchronization()==SynchronizationType.SPINNER):(g.GetFixed()||g.GetWing()?g.can_synchronize=!1:g.can_synchronize=!0,g.can_spinner=!1,g.can_arty_spinner=!1);else if(this.directions[2]&&this.heli)for(let g of this.weapons)g.can_synchronize=!0,g.can_spinner=!1,g.can_arty_spinner=!1;else for(let g of this.weapons)g.can_synchronize=
!1,g.can_spinner=!1,g.can_arty_spinner=!1}GetHits(){var a=this.final_weapon.hits;if(0!=a){var b=0,c=0;for(let d of this.weapons)d.GetWing()&&(d.GetFixed()||2>=this.GetDirectionCount())?c+=d.GetCount()*a:b+=d.GetCount()*a;return[b+c,Math.floor(1E-6+.75*b)+Math.floor(1E-6+.9*c),Math.floor(1E-6+.5*b)+Math.floor(1E-6+.2*c),Math.floor(1E-6+.25*b)+Math.floor(1E-6+.1*c)]}if(this.IsLightningArc())return[0,0,0,0];if(0==this.final_weapon.ammo){a=0;for(b of this.weapons)a+=b.GetCount();return[3*a,0,0,0]}a=0;
for(c of this.weapons)a+=c.GetCount();this.action_sel==ActionType.GAST&&(a*=2);return[3*a,2*a,1*a,0]}GetDamage(){return this.final_weapon.damage}GetAmmo(){return this.ammo}GetJam(){if(this.final_weapon.rapid){var a=[0,0];for(var b of this.weapons){var c=b.GetJam();a[0]=Math.max(a[0],c[0]+this.sticky_guns);a[1]=Math.max(a[1],c[1]+this.sticky_guns)}return a[0].toString()+"/"+a[1].toString()}b=0;for(a of this.weapons)b=Math.max(b,a.GetJam()+this.sticky_guns);return b.toString()}IsPlural(){return 1<this.weapons.length||
1<this.weapons[0].GetCount()}SetAmmo(a){if(a!=a||1>a)a=1;this.ammo=a=Math.floor(1E-6+a);this.CalculateStats()}SetHavePropeller(a){this.has_propeller&&!a&&this.action_sel==ActionType.MECHANICAL&&(this.has_propeller=a,this.SetAction(ActionType.STANDARD));this.has_propeller=a}SetCanWing(a){for(let b of this.weapons)b.SetCanWing(a)}GetAction(){return this.action_sel}GetCanAction(){return[!0,this.has_propeller&&this.weapon_list[this.weapon_type].can_action&&0<this.weapon_list[this.weapon_type].hits&&(this.repeating||
this.weapon_list[this.weapon_type].rapid),this.weapon_list[this.weapon_type].can_action&&(this.repeating||this.weapon_list[this.weapon_type].rapid),this.weapon_list[this.weapon_type].can_action&&this.weapon_list[this.weapon_type].rapid]}SetAction(a){if(this.final_weapon.can_action){this.action_sel=a;this.MakeFinalWeapon();for(let b of this.weapons)b.SetWeaponType(this.final_weapon,this.action_sel,this.projectile_sel)}else this.action_sel=ActionType.STANDARD;this.CalculateStats()}GetCanProjectile(){return[!0,
this.final_weapon.can_projectile&&this.action_sel!=ActionType.MECHANICAL&&this.action_sel!=ActionType.GAST&&0<this.weapon_list[this.weapon_type].hits,this.final_weapon.can_projectile&&this.action_sel!=ActionType.ROTARY&&this.action_sel!=ActionType.GAST]}GetProjectile(){return this.projectile_sel}SetProjectile(a){if(this.final_weapon.can_projectile){this.projectile_sel=a;this.MakeFinalWeapon();for(let b of this.weapons)b.SetWeaponType(this.final_weapon,this.action_sel,this.projectile_sel)}else this.projectile_sel=
ProjectileType.BULLETS;this.CalculateStats()}GetFinalWeapon(){return this.final_weapon}SetStickyGuns(a){this.sticky_guns=a}GetHRCharges(){if(this.IsLightningArc())return[3];var a=0;for(var b of this.weapons)a+=b.GetCount();if(0<this.final_weapon.hits)return b=this.weapon_list[this.weapon_type].stats.cost,this.action_sel==ActionType.ROTARY&&(b*=2),this.final_weapon.rapid?[a*b,Math.max(a*b+1,Math.floor(1E-6+1.5*a*b))]:[a*b];if("Scattergun"==this.final_weapon.name)return this.final_weapon.rapid?[1,3]:
[1];if("Punt Gun"==this.final_weapon.name)return this.final_weapon.rapid?[3,6]:[3]}GetShots(){return Math.floor(1E-6+this.final_weapon.ammo*this.ammo)}IsLightningArc(){return"Lightning Arc"==this.final_weapon.name}GetReload(){return this.final_weapon.reload}GetWingWeight(){var a=0;for(let b of this.weapons)b.GetWing()&&(a+=b.PartStats().mass);return a}GetDirectionCount(){var a=0;for(let b of this.directions)b&&a++;return a}SetSeat(a){this.seat=a;this.CalculateStats()}GetSeat(){return this.seat}GetIsFullyAccessible(){for(let a of this.weapons)if(!a.GetAccessible())return!1;
return!0}GetIsPartlyAccessible(){for(let a of this.weapons)if(a.GetAccessible())return!0;return!1}SetCalculateStats(a){this.CalculateStats=a;for(let b of this.weapons)b.SetCalculateStats(a)}PartStats(){var a=new Stats,b=0;for(var c of this.directions)c&&b++;c=0;for(let d of this.weapons)d.has_cantilever=this.has_cantilever,d.SetTurret(2<this.GetDirectionCount()),a=a.Add(d.PartStats()),c+=d.GetCount(),this.fixed||(2==b?a.cost+=1:3==b||4==b?a.cost+=2:5==b?a.cost+=3:6==b&&(a.cost+=4));if(this.projectile_sel==
ProjectileType.HEATRAY||this.IsLightningArc())this.ammo=1;a.mass+=(this.ammo-1)*c;return a}GetElectrics(){return{storage:0,equipment:[]}}}
class Weapons extends Part{constructor(a){super();this.direction_list="Forward Rearward Up Down Left Right".split(" ");this.synchronization_list="None;Interruptor Gear;Synchronization Gear;Spinner Gun;Deflector Plate;No Interference".split(";");this.action_list=[{name:"Standard Action"},{name:"Mechanical Action"},{name:"Gast Principle"},{name:"Rotary_Gun"}];this.projectile_list=[{name:"Standard"},{name:"Heat Ray"},{name:"Pneumatic"}];this.weapon_list=[];for(var b of a.weapons)a={name:b.name,abrv:b.abrv,
era:b.era,size:b.size,stats:new Stats(b),damage:b.damage,hits:b.hits,ammo:b.ammo,ap:b.ap,jam:b.jam,reload:b.reload,rapid:b.rapid,synched:b.synched,shells:b.shells,can_action:b.can_action,can_projectile:b.can_projectile,deflection:b.deflection},this.weapon_list.push(a);var c=(d,e)=>{var f=(h,g)=>h<g?-1:g<h?1:0;return d.size!=e.size?f(d.size,e.size):d.era!=e.era?f(era2numHh(d.era),era2numHh(e.era)):d.damage!=e.damage?f(d.damage,e.damage):f(d.name,e.name)};this.wl_permute=Array.from(Array(this.weapon_list.length).keys()).sort((d,
e)=>c(this.weapon_list[d],this.weapon_list[e]));b=[];for(let d=0;d<this.wl_permute.length;d++)b.push(this.wl_permute.findIndex(e=>e==d));this.wl_permute=b;this.weapon_list=this.weapon_list.sort(c);this.weapon_sets=[];this.brace_count=0;this.isheli=!1}toJSON(){var a=[];for(let b of this.weapon_sets)a.push(b.toJSON());return{weapon_systems:a,brace_count:this.brace_count}}fromJSON(a,b){this.weapon_sets=[];var c=a.weapon_systems;for(let d of c)c=new WeaponSystem(this.weapon_list,this.wl_permute),c.SetCalculateStats(this.CalculateStats),
c.fromJSON(d,b),this.weapon_sets.push(c);10.35<b&&(this.brace_count=a.brace_count)}serialize(a){a.PushNum(this.weapon_sets.length);for(let b of this.weapon_sets)b.serialize(a);a.PushNum(this.brace_count)}deserialize(a){this.weapon_sets=[];var b=a.GetNum();for(let d=0;d<b;d++){var c=new WeaponSystem(this.weapon_list,this.wl_permute);c.SetCalculateStats(this.CalculateStats);c.deserialize(a);this.weapon_sets.push(c)}10.35<a.version&&(this.brace_count=a.GetNum())}GetWeaponList(){return this.weapon_list}GetDirectionList(){return this.direction_list}GetSynchronizationList(){return this.synchronization_list}SetWeaponSetCount(a){if(a!=
a||1>a)a=0;for(a=Math.floor(1E-6+a);a>this.weapon_sets.length;){var b=new WeaponSystem(this.weapon_list,this.wl_permute);b.SetCalculateStats(this.CalculateStats);this.weapon_sets.push(b)}for(;a<this.weapon_sets.length;)this.weapon_sets.pop();this.CalculateStats()}GetWeaponSets(){return this.weapon_sets}CountTractorSpinner(){var a=0;for(let c of this.weapon_sets)if(c.GetDirection()[0]){var b=c.GetWeapons();for(let d of b)d.GetSynchronization()==SynchronizationType.SPINNER&&a++}return a}CountArtyTractorSpinner(){var a=
0;for(let c of this.weapon_sets)if(c.GetDirection()[0]){var b=c.GetWeapons();for(let d of b)d.GetArty()&&d.GetSynchronization()==SynchronizationType.SPINNER&&a++}return a}CountPusherSpinner(){var a=0;for(let c of this.weapon_sets)if(c.GetDirection()[1]){var b=c.GetWeapons();for(let d of b)d.GetSynchronization()==SynchronizationType.SPINNER&&a++}return a}CountArtyPusherSpinner(){var a=0;for(let c of this.weapon_sets)if(c.GetDirection()[1]){var b=c.GetWeapons();for(let d of b)d.GetArty()&&d.GetSynchronization()==
SynchronizationType.SPINNER&&a++}return a}CleanFreelyAccessible(){var a=Array(this.cockpit_count).fill(!1);for(var b of this.weapon_sets){let c=b.GetSeat();for(let d of b.GetWeapons())d.GetFreeAccessible()&&a[c]?d.SetFreeAccessible(!1):d.GetFreeAccessible()&&(a[c]=!0)}for(let c of this.weapon_sets){b=c.GetSeat();for(let d of c.GetWeapons())a[b]&&!d.GetFreeAccessible()||d.GetWing()?d.can_free_accessible=!1:d.can_free_accessible=!0}}RemoveOneTractorSpinner(){for(let b=this.weapon_sets.length-1;0<=b;b--)if(this.weapon_sets[b].GetDirection()[0]){var a=
this.weapon_sets[b].GetWeapons();for(let c=a.length-1;0<=c;c--)if(a[c].GetSynchronization()==SynchronizationType.SPINNER){a[c].SetSynchronization(SynchronizationType.INTERRUPT);return}}}RemoveOneArtyTractorSpinner(){for(let b=this.weapon_sets.length-1;0<=b;b--)if(this.weapon_sets[b].GetDirection()[0]){var a=this.weapon_sets[b].GetWeapons();for(let c=a.length-1;0<=c;c--)if(a[c].GetSynchronization()==SynchronizationType.SPINNER&&a[c].GetArty()){this.weapon_sets[b].SetDirection(3,!0);return}}}RemoveOnePusherSpinner(){for(let b=
this.weapon_sets.length-1;0<=b;b--)if(this.weapon_sets[b].GetDirection()[1]){var a=this.weapon_sets[b].GetWeapons();for(let c=a.length-1;0<=c;c--)if(a[c].GetSynchronization()==SynchronizationType.SPINNER){a[c].SetSynchronization(SynchronizationType.INTERRUPT);return}}}RemoveOneArtyPusherSpinner(){for(let b=this.weapon_sets.length-1;0<=b;b--)if(this.weapon_sets[b].GetDirection()[1]){var a=this.weapon_sets[b].GetWeapons();for(let c=a.length-1;0<=c;c--)if(a[c].GetSynchronization()==SynchronizationType.SPINNER&&
a[c].GetArty()){this.weapon_sets[b].SetDirection(3,!0);return}}}CanTractorSpinner(){return this.CountTractorSpinner()+this.CountArtyTractorSpinner()<this.tractor_spinner_count}CanArtyTractorSpinner(){return this.CountArtyTractorSpinner()<this.tractor_arty_spinner_count}CanPusherSpinner(){return this.CountPusherSpinner()+this.CountArtyTractorSpinner()<this.pusher_spinner_count}CanArtyPusherSpinner(){return this.CountArtyPusherSpinner()<this.pusher_arty_spinner_count}SetTractorInfo(a){this.has_tractor=
a.have;this.tractor_spinner_count=a.spin_count;this.tractor_arty_spinner_count=a.arty_spin_count}SetPusherInfo(a){this.has_pusher=a.have;this.pusher_spinner_count=a.spin_count;this.pusher_arty_spinner_count=a.arty_spin_count}GetActionList(){return this.action_list}GetProjectileList(){return this.projectile_list}GetBraceCount(){return this.brace_count}SetBraceCount(a){if(0>a||a!=a)a=0;this.brace_count=a-a%3;this.CalculateStats()}SetHavePropeller(a){for(let b of this.weapon_sets)b.SetHavePropeller(a)}SetCanWing(a){for(let b of this.weapon_sets)b.SetCanWing(a)}SetStickyGuns(a){for(let b of this.weapon_sets)b.SetStickyGuns(a)}GetWingWeight(){var a=
0;for(let b of this.weapon_sets)a+=b.GetWingWeight();return a}GetSeatList(){var a=[];for(let b=0;b<this.cockpit_count;b++)a.push(lu("Seat #",b+1));return a}GetArmedSeats(){var a=Array(this.cockpit_count).fill(!1);for(let b of this.weapon_sets)a[b.GetSeat()]=!0;return a}SetCalculateStats(a){this.CalculateStats=a;for(let b of this.weapon_sets)b.SetCalculateStats(a)}SetNumberOfCockpits(a){this.cockpit_count=a}SetHeli(a){this.isheli=a}PartStats(){var a=new Stats;for(this.CleanFreelyAccessible();this.CountArtyTractorSpinner()>
this.tractor_arty_spinner_count;)this.RemoveOneArtyTractorSpinner();for(;this.CountTractorSpinner()>this.tractor_spinner_count;)this.RemoveOneTractorSpinner();for(;this.CountArtyPusherSpinner()>this.pusher_arty_spinner_count;)this.RemoveOneArtyPusherSpinner();for(;this.CountPusherSpinner()>this.pusher_spinner_count;)this.RemoveOnePusherSpinner();var b=0;b=0==this.cant_type?4:1==this.cant_type?8:16;var c=[];for(let e of this.weapon_sets)for(let f of e.GetWeapons()){f.wing_reinforcement=!1;var d={s:0,
w:f};f.GetWing()&&(d.s=f.GetCount()*this.weapon_list[e.GetWeaponSelected()].size,c.push(d))}c.sort(function(e,f){return e.s-f.s});for(let e of c)0<=b&&(b-=e.s),0>b&&(e.w.wing_reinforcement=!0);for(let e of this.weapon_sets)e.SetTractorPusher(this.has_tractor,this.CanTractorSpinner(),this.CanArtyTractorSpinner(),this.has_pusher,this.CanPusherSpinner(),this.CanArtyPusherSpinner(),this.isheli),e.has_cantilever=0<this.cant_type,a=a.Add(e.PartStats());a.cost+=this.brace_count/3;0<this.brace_count&&a.warnings.push({source:lu("Weapons Braces"),
warning:lu("Weapons Braces Warning"),color:WARNING_COLOR.WHITE});a.control-=Math.floor(1E-6+this.GetWingWeight()/5);return a}GetElectrics(){let a={storage:0,equipment:[]};for(let b=0;b<this.weapon_sets.length;b++){let c=this.weapon_sets[b];if(c.GetProjectile()==ProjectileType.HEATRAY||c.IsLightningArc()){let d=c.GetHRCharges();for(let e=0;e<d.length;e++)d[e]*=-1;a.equipment.push({source:lu("Vital Part Weapon Set",b,c.GetFinalWeapon().abrv),charge:StringFmt.Join("/",d)})}}return a}}
class Used extends Part{constructor(){super();this.sluggish=this.leaky=this.fragile=this.weak=this.sticky_guns=this.hefty=this.ragged=this.burnt_out=0}GetEnabled(){return 0!=Math.abs(this.burnt_out)+Math.abs(this.ragged)+Math.abs(this.hefty)+Math.abs(this.sticky_guns)+Math.abs(this.weak)+Math.abs(this.fragile)+Math.abs(this.leaky)+Math.abs(this.sluggish)}SetEnabled(a){this.sluggish=this.leaky=this.fragile=this.weak=this.sticky_guns=this.hefty=this.ragged=this.burnt_out=0;this.CalculateStats()}toJSON(){return{enabled:!0,
burnt_out:this.burnt_out,ragged:this.ragged,hefty:this.hefty,sticky_guns:this.sticky_guns,weak:this.weak,fragile:this.fragile,leaky:this.leaky,sluggish:this.sluggish}}fromJSON(a,b){this.burnt_out=a.burnt_out;this.ragged=a.ragged;this.hefty=a.hefty;this.sticky_guns=a.sticky_guns;this.weak=a.weak;this.fragile=a.fragile;this.leaky=a.leaky;this.sluggish=a.sluggish}serialize(a){a.PushBool(!0);a.PushNum(this.burnt_out);a.PushNum(this.ragged);a.PushNum(this.hefty);a.PushNum(this.sticky_guns);a.PushNum(this.weak);
a.PushNum(this.fragile);a.PushNum(this.leaky);a.PushNum(this.sluggish)}deserialize(a){a.GetBool();this.burnt_out=a.GetNum();this.ragged=a.GetNum();this.hefty=a.GetNum();this.sticky_guns=a.GetNum();this.weak=a.GetNum();this.fragile=a.GetNum();this.leaky=a.GetNum();this.sluggish=a.GetNum()}Normalize(a){a!=a&&(a=0);a=Math.floor(1E-6+a);a=Math.min(1,a);return a=Math.max(-1,a)}PartStats(){this.burnt_out=this.Normalize(this.burnt_out);this.ragged=this.Normalize(this.ragged);this.hefty=this.Normalize(this.hefty);
this.sticky_guns=this.Normalize(this.sticky_guns);this.weak=this.Normalize(this.weak);this.fragile=this.Normalize(this.fragile);this.leaky=this.Normalize(this.leaky);this.sluggish=this.Normalize(this.sluggish);return new Stats}SetCalculateStats(a){this.CalculateStats=a}TriggerCS(){this.burnt_out=this.Normalize(this.burnt_out);this.ragged=this.Normalize(this.ragged);this.hefty=this.Normalize(this.hefty);this.sticky_guns=this.Normalize(this.sticky_guns);this.weak=this.Normalize(this.weak);this.fragile=
this.Normalize(this.fragile);this.leaky=this.Normalize(this.leaky);this.sluggish=this.Normalize(this.sluggish);this.CalculateStats()}GetElectrics(){return{storage:0,equipment:[]}}}var ROTOR_BLADE_COUNT;(function(a){a[a.Two=2]="Two";a[a.Three=3]="Three";a[a.Four=4]="Four";a[a.Five=5]="Five"})(ROTOR_BLADE_COUNT||={});
class Rotor extends Part{constructor(a){super();this.type=AIRCRAFT_TYPE.AIRPLANE;this.cant_idx=this.sizing_span=this.dryMP=this.stagger_sel=this.wing_area=this.rotor_span=this.rotor_count=0;this.accessory=!1;this.blade_idx=0;this.blade_list=[];for(let b of a.blade_count)this.blade_list.push({name:b.name,rotor_bleed:b.rotor_bleed,sizing:b.sizing,stats:new Stats(b)});this.stagger_list=[];for(let b of a.arrangement)this.stagger_list.push({name:b.name,count:b.count,powerfactor:b.powerfactor,blades:b.blades,
stats:new Stats(b)})}toJSON(){return{type:this.type,rotor_count:this.rotor_count,rotor_span:this.rotor_span,rotor_mat:this.cant_idx,stagger_sel:this.stagger_sel,accessory:this.accessory,blade_idx:this.blade_idx}}fromJSON(a,b){this.type=a.type;this.rotor_count=a.rotor_count;this.rotor_span=a.rotor_span;this.cant_idx=a.rotor_mat;this.stagger_sel=12.35>b?0:a.stagger_sel;this.accessory=a.accessory;11.55<b&&(this.blade_idx=a.blade_idx);12.45>b&&(this.rotor_span=0)}serialize(a){a.PushNum(this.type);a.PushNum(this.rotor_count);
a.PushNum(this.rotor_span);a.PushNum(this.cant_idx);a.PushNum(this.stagger_sel);a.PushBool(this.accessory);a.PushNum(this.blade_idx)}deserialise(a){this.type=a.GetNum();this.rotor_count=a.GetNum();this.rotor_span=a.GetNum();this.cant_idx=a.GetNum();12.35>a.version?(a.GetBool(),this.stagger_sel=0):this.stagger_sel=a.GetNum();this.accessory=a.GetBool();11.55<a.version&&(this.blade_idx=a.GetNum());12.45>a.version&&(this.rotor_span=0)}SetCantileverList(a){this.cant_list=a}GetCantileverList(){return this.cant_list}SetCantilever(a){this.cant_idx=
a;this.CalculateStats()}GetCantilever(){return this.cant_idx}SetType(a){this.type!=a&&(this.accessory=!1,this.stagger_sel=this.cant_idx=0,this.rotor_count=1,this.type=a,this.rotor_span=0)}CanRotorCount(){return this.type==AIRCRAFT_TYPE.HELICOPTER}SetRotorCount(a){1>a&&(a=1);2<=a&&1==a%2&&(a=a==this.rotor_count+1?a+1:a-1);this.rotor_count=a;2>this.rotor_count&&(this.stagger_sel=0);this.CalculateStats()}GetRotorCount(){return this.rotor_count}CanRotorSpan(){return this.type==AIRCRAFT_TYPE.HELICOPTER}SetRotorSpan(a){this.rotor_span=
Math.floor(1E-6+a);this.CalculateStats()}GetRotorSpan(){return this.rotor_span}CanTandem(){return this.type==AIRCRAFT_TYPE.HELICOPTER&&1<this.rotor_count}SetBladeCount(a){this.blade_idx=a;this.CalculateStats()}SetWingArea(a){this.wing_area=a}GetSizingSpan(){return this.sizing_span}SetMP(a){a!=this.dryMP&&(this.dryMP=a,this.CalculateStats())}GetRotorStrain(){var a=this.GetRotorArea();return this.rotor_count*Math.max(1,2*(this.sizing_span+this.rotor_span)+a-10)}GetRotorArea(){return Math.PI/9*(this.sizing_span+
this.rotor_span)*(this.sizing_span+this.rotor_span)}GetIdealRotorArea(){return Math.PI/9*this.sizing_span*this.sizing_span}GetRotorDrag(){if(this.type==AIRCRAFT_TYPE.HELICOPTER||this.type==AIRCRAFT_TYPE.AUTOGYRO){var a=this.GetRotorArea();return 1==this.rotor_count?Math.floor(1E-6+6*a*a/((this.sizing_span+this.rotor_span)*(this.sizing_span+this.rotor_span))):Math.floor(1E-6+.75*this.rotor_count*Math.floor(1E-6+6*a*a/((this.sizing_span+this.rotor_span)*(this.sizing_span+this.rotor_span))))}return 0}GetType(){return this.type}GetAccessory(){return this.accessory}SetAccessory(a){this.accessory=
a;this.CalculateStats()}SetEngineCount(a){this.engine_count=a}GetTailRotor(){return this.type==AIRCRAFT_TYPE.HELICOPTER&&2>this.rotor_count}GetBladeList(){return this.blade_list}GetRotorBleed(){return this.type==AIRCRAFT_TYPE.HELICOPTER?this.blade_list[this.blade_idx].rotor_bleed:0}GetPowerFactor(){return this.stagger_list[this.stagger_sel].powerfactor}GetBladeCountIdx(){return this.blade_idx}GetStaggerList(){return this.stagger_list}GetStagger(){return this.stagger_sel}SetStagger(a){a!=this.stagger_sel&&
(this.stagger_sel=a,this.CalculateStats())}CanStagger(){var a=[];for(let b=0;b<this.stagger_list.length;b++)1==this.rotor_count&&1==this.stagger_list[b].count?a.push(!0):2==this.rotor_count&&2==this.stagger_list[b].count?a.push(!0):2<=this.rotor_count&&3==this.stagger_list[b].count?a.push(!0):a.push(!1);return a}VerifySizes(){this.type==AIRCRAFT_TYPE.AIRPLANE?this.stagger_sel=this.rotor_span=this.rotor_count=0:this.type==AIRCRAFT_TYPE.AUTOGYRO?(this.rotor_count=1,this.sizing_span=Math.ceil(-1E-6+
Math.sqrt(.6*this.wing_area/(Math.PI/8))),this.rotor_span=Math.max(this.rotor_span,2-this.sizing_span),this.stagger_sel=0):this.type==AIRCRAFT_TYPE.HELICOPTER&&(this.rotor_count=Math.max(1,this.rotor_count),1<this.rotor_count&&1==this.rotor_count%2&&--this.rotor_count,this.sizing_span=1==this.rotor_count?Math.ceil(-1E-6+5*Math.pow(this.dryMP,.4)*this.blade_list[this.blade_idx].sizing):Math.ceil(-1E-6+4*Math.pow(this.dryMP,.4)*this.blade_list[this.blade_idx].sizing),this.sizing_span=Math.min(100,this.sizing_span),
this.rotor_span=Math.max(this.rotor_span,-Math.floor(1E-6+this.sizing_span/2)))}VerifyStagger(){if(2<this.rotor_count&&2>=this.stagger_list[this.stagger_sel].count)for(var a=0;a<this.stagger_list.length;a++){if(3==this.stagger_list[a].count){this.stagger_sel=a;break}}else if(2==this.rotor_count&&2!=this.stagger_list[this.stagger_sel].count)for(a=0;a<this.stagger_list.length;a++){if(2==this.stagger_list[a].count){this.stagger_sel=a;break}}else if(1==this.rotor_count&&1!=this.stagger_list[this.stagger_sel].count)for(a=
0;a<this.stagger_list.length;a++)if(1==this.stagger_list[a].count){this.stagger_sel=a;break}}PartStats(){this.VerifySizes();this.VerifyStagger();var a=new Stats,b=this.GetRotorArea();a.wingarea+=Math.floor(1E-6+b);a.drag=this.GetRotorDrag();b=this.GetRotorStrain();var c=this.cant_list[this.cant_idx].stats.Clone();c=c.Multiply(Math.ceil(-1E-6+b/c.maxstrain));c.maxstrain=0;c.toughness=0;a=a.Add(c);a=a.Add(this.stagger_list[this.stagger_sel].stats.Clone());this.type==AIRCRAFT_TYPE.HELICOPTER&&(a.reliability=
2*Math.min(0,this.rotor_span),a=a.Add(this.blade_list[this.blade_idx].stats));this.accessory?this.type==AIRCRAFT_TYPE.AUTOGYRO?(a.cost+=2,a.mass+=2):this.type==AIRCRAFT_TYPE.HELICOPTER&&(a.mass+=this.rotor_count*this.engine_count):this.type==AIRCRAFT_TYPE.HELICOPTER&&(a.mass+=Math.max(this.rotor_count,this.engine_count));this.type==AIRCRAFT_TYPE.HELICOPTER?(a.warnings.push({source:lu("Helicopter Landing"),warning:lu("Helicopter Landing Warning"),color:WARNING_COLOR.WHITE}),a.warnings.push({source:lu("Helicopter Descent"),
warning:lu("Helicopter Descent Warning"),color:WARNING_COLOR.WHITE}),a.warnings.push({source:lu("Helicopter Stall"),warning:lu("Helicopter Stall Warning"),color:WARNING_COLOR.WHITE}),0>a.reliability&&a.warnings.push({source:lu("Rotor Span"),warning:lu("Rotor Span Warning"),color:WARNING_COLOR.YELLOW})):this.type==AIRCRAFT_TYPE.AUTOGYRO&&a.warnings.push({source:lu("Autogyro Stall"),warning:lu("Autogyro Stall Warning"),color:WARNING_COLOR.WHITE});return a}SetCalculateStats(a){this.CalculateStats=a}GetElectrics(){return{storage:0,
equipment:[]}}}
class Aircraft{constructor(a,b,c){this.use_storage=!1;this.reset_json=String.raw`{"version":"11.3","name":"Basic Biplane","aircraft_type":0,"era":{"selected":1},"cockpits":{"positions":[{"type":0,"upgrades":[false,false,false,false,false,false],"safety":[false,false,false,false,false],"sights":[false,false,false,false],"bombsight":0}]},"passengers":{"seats":0,"beds":0,"connected":false},"engines":{"engines":[{"selected_stats":{"name":"Rhona Motorbau Z11 80hp","overspeed":18,"altitude":29,"torque":2,"rumble":0,"oiltank":true,"pulsejet":false,"liftbleed":0,"wetmass":0,"mass":4,"drag":8,"control":0,"cost":4,"reqsections":0,"visibility":0,"flightstress":0,"escape":0,"pitchstab":0,"latstab":0,"cooling":0,"reliability":-1,"power":8,"fuelconsumption":10,"maxstrain":0,"structure":0,"pitchboost":0,"pitchspeed":0,"wingarea":0,"toughness":0,"upkeep":0,"crashsafety":0,"bomb_mass":0,"fuel":0,"charge":0},"selected_inputs":{"name":"Rhona Motorbau Z11 80hp","engine_type":0,"type":2,"era_sel":1,"displacement":10.9,"compression":4.5,"cyl_per_row":9,"rows":1,"RPM_boost":1,"material_fudge":1,"quality_fudge":1,"compressor_type":0,"compressor_count":0,"min_IAF":0,"upgrades":[false,false,false,false]},"cooling_count":0,"radiator_index":-1,"selected_mount":0,"use_pushpull":false,"pp_torque_to_struct":false,"use_driveshafts":false,"geared_propeller_ratio":0,"geared_propeller_reliability":0,"cowl_sel":2,"is_generator":false,"has_alternator":false,"intake_fan":false}],"radiators":[],"is_asymmetric":false},"propeller":{"type":2,"use_variable":false},"frames":{"sections":[{"frame":0,"geodesic":false,"monocoque":false,"lifting_body":false,"internal_bracing":false},{"frame":0,"geodesic":false,"monocoque":false,"lifting_body":false,"internal_bracing":false},{"frame":0,"geodesic":false,"monocoque":false,"lifting_body":false,"internal_bracing":false}],"tail_sections":[{"frame":0,"geodesic":false,"monocoque":false,"lifting_body":false,"internal_bracing":false},{"frame":0,"geodesic":false,"monocoque":false,"lifting_body":false,"internal_bracing":false}],"tail_index":2,"use_farman":false,"use_boom":false,"flying_wing":false,"sel_skin":1},"wings":{"wing_list":[{"surface":0,"area":8,"span":8,"anhedral":0,"dihedral":0,"gull":false,"deck":0},{"surface":0,"area":8,"span":8,"anhedral":0,"dihedral":0,"gull":false,"deck":3}],"mini_wing_list":[],"wing_stagger":4,"is_swept":false,"is_closed":false},"stabilizers":{"hstab_sel":0,"hstab_count":1,"vstab_sel":0,"vstab_count":1},"controlsurfaces":{"aileron_sel":0,"rudder_sel":0,"elevator_sel":0,"flaps_sel":0,"slats_sel":0,"drag_sel":[false,false,false]},"reinforcements":{"ext_wood_count":[1,0,0,0,0,0,0,0,0],"ext_steel_count":[0,0,0,0,0,0,0,0,0],"cant_count":[0,0,0,0,0],"wires":true,"cabane_sel":1,"wing_blades":false},"fuel":{"tank_count":[1,0,0,0],"self_sealing":false,"fire_extinguisher":false},"munitions":{"bomb_count":0,"rocket_count":0,"bay_count":0,"bay1":false,"bay2":false},"cargo":{"space_sel":0},"gear":{"gear_sel":0,"retract":false,"extra_sel":[false,false,false]},"accessories":{"v":2,"armour_coverage":[0,0,0,0,0,0,0,0],"electrical_count":[0,0,0],"radio_sel":0,"info_sel":[false,false],"visi_sel":[false,false,false],"clim_sel":[false,false,false,false],"auto_sel":0,"cont_sel":0},"optimization":{"free_dots":0,"cost":0,"bleed":0,"escape":0,"mass":0,"toughness":0,"maxstrain":0,"reliability":0,"drag":0},"weapons":{"weapon_systems":[{"weapon_type":3,"fixed":true,"directions":[true,false,false,false,false,false],"weapons":[{"fixed":true,"wing":false,"covered":false,"accessible":false,"free_accessible":true,"synchronization":0,"w_count":1}],"ammo":1,"action":0,"projectile":0,"repeating":false}],"brace_count":0},"used":{"enabled":false,"burnt_out":0,"ragged":0,"hefty":0,"sticky_guns":0,"weak":0,"fragile":0,"leaky":0,"sluggish":0},"rotor":{"type":0,"rotor_count":0,"rotor_span":0,"rotor_mat":0,"is_tandem":false,"accessory":false}}`;this.freeze_calculation=
!0;this.stats=new Stats;this.name="Prototype Aircraft";this.version=a.version;this.era=new Era(a.era);this.cockpits=new Cockpits(a.cockpit);this.passengers=new Passengers(a.passengers);this.engines=new Engines(a.engines);this.propeller=new Propeller(a.propellers);this.frames=new Frames(a.frames);this.wings=new Wings(a.wings);this.stabilizers=new Stabilizers(a.stabilizers);this.controlsurfaces=new ControlSurfaces(a.controls);this.reinforcements=new Reinforcement(a.reinforcement);this.fuel=new Fuel(a.fuel);
this.munitions=new Munitions;this.cargo=new CargoAndPassengers(a.cargo);this.gear=new LandingGear(a.landing_gear);this.accessories=new Accessories(a.accessories);this.optimization=new Optimization;this.weapons=new Weapons(b);this.used=new Used;this.rotor=new Rotor(a.rotor);this.alter=new AlterStats;this.era.SetCalculateStats(()=>{this.CalculateStats()});this.cockpits.SetCalculateStats(()=>{this.CalculateStats()});this.passengers.SetCalculateStats(()=>{this.CalculateStats()});this.engines.SetCalculateStats(()=>
{this.CalculateStats()});this.propeller.SetCalculateStats(()=>{this.CalculateStats()});this.frames.SetCalculateStats(()=>{this.CalculateStats()});this.wings.SetCalculateStats(()=>{this.CalculateStats()});this.stabilizers.SetCalculateStats(()=>{this.CalculateStats()});this.controlsurfaces.SetCalculateStats(()=>{this.CalculateStats()});this.reinforcements.SetCalculateStats(()=>{this.CalculateStats()});this.fuel.SetCalculateStats(()=>{this.CalculateStats()});this.munitions.SetCalculateStats(()=>{this.CalculateStats()});
this.cargo.SetCalculateStats(()=>{this.CalculateStats()});this.gear.SetCalculateStats(()=>{this.CalculateStats()});this.accessories.SetCalculateStats(()=>{this.CalculateStats()});this.optimization.SetCalculateStats(()=>{this.CalculateStats()});this.weapons.SetCalculateStats(()=>{this.CalculateStats()});this.used.SetCalculateStats(()=>{this.CalculateStats()});this.rotor.SetCalculateStats(()=>{this.CalculateStats()});this.alter.SetCalculateStats(()=>{this.CalculateStats()});this.rotor.SetCantileverList(this.reinforcements.GetCantileverList());
this.cockpits.SetNumberOfCockpits(1);this.engines.SetNumberOfEngines(1);this.frames.SetTailType(1);this.use_storage=c;this.freeze_calculation=this.updated_stats=!1;this.aircraft_type=AIRCRAFT_TYPE.AIRPLANE;this.Reset()}toJSON(){return{version:this.version,name:this.name,aircraft_type:this.aircraft_type,era:this.era.toJSON(),cockpits:this.cockpits.toJSON(),passengers:this.passengers.toJSON(),engines:this.engines.toJSON(),propeller:this.propeller.toJSON(),frames:this.frames.toJSON(),wings:this.wings.toJSON(),
stabilizers:this.stabilizers.toJSON(),controlsurfaces:this.controlsurfaces.toJSON(),reinforcements:this.reinforcements.toJSON(),fuel:this.fuel.toJSON(),munitions:this.munitions.toJSON(),cargo:this.cargo.toJSON(),gear:this.gear.toJSON(),accessories:this.accessories.toJSON(),optimization:this.optimization.toJSON(),weapons:this.weapons.toJSON(),used:this.used.toJSON(),rotor:this.rotor.toJSON(),alter:this.alter.toJSON()}}fromJSON(a,b=!0){this.freeze_calculation=!0;b&&(console.log(a),console.log(a.version));
b=parseFloat(a.version);this.name=a.name;11.05<b?(this.aircraft_type=a.aircraft_type,this.rotor.SetType(a.aircraft_type)):(this.aircraft_type=AIRCRAFT_TYPE.AIRPLANE,this.rotor.SetType(AIRCRAFT_TYPE.AIRPLANE));this.era.fromJSON(a.era,b);this.cockpits.fromJSON(a.cockpits,b);this.passengers.fromJSON(a.passengers,b);this.engines.fromJSON(a.engines,b);this.propeller.fromJSON(a.propeller,b);this.frames.fromJSON(a.frames,b);this.wings.fromJSON(a.wings,b);this.stabilizers.fromJSON(a.stabilizers,b);this.controlsurfaces.fromJSON(a.controlsurfaces,
b);this.reinforcements.fromJSON(a.reinforcements,b);this.fuel.fromJSON(a.fuel,b);this.munitions.fromJSON(a.munitions,b);this.cargo.fromJSON(a.cargo,b);this.gear.fromJSON(a.gear,b);this.accessories.fromJSON(a.accessories,b);this.optimization.fromJSON(a.optimization,b);this.weapons.fromJSON(a.weapons,b);10.65<b&&this.used.fromJSON(a.used,b);11.05<b&&this.rotor.fromJSON(a.rotor,b);12.25<b?this.alter.fromJSON(a.alter,b):this.alter.ClearAll();this.freeze_calculation=!1;return!0}serialize(a){a.PushString(this.version);
a.PushString(this.name);this.era.serialize(a);this.cockpits.serialize(a);this.passengers.serialize(a);this.engines.serialize(a);this.propeller.serialize(a);this.frames.serialize(a);this.wings.serialize(a);this.stabilizers.serialize(a);this.controlsurfaces.serialize(a);this.reinforcements.serialize(a);this.fuel.serialize(a);this.munitions.serialize(a);this.cargo.serialize(a);this.gear.serialize(a);this.accessories.serialize(a);this.optimization.serialize(a);this.weapons.serialize(a);this.used.serialize(a);
this.rotor.serialize(a);a.PushNum(this.aircraft_type);this.alter.serialize(a)}deserialize(a){this.freeze_calculation=!0;a.version=parseFloat(a.GetString());this.name=a.GetString();this.era.deserialize(a);this.cockpits.deserialize(a);this.passengers.deserialize(a);this.engines.deserialize(a);this.propeller.deserialize(a);this.frames.deserialize(a);this.wings.deserialize(a);this.stabilizers.deserialize(a);this.controlsurfaces.deserialize(a);this.reinforcements.deserialize(a);this.fuel.deserialize(a);
this.munitions.deserialize(a);this.cargo.deserialize(a);this.gear.deserialize(a);this.accessories.deserialize(a);this.optimization.deserialize(a);this.weapons.deserialize(a);10.65<a.version&&this.used.deserialize(a);11.05<a.version?(this.rotor.deserialise(a),this.aircraft_type=a.GetNum(),this.rotor.SetType(this.aircraft_type)):(this.aircraft_type=AIRCRAFT_TYPE.AIRPLANE,this.rotor.SetType(AIRCRAFT_TYPE.AIRPLANE));12.25<a.version?this.alter.deserialize(a):this.alter.ClearAll();this.freeze_calculation=
!1}SetType(a){this.aircraft_type=a;this.rotor.SetType(a);this.CalculateStats()}SetDisplayCallback(a){this.DisplayCallback=a}CalculateStats(){if(!this.freeze_calculation){this.updated_stats=!1;var a=new Stats;a=a.Add(this.era.PartStats());a=a.Add(this.cockpits.PartStats());a=a.Add(this.passengers.PartStats());this.engines.SetTailMods(this.frames.GetFarmanOrBoom(),this.wings.GetSwept()&&this.stabilizers.GetVOutboard(),this.stabilizers.GetCanard());this.engines.SetInternal(this.aircraft_type==AIRCRAFT_TYPE.HELICOPTER||
IsAnyOrnithopter(this.aircraft_type));this.engines.SetMetalArea(this.wings.GetMetalArea());this.engines.HaveParasol(this.wings.GetParasol());a=a.Add(this.engines.PartStats());this.propeller.SetEngineTypes(this.engines.GetEngineTypes());this.propeller.SetAcftType(this.aircraft_type);a=a.Add(this.propeller.PartStats());a=a.Add(this.fuel.PartStats());a=a.Add(this.munitions.PartStats());this.weapons.SetNumberOfCockpits(this.cockpits.GetNumberOfCockpits());this.weapons.SetTractorInfo(this.engines.GetTractorSpinner());
this.weapons.SetPusherInfo(this.engines.GetPusherSpinner());this.weapons.cant_type=this.reinforcements.GetCantileverType();this.weapons.SetHavePropeller(0<this.engines.GetNumPropellers());this.weapons.SetCanWing(!IsAnyOrnithopter(this.aircraft_type));a=a.Add(this.weapons.PartStats());a=a.Add(this.cargo.PartStats());this.aircraft_type==AIRCRAFT_TYPE.AUTOGYRO?this.wings.SetRotorSpan(this.rotor.GetRotorSpan()):this.wings.SetRotorSpan(0);a=a.Add(this.wings.PartStats());this.rotor.SetWingArea(a.wingarea);
this.aircraft_type==AIRCRAFT_TYPE.AUTOGYRO&&(this.rotor.SetEngineCount(this.engines.GetNumberOfEngines()),a=a.Add(this.rotor.PartStats()));this.controlsurfaces.SetWingArea(a.wingarea);this.controlsurfaces.SetBoomTail(this.frames.GetUseBoom());this.controlsurfaces.SetSpan(this.wings.GetSpan());this.controlsurfaces.SetAcftType(this.aircraft_type);this.controlsurfaces.SetCanElevator(0<this.stabilizers.GetHStabCount());this.controlsurfaces.SetCanRudder(0<this.stabilizers.GetVStabCount());this.controlsurfaces.SetIsVTail(this.stabilizers.GetIsVTail());
this.aircraft_type==AIRCRAFT_TYPE.AIRPLANE?this.controlsurfaces.SetNumCantilever(this.reinforcements.GetTotalCantilevers()):this.controlsurfaces.SetNumCantilever(0);a=a.Add(this.controlsurfaces.PartStats());this.reinforcements.SetMonoplane(this.wings.GetMonoplane());this.reinforcements.SetTandem(this.wings.GetTandem());this.reinforcements.SetStaggered(this.wings.GetStaggered());this.reinforcements.SetCanUseExternal(0<this.wings.GetArea());this.reinforcements.SetSesquiplane(this.wings.GetIsSesquiplane());
this.reinforcements.SetAircraftType(this.aircraft_type);this.reinforcements.SetCantLift(this.era.GetCantLift());a=a.Add(this.reinforcements.PartStats());this.rotor.GetTailRotor()&&(a.power=Math.floor(1E-6+.9*a.power));this.accessories.SetAcftRadiator(0<this.engines.GetNumberOfRadiators());this.accessories.SetSkinArmor(this.frames.GetArmor());this.accessories.SetVitalParts(this.VitalComponentList().length);this.accessories.SetCanCutouts(this.wings.CanCutout(),this.frames.CanCutout());a=a.Add(this.accessories.PartStats());
this.frames.SetRequiredSections(a.reqsections);this.frames.SetHasTractorNacelles(this.engines.GetHasTractorNacelles());this.frames.SetIsTandem(this.wings.GetTandem());a=a.Add(this.frames.PartStats());this.stabilizers.SetEngineCount(this.engines.GetNumberOfEngines());this.stabilizers.SetIsTandem(this.wings.GetTandem());this.stabilizers.SetIsSwept(this.wings.GetSwept());this.stabilizers.SetHaveTail(!this.frames.GetIsTailless());this.stabilizers.SetHelicopter(!1);this.stabilizers.SetLiftingArea(a.wingarea);
this.stabilizers.wing_drag=this.wings.GetWingDrag()+this.rotor.GetRotorDrag();a=a.Add(this.stabilizers.PartStats());this.wings.SetAircraftMass(a.mass);this.wings.SetAcftType(this.aircraft_type);a.mass+=this.wings.GetPaperMass();a.mass=Math.max(1,a.mass);this.gear.SetGull(this.wings.HasInvertedGull());this.gear.SetLoadedMass(a.mass+a.wetmass);this.gear.CanBoat(this.engines.GetEngineHeight(),this.wings.GetWingHeight());a=a.Add(this.gear.PartStats());a.toughness+=Math.floor(1E-6+a.structure/5);this.optimization.SetAcftStats(a);
a=a.Add(this.optimization.PartStats());this.cockpits.SetHasRotary(this.engines.HasTractorRotary());a=a.Add(this.alter.PartStats());a.Round();if(!this.updated_stats){this.updated_stats=!0;this.stats=a;var b=this.GetDerivedStats();this.stats.cost+=this.controlsurfaces.GetFlapCost(b.DryMP);a.reliability-=this.used.burnt_out;this.weapons.SetStickyGuns(this.used.sticky_guns);this.cockpits.SetArmed(this.weapons.GetArmedSeats());this.cockpits.UpdateCrewStats(this.stats.escape,b.ControlStress,b.RumbleStress,
this.stats.visibility,this.stats.crashsafety);b=0;for(let c of this.cockpits.GetStressList())b=Math.max(b,c[0]-c[1]);0!=b&&-1==this.stats.warnings.findIndex(c=>c.source==lu("Co-Pilot Controls"))&&this.stats.warnings.push({source:lu("Co-Pilot Controls"),warning:lu("Co-Pilot Warning",b),color:WARNING_COLOR.WHITE});IsAnyOrnithopter(this.aircraft_type)&&(a.upkeep+=1);this.aircraft_type==AIRCRAFT_TYPE.ORNITHOPTER_BUZZER&&(a.reliability-=2);this.engines.UpdateReliability(a);this.reinforcements.SetAcftStructure(a.structure);
this.fuel.SetArea(this.wings.GetArea());this.fuel.SetCantilever(this.reinforcements.GetIsCantilever());this.munitions.SetAcftParameters(a.structure,this.era.GetMaxBomb(),this.wings.HasInvertedGull());this.stats.cost=Math.max(1,this.stats.cost);this.stats.liftbleed=Math.max(1,this.stats.liftbleed);10*this.engines.GetRumble()>a.structure&&(this.stats.power=0,this.stats.warnings.push({source:lu("Stat Rumble"),warning:lu("Rumble Warning"),color:WARNING_COLOR.RED}));this.DisplayCallback&&!this.freeze_calculation&&
this.DisplayCallback();this.use_storage&&window.localStorage.setItem("aircraft",JSON.stringify(this))}}}GetDerivedStats(){var a=Math.floor(1E-6+this.stats.mass/5);a=Math.max(a,1);var b=Math.floor(1E-6+(this.stats.mass+this.stats.wetmass)/5);b=Math.max(b,1);var c=Math.floor(1E-6+(this.stats.mass+this.stats.wetmass+this.stats.bomb_mass)/5);c=Math.max(c,1);var d=Math.floor(1E-6+(this.stats.drag+a)/5),e=d=Math.max(d,1),f=Math.floor(1E-6+(this.stats.drag+this.munitions.GetExternalMass()+a)/5);f=Math.max(f,
1);var h=Math.floor(1E-6+this.stats.pitchspeed*Math.sqrt(2E3*this.stats.power/(9*d))),g=Math.floor(1E-6+this.stats.pitchspeed*Math.sqrt(2E3*this.stats.power/(9*e))),k=Math.floor(1E-6+this.stats.pitchspeed*Math.sqrt(2E3*this.stats.power/(9*f))),m=Math.max(1,Math.floor(1E-6+this.stats.liftbleed*a/Math.max(1,this.stats.wingarea))),n=Math.max(1,Math.floor(1E-6+this.stats.liftbleed*b/Math.max(1,this.stats.wingarea))),q=Math.max(Math.floor(1E-6+this.stats.liftbleed*c/Math.max(1,this.stats.wingarea))),x=
this.engines.GetOverspeed(),t=Math.floor(1E-6+this.stats.power/a),w=Math.floor(1E-6+this.stats.power/b),l=Math.floor(1E-6+this.stats.power/c);0==l&&-1==this.stats.warnings.findIndex(z=>z.source==lu("Derived Boost"))&&this.stats.warnings.push({source:lu("Derived Boost"),warning:lu("Boost Warning"),color:WARNING_COLOR.RED});var r=Math.floor(1E-6+this.stats.pitchboost*h);h=Math.floor(1E-6+h*(1-.1*this.used.ragged));g=Math.floor(1E-6+g*(1-.1*this.used.ragged));k=Math.floor(1E-6+k*(1-.1*this.used.ragged));
var u=this.stats.pitchstab+this.stats.latstab;0<this.stats.pitchstab&&0<this.stats.latstab?u+=2:0>this.stats.pitchstab&&0>this.stats.latstab&&(u-=2);var v=100+this.stats.control-a;10<u||-10>u?(v=-1/0,-1==this.stats.warnings.findIndex(z=>z.source==lu("Derived Stability"))&&this.stats.warnings.push({source:lu("Derived Stability"),warning:lu("Stability Warning"),color:WARNING_COLOR.RED})):10==u?v-=4:6<u?v-=3:3<u?v-=2:0<u?--v:0==u?v+=0:-4<u?v+=1:-7<u?v+=2:-10<u?v+=3:-10==u&&(v+=4);var y=v+a-b,p=v+a-c;
v=Math.floor(1E-6+v-5*this.used.sluggish);y=Math.floor(1E-6+y-5*this.used.sluggish);p=Math.floor(1E-6+p-5*this.used.sluggish);var A=Math.min(this.stats.maxstrain-a,this.stats.structure);this.optimization.final_ms=Math.floor(1E-6+1.5*this.optimization.GetMaxStrain()*A/10);A+=this.optimization.final_ms;A=Math.floor(1E-6+A*(1-.2*this.used.fragile));10>A&&-1==this.stats.warnings.findIndex(z=>z.source==lu("Stat Max Strain"))&&this.stats.warnings.push({source:lu("Stat Max Strain"),warning:lu("Max Strain Warning"),
color:WARNING_COLOR.RED});var H=this.stats.toughness;H=Math.floor(1E-6+H*(1-.5*this.used.weak));var L=this.stats.structure,D=Math.ceil(-1E-6+d/this.propeller.GetEnergy()),I=D+1;D=Math.min(D,10);I=Math.min(I,10);var E=Math.ceil(-1E-6+Math.floor(1E-6+(m+n)/2)/this.propeller.GetTurn());this.aircraft_type==AIRCRAFT_TYPE.HELICOPTER&&(E=Math.max(1,Math.floor(1E-6+a/2))+this.rotor.GetRotorBleed(),D=Math.max(1,Math.floor(1E-6+d/7)),q=n=m=0,h=Math.min(37,h),g=Math.min(37,g),k=Math.min(37,k));E=Math.max(E,
1);var M=Math.max(E+1,1);m=Math.max(1,Math.floor(1E-6+m*(1+.2*this.used.hefty)));n=Math.max(1,Math.floor(1E-6+n*(1+.2*this.used.hefty)));q=Math.max(1,Math.floor(1E-6+q*(1+.2*this.used.hefty)));(k<=q||g<=n)&&-1==this.stats.warnings.findIndex(z=>z.source==lu("Stall Speed"))&&this.stats.warnings.push({source:lu("Stall Speed"),warning:lu("Stall Speed Warning"),color:WARNING_COLOR.RED});var B=Math.floor(1E-6+this.stats.fuel/this.stats.fuelconsumption);B=Math.floor(1E-6+B*(1-.2*this.used.leaky));isFinite(B)||
(B=0);6>B&&-1==this.stats.warnings.findIndex(z=>z.source==lu("Derived Fuel Uses"))&&this.stats.warnings.push({source:lu("Derived Fuel Uses"),warning:lu("Fuel Uses Warning"),color:WARNING_COLOR.YELLOW});var F=1;(3<u||-3>u)&&F++;var G=0;F+=Math.min(this.accessories.GetMaxMassStress(),Math.floor(1E-6+a/10));var C=this.accessories.GetMaxTotalStress();F=Math.min(C,F);0<this.engines.GetMaxRumble()&&(G+=Math.max(1,this.engines.GetMaxRumble()),G=Math.floor(1E-6+G));0==C&&(G=0);C=Math.max(1,Math.floor(1E-6+
this.stats.power/a*(23/this.stats.pitchspeed)/d));var J=Math.max(1,Math.floor(1E-6+this.stats.power/b*(23/this.stats.pitchspeed)/e)),K=Math.max(1,Math.floor(1E-6+this.stats.power/c*(23/this.stats.pitchspeed)/f));isFinite(C)||(K=J=C=0);IsAnyOrnithopter(this.aircraft_type)&&(v+=5,y+=5,p+=5,-1==this.stats.warnings.findIndex(z=>z.source==lu("Ornithopter Stall"))&&this.stats.warnings.push({source:lu("Ornithopter Stall"),warning:lu("Ornithopter Stall Warning"),color:WARNING_COLOR.WHITE}),x=A);this.aircraft_type==
AIRCRAFT_TYPE.ORNITHOPTER_FLUTTER&&(v+=5,y+=5,p+=5,x=Infinity,-1==this.stats.warnings.findIndex(z=>z.source==lu("Ornithopter Flutterer Attack"))&&this.stats.warnings.push({source:lu("Ornithopter Flutterer Attack"),warning:lu("Ornithopter Flutterer Attack Warning"),color:WARNING_COLOR.WHITE}));this.aircraft_type==AIRCRAFT_TYPE.ORNITHOPTER_BUZZER&&(-1==this.stats.warnings.findIndex(z=>z.source==lu("Ornithopter Buzzer Boost"))&&this.stats.warnings.push({source:lu("Ornithopter Buzzer Boost"),warning:lu("Ornithopter Buzzer Boost Warning"),
color:WARNING_COLOR.WHITE}),-1==this.stats.warnings.findIndex(z=>z.source==lu("Ornithopter Buzzer Stall"))&&this.stats.warnings.push({source:lu("Ornithopter Buzzer Stall"),warning:lu("Ornithopter Buzzer Stall Warning"),color:WARNING_COLOR.WHITE}));return{DryMP:a,WetMP:b,WetMPwBombs:c,DPEmpty:d,DPFull:e,DPwBombs:f,MaxSpeedEmpty:h,MaxSpeedFull:g,MaxSpeedwBombs:k,StallSpeedEmpty:m,StallSpeedFull:n,StallSpeedFullwBombs:q,Overspeed:x,BoostEmpty:t,BoostFull:w,BoostFullwBombs:l,Dropoff:r,Stabiilty:u,HandlingEmpty:v,
HandlingFull:y,HandlingFullwBombs:p,MaxStrain:A,Toughness:H,Structure:L,EnergyLoss:D,EnergyLosswBombs:I,TurnBleed:E,TurnBleedwBombs:M,FuelUses:B,ControlStress:F,RumbleStress:G,RateOfClimbFull:J,RateOfClimbEmpty:C,RateOfClimbwBombs:K}}VitalComponentList(){var a=this.GetDerivedStats(),b=[];b.push(lu("Vital Part Controls"));for(var c=0;c<this.GetCockpits().GetNumberOfCockpits();c++)b.push(lu("Seat #",c+1)+": "+lu(this.GetCockpits().GetCockpit(c).GetName()));0<a.FuelUses&&b.push(lu("Vital Part Fuel Tanks"));
for(a=0;a<this.GetEngines().GetNumberOfEngines();a++)this.GetEngines().GetEngine(a).GetUsePushPull()?(b.push(lu("Vital Part Engine Pusher",a+1)),this.GetEngines().GetEngine(a).GetHasOilTank()&&b.push(lu("Vital Part Oil Tank Pusher",a+1)),this.GetEngines().GetEngine(a).GetHasOilCooler()&&b.push(lu("Vital Part Oil Cooler Pusher",a+1)),this.GetEngines().GetEngine(a).GetHasOilPan()&&b.push(lu("Vital Part Oil Pan Pusher",a+1)),b.push(lu("Vital Part Engine Puller",a+1)),this.GetEngines().GetEngine(a).GetHasOilTank()&&
b.push(lu("Vital Part Oil Tank Puller",a+1)),this.GetEngines().GetEngine(a).GetHasOilCooler()&&b.push(lu("Vital Part Oil Cooler Puller",a+1)),this.GetEngines().GetEngine(a).GetHasOilPan()&&b.push(lu("Vital Part Oil Pan Puller",a+1))):(b.push(lu("Vital Part Engine",a+1)),this.GetEngines().GetEngine(a).GetHasOilTank()&&b.push(lu("Vital Part Oil Tank",a+1)),this.GetEngines().GetEngine(a).GetHasOilCooler()&&b.push(lu("Vital Part Oil Cooler",a+1)),this.GetEngines().GetEngine(a).GetHasOilPan()&&b.push(lu("Vital Part Oil Pan",
a+1)));for(a=0;a<this.GetEngines().GetNumberOfRadiators();a++)b.push(lu("Vital Part Radiator",a+1));this.IsElectrics()&&b.push(lu("Vital Part Electrics"));a=this.GetWeapons().GetWeaponList();for(c=0;c<this.GetWeapons().GetWeaponSets().length;c++)b.push(lu("Vital Part Weapon Set",c+1,a[this.GetWeapons().GetWeaponSets()[c].GetWeaponSelected()].abrv));this.GetLandingGear().IsVital()&&b.push(lu("Vital Part Landing Gear"));this.rotor.GetTailRotor()&&b.push(lu("Vital Part Tail Rotor"));return b}SetStorage(a){this.use_storage=
a}Reset(){this.fromJSON(JSON.parse(this.reset_json),!1)}GetVersion(){return this.version}GetCommunicationName(){return this.accessories.GetCommunicationName()}GetAttackList(){return this.cockpits.GetAttackList()}GetVisibilityList(){return this.cockpits.GetVisibilityList()}GetStressList(){return this.cockpits.GetStressList()}GetEscapeList(){return this.cockpits.GetEscapeList()}GetCrashList(){return this.cockpits.GetCrashList()}GetReliabilityList(){return this.engines.GetReliabilityList()}GetMinIAF(){return this.engines.GetMinIAF()}GetMaxIAF(){return this.engines.GetMaxIAF()}GetMinAltitude(){return this.engines.GetMinAltitude()}GetMaxAltitude(){return this.engines.GetMaxAltitude()}GetGearName(){return this.gear.GetGearName()}GetIsFlammable(){return this.frames.GetIsFlammable()||
this.wings.GetIsFlammable()||this.engines.GetIsFlammable()}GetAircraftType(){return this.aircraft_type}GetEra(){return this.era}GetCockpits(){return this.cockpits}GetPassengers(){return this.passengers}GetEngines(){return this.engines}GetPropeller(){return this.propeller}GetFrames(){return this.frames}GetWings(){return this.wings}GetStabilizers(){return this.stabilizers}GetControlSurfaces(){return this.controlsurfaces}GetReinforcements(){return this.reinforcements}GetFuel(){return this.fuel}GetMunitions(){return this.munitions}GetCargoAndPassengers(){return this.cargo}GetLandingGear(){return this.gear}GetAccessories(){return this.accessories}GetOptimization(){return this.optimization}GetStats(){return this.stats}GetWeapons(){return this.weapons}IsElectrics(){return this.engines.IsElectrics()||
this.accessories.IsElectrics()||this.cockpits.IsElectrics()}GetUsed(){return this.used}GetRotor(){return this.rotor}GetAlter(){return this.alter}GetElectrics(){let a={storage:0,equipment:[]};a=MergeElectrics(a,this.accessories.GetElectrics());a=MergeElectrics(a,this.wings.GetElectrics());a=MergeElectrics(a,this.cockpits.GetElectrics());a=MergeElectrics(a,this.alter.GetElectrics());a=MergeElectrics(a,this.cargo.GetElectrics());a=MergeElectrics(a,this.era.GetElectrics());a=MergeElectrics(a,this.frames.GetElectrics());
a=MergeElectrics(a,this.fuel.GetElectrics());a=MergeElectrics(a,this.gear.GetElectrics());a=MergeElectrics(a,this.munitions.GetElectrics());a=MergeElectrics(a,this.optimization.GetElectrics());a=MergeElectrics(a,this.passengers.GetElectrics());a=MergeElectrics(a,this.reinforcements.GetElectrics());a=MergeElectrics(a,this.rotor.GetElectrics());a=MergeElectrics(a,this.stabilizers.GetElectrics());a=MergeElectrics(a,this.used.GetElectrics());a.equipment=a.equipment.sort((c,d)=>{var e=parseInt(c.charge);
"-"==c.charge&&(e=0);c=parseInt(d.charge);"-"==d.charge&&(c=0);return isNaN(e)&&isNaN(c)?0:isNaN(e)?-1:isNaN(c)?1:c-e});a=MergeElectrics(this.engines.GetElectrics(),a);a=MergeElectrics(a,this.weapons.GetElectrics());var b=!1;for(let c of a.equipment){let d=parseInt(c.charge);!isNaN(d)&&0<d&&(c.charge="+"+c.charge,b=!0)}0<a.equipment.length&&0>=a.storage&&!b&&-1==this.stats.warnings.findIndex(c=>c.source==lu("Insufficient Charge"))&&this.stats.warnings.push({source:lu("Insufficient Charge"),warning:lu("Insufficient Charge Warning"),
color:WARNING_COLOR.RED});return a}}
class AlterStats extends Part{constructor(){super();var a=JSON.parse(window.localStorage.getItem("CustomParts"));a||(a=[],window.localStorage.setItem("CustomParts",JSON.stringify([])));this.custom_parts=[];for(let b of a)this.custom_parts.push({name:b.name,stats:new Stats(b.stats),qty:0})}toJSON(){var a=[],b=[];for(let c of this.custom_parts)b.push({name:c.name,stats:c.stats.toJSON(),qty:c.qty}),0<c.qty&&a.push({name:c.name,stats:c.stats.toJSON(),qty:c.qty});window.localStorage.setItem("CustomParts",JSON.stringify(b));
return{part_list:a}}fromJSON(a,b){for(let c of this.custom_parts)c.qty=0;for(let c of a.part_list)a=this.custom_parts.findIndex(d=>d.name==c.name),-1==a?this.custom_parts.push({name:c.name,stats:new Stats(c.stats),qty:c.qty}):this.custom_parts[a].qty=c.qty}serialize(a){var b=[];for(let c of this.custom_parts)0<c.qty&&b.push({name:c.name,stats:c.stats,qty:c.qty});a.PushNum(b.length);for(let c of b)a.PushString(c.name),c.stats.serialize(a),a.PushNum(c.qty)}deserialize(a){for(var b of this.custom_parts)b.qty=
0;b=a.GetNum();for(let d=0;d<b;d++){let e=a.GetString(),f=new Stats;f.deserialize(a);let h=a.GetNum();var c=this.custom_parts.findIndex(g=>g.name==e);-1==c?(c=this.custom_parts.length,this.custom_parts.push({name:e,stats:f,qty:h})):this.custom_parts[c].qty=h}}ClearAll(){for(let a of this.custom_parts)a.qty=0}AddPart(a,b){var c=0+Math.abs(b.drag);c+=Math.abs(b.mass);c+=Math.abs(b.wetmass);c+=Math.abs(b.bomb_mass);c+=Math.abs(b.cost);c+=Math.abs(b.upkeep);c+=Math.abs(b.liftbleed);c+=Math.abs(b.wingarea);
c+=Math.abs(b.control);c+=Math.abs(b.pitchstab);c+=Math.abs(b.latstab);c+=Math.abs(b.maxstrain);c+=Math.abs(b.structure);c+=Math.abs(b.toughness);c+=Math.abs(b.power);c+=Math.abs(b.fuelconsumption);c+=Math.abs(b.fuel);c+=Math.abs(b.charge);c+=Math.abs(b.crashsafety);c+=Math.abs(b.visibility);c+=Math.abs(b.escape);c+=Math.abs(b.reliability);c+=Math.abs(b.warnings.length);0!=c&&(c=this.custom_parts.findIndex(d=>d.name==a),-1!=c?this.custom_parts[c].stats=b:this.custom_parts.push({name:a,stats:b,qty:0}),
this.custom_parts.sort((d,e)=>d.name.localeCompare(e.name)),this.CalculateStats())}RemovePart(a){var b=this.custom_parts.findIndex(c=>c.name==a);-1!=b&&this.custom_parts.splice(b,1);this.CalculateStats()}GetParts(){return this.custom_parts}SetUsedPart(a,b){this.custom_parts[a].qty=b;this.CalculateStats()}PartStats(){var a=new Stats;for(let b of this.custom_parts)if(0<b.qty){let c=b.stats.Clone();c=c.Multiply(b.qty);a=a.Add(c)}return a}GetElectrics(){var a=[];for(let b of this.custom_parts)0<b.qty&&
(a=this.FormatEquipment(a,b.name,b.stats.charge));return{storage:0,equipment:a}}SetCalculateStats(a){this.CalculateStats=a}};
